import{e as F,f as c,j as e,M as G,S as J,F as Z,h as q,k as W,l as H,m as X,G as K,n as T,o as Q,E as Y,T as _,q as D,Z as ee,P as te,t as re,C as ne,w as oe,x as U,y as z,U as se,z as le}from"./vendor-LiCFjeLd.js";import{m as P,M as ae}from"./vendor-mapbox-BmOpYhDx.js";import{b as V,i as A,u as ie,c as ce,d as ue,a as B,f as $,v as de,e as M,g as fe,p as me,h as O,l as pe}from"./vendor-turf-C37F7LJW.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const f of i.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function l(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=l(a);fetch(a.href,i)}})();const k=F(t=>({mapRef:c.createRef(),setMapRef:r=>t({mapRef:r}),mapReady:!1,setMapReady:r=>t({mapReady:r}),basemap:{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"},setBasemap:r=>t(l=>r.url===l.basemap.url?l:{basemap:r}),resetMapStore:()=>t(()=>({mapReady:!1,basemap:{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"}}))})),j=F(t=>({layers:[],resetLayerStore:()=>t(()=>({layers:[]})),loadProjectLayers:r=>t(()=>({layers:r})),addLayer:r=>t(l=>{const o=s=>l.layers.some(u=>u.id===s)?o(s+"1"):s,a=r.featureCollection.features[0].geometry.type,i=a==="Polygon"||a==="MultiPolygon"?"fill":a==="LineString"||a==="MultiLineString"?"line":a==="Point"||a==="MultiPoint"?"circle":null;if(!i)throw new Error("Unsupported geometry type: "+a);r.name||(r.name=i==="fill"?"polygon layer":i==="line"?"line layer":i==="circle"?"point layer":"not possible");const f={h:Math.floor(Math.random()*360),s:90,l:48,a:i==="fill"?.7:1};return{layers:[{featureCollection:r.featureCollection,id:o(r.name),name:r.name,renderingType:i,visible:!0,color:f},...l.layers]}}),moveLayerUp:r=>t(l=>{const o=l.layers.findIndex(i=>i.id===r);if(o===0)return l;const a=[...l.layers];return a.splice(o-1,0,a.splice(o,1)[0]),{layers:a}}),moveLayerDown:r=>t(l=>{const o=l.layers.findIndex(i=>i.id===r);if(o===l.layers.length-1)return l;const a=[...l.layers];return a.splice(o+1,0,a.splice(o,1)[0]),{layers:a}}),deleteLayer:r=>t(l=>({layers:l.layers.filter(o=>o.id!==r)})),toggleLayerVisibility:r=>t(l=>({layers:l.layers.map(o=>o.id===r?{...o,visible:!o.visible}:o)})),toggleLayerVisibilityAll:()=>t(r=>{const l=r.layers.every(o=>o.visible);return{layers:r.layers.map(o=>({...o,visible:!l}))}}),changeLayerColor:(r,l)=>t(o=>({layers:o.layers.map(a=>a.id===r?{...a,color:l}:a)})),updateAllLayers:()=>t(r=>({layers:r.layers.map(l=>({...l,updater:l.updater?l.updater+1:1}))})),changeLayerName:(r,l)=>t(o=>({layers:o.layers.map(a=>a.id===r?{...a,name:l}:a)}))}));P.accessToken="pk.eyJ1IjoidG9iaWFuZCIsImEiOiJjbTdiMGZwemwwNmxlMnFyNTV4YWh2ZzB3In0.B3fVZMQOYEs2V23kKWB5XQ";const he=()=>{const{mapRef:t,mapReady:r,setMapReady:l,basemap:o}=k(),{addLayer:a,updateAllLayers:i}=j(),f=c.useRef(null);c.useEffect(()=>{var b,y,C,v,g,m;if(!r&&f.current){f.current.innerHTML="",t.current=new P.Map({container:f.current,style:o.url,center:[10.4,63.425],zoom:12}),(b=t.current)==null||b.addControl(new P.FullscreenControl,"top-right"),(y=t.current)==null||y.addControl(new P.NavigationControl({visualizePitch:!0}),"top-right"),(C=t.current)==null||C.addControl(new P.ScaleControl,"bottom-right");const h=new ae({displayControlsDefault:!1,controls:{point:!0,line_string:!0,polygon:!0},boxSelect:!1});(v=t.current)==null||v.addControl(h,"bottom-left"),(g=t.current)==null||g.on("draw.create",()=>{a({featureCollection:h.getAll(),name:null}),h.deleteAll()}),(m=t.current)==null||m.on("style.load",()=>{l(!0)})}},[t,a,r,l,o]);const[n,s]=c.useState(!1),u=c.useRef(o),[d,p]=c.useState(o);return c.useEffect(()=>{var b;u.current.url!==o.url&&(u.current=o),!n&&d.url!==u.current.url&&(s(!0),r&&t.current&&(t.current.setStyle(u.current.url),p(o)),(b=t.current)==null||b.once("style.load",()=>{i()}),setTimeout(()=>{s(!1)},200))},[o,t,r,n,d,i]),e.jsx("div",{ref:f,className:"mapContainer"})},E=(t,r,l=[])=>{c.useEffect(()=>{const o=a=>{const i=a.target;t.current&&!t.current.contains(i)&&!l.some(f=>{var n;return(n=f.current)==null?void 0:n.contains(i)})&&r()};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}},[t,r,l])},ye=()=>{const[t,r]=c.useState(!1),l=c.useRef(null);E(l,()=>{r(!1)});const[o,a]=c.useState(null),{basemap:i,setBasemap:f}=k(),n=[{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"},{url:"mapbox://styles/mapbox/outdoors-v12",name:"Outdoors"},{url:"mapbox://styles/mapbox/light-v11",name:"Light"},{url:"mapbox://styles/mapbox/dark-v11",name:"Dark"},{url:"mapbox://styles/mapbox/satellite-v9",name:"Satellite"},{url:"mapbox://styles/mapbox/satellite-streets-v12",name:"Satellite Streets"},{url:"mapbox://styles/mapbox/navigation-day-v1",name:"Navigation Day"},{url:"mapbox://styles/mapbox/navigation-night-v1",name:"Navigation Night"},{url:"mapbox://styles/tobiand/cm8rbg7j900be01sa5wc6d4lq",name:"Off (white)"},{url:"mapbox://styles/tobiand/cm8rbd89l00az01sb97a8hfyh",name:"Off (black)"}];return e.jsxs("div",{className:"basemap",ref:l,children:[e.jsxs("button",{type:"button",onClick:()=>r(!t),children:[e.jsx(G,{})," Change basemap"]}),t&&e.jsx("div",{className:"basemapPopover",children:e.jsx("ul",{onMouseEnter:()=>{a(i)},onMouseLeave:()=>{f(o),a(null)},children:n.map(s=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{a(s)},onMouseEnter:()=>{f(s)},children:[o===null&&s.name===i.name||o!==null&&s.name===o.name?"*":"",s.name]})},s.name))})})]})},be=F(t=>({theme:localStorage.getItem("theme")||"light",setTheme:r=>t(l=>(localStorage.setItem("theme",r),r===l.theme?l:{theme:r}))})),xe=()=>{const[t,r]=c.useState(!1),l=c.useRef(null);E(l,()=>{r(!1)});const{layers:o,resetLayerStore:a,loadProjectLayers:i}=j(),{basemap:f,setBasemap:n,resetMapStore:s}=k(),{theme:u,setTheme:d}=be(),p=()=>{a(),s()},b=()=>{const g={layers:o,basemap:f},m=new Blob([JSON.stringify(g)],{type:"application/json"}),h=URL.createObjectURL(m),x=document.createElement("a");x.href=h,x.download="μGIS_project.mugis",document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(h)},y=c.useRef(null),C=()=>{var g;(g=y.current)==null||g.click()},v=g=>{const m=g.target.files;if(!m){console.log("no file selected");return}const h=new FileReader;h.onload=x=>{var S;try{const N=JSON.parse((S=x.target)==null?void 0:S.result);i(N.layers),n(N.basemap)}catch(N){console.log(N)}},h.readAsText(m[0])};return c.useEffect(()=>{document.documentElement.setAttribute("data-theme",u)},[u]),e.jsxs("div",{className:"settings",ref:l,children:[e.jsx("button",{type:"button",onClick:()=>{r(!t)},children:e.jsx(J,{})}),t&&e.jsx("div",{className:"settingsPopover",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:p,children:[e.jsx(Z,{})," New project"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:b,children:[e.jsx(q,{})," Save project"]})}),e.jsxs("li",{children:[e.jsx("input",{ref:y,type:"file",accept:".mugis",onChange:v}),e.jsxs("button",{type:"button",onClick:C,children:[e.jsx(W,{})," Load project"]})]}),e.jsx("li",{children:e.jsx(ye,{})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{d(u==="light"?"dark":"light")},children:[u==="light"?e.jsx(H,{}):e.jsx(X,{})," Toggle theme"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{},children:[e.jsx(K,{})," Start tutorial"]})})]})})]})},L=({children:t,buttonLabel:r,onFormSubmit:l})=>{const[o,a]=c.useState(!1),[i,f]=c.useState(!1);return e.jsxs("div",{children:[e.jsx("button",{type:"button",onClick:()=>a(!o),children:r}),o&&e.jsx("div",{className:"cover",onClick:n=>{n.target===n.currentTarget&&a(!1)},children:e.jsx("div",{className:"modal"+(i?" loading":""),children:e.jsxs("form",{onSubmit:n=>{n.preventDefault(),f(!0),setTimeout(()=>{l()&&a(!1),f(!1)},0)},children:[e.jsx("h3",{children:r}),t,e.jsx("button",{type:"button",onClick:()=>a(!1),children:"Close"}),e.jsx("button",{type:"submit",children:"Submit"})]})})})]})},w=({selectedLayer:t,setSelectedLayer:r,renderingType:l=void 0,unselectableLayerIds:o=[]})=>{const{layers:a}=j();return e.jsxs("select",{required:!0,value:t==null?void 0:t.id,onChange:i=>r(a.find(f=>f.id===i.target.value)),children:[e.jsx("option",{value:void 0,children:"Select a layer1"}),a.filter(i=>l?i.renderingType===l:!0).filter(i=>!o.includes(i.id)).map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})},ge=()=>{const{addLayer:t}=j(),[r,l]=c.useState(void 0),[o,a]=c.useState(""),[i,f]=c.useState("");c.useEffect(()=>{r&&f(`buffer(${r.name}, ${o}m)`)},[r,o]);const n=()=>{if(!r||o==="")return alert("Please select a layer and enter a radius"),!1;const s=r.featureCollection,u=V(s,o*.001,{units:"kilometers"});return!u||u.features.length===0?(alert("No results found"),!1):(t({featureCollection:u,name:i}),!0)};return e.jsxs(L,{buttonLabel:"Buffer",onFormSubmit:n,children:["selected layer: ",r==null?void 0:r.name,e.jsx(w,{selectedLayer:r,setSelectedLayer:l}),"buffer radius [m]: ",o,e.jsx("input",{type:"number",value:o,onChange:s=>a(s.target.value)}),e.jsx("input",{type:"text",value:i,onChange:s=>f(s.target.value)})]})},je=()=>{const{layers:t,addLayer:r}=j(),[l,o]=c.useState(void 0),[a,i]=c.useState("");c.useEffect(()=>{if(l&&l.length>=2){let n=l[0].name;for(let s=1;s<l.length;s++)n+=`, ${l[s].name}`;i(`intersect(${n})`)}},[l]);const f=()=>{if(!l||l.length<2)return alert("Please select two layers"),!1;const n={type:"FeatureCollection",features:l[0].featureCollection.features};for(let s=1;s<l.length;s++){const u=l[s].featureCollection,d=[];n.features.forEach(p=>{u.features.forEach(b=>{const y=A({type:"FeatureCollection",features:[p,b]});y&&d.push(y)})}),n.features=d}return!n||n.features.length===0?(alert("No results found"),!1):(r({featureCollection:n,name:a}),!0)};return e.jsxs(L,{buttonLabel:"Intersect",onFormSubmit:f,children:[e.jsx(T,{isMulti:!0,options:t.filter(n=>n.renderingType==="fill").map(n=>({value:n.id,label:n.name,color:n.color})),value:l==null?void 0:l.map(n=>({value:n.id,label:n.name,color:n.color})),onChange:n=>o(n==null?void 0:n.map(s=>t.find(u=>u.id===s.value))),styles:{control:n=>({...n,backgroundColor:"white",border:"1px solid #ccc",boxShadow:"none","&:hover":{border:"1px solid #aaa"}}),multiValue:(n,s)=>({...n,backgroundColor:`hsl(${s.data.color.h},${s.data.color.s}%,${s.data.color.l}%)`,opacity:s.isFocused?.8:1}),option:(n,s)=>({...n,backgroundColor:`hsl(${s.data.color.h},${s.data.color.s}%,${s.data.color.l}%)`,opacity:s.isFocused?.8:1,color:"white"})}}),e.jsx("input",{type:"text",value:a,onChange:n=>i(n.target.value)})]})},ve=()=>{const{layers:t,addLayer:r}=j(),[l,o]=c.useState(void 0),[a,i]=c.useState("");c.useEffect(()=>{if(l&&l.length>=2){let n=l[0].name;for(let s=1;s<l.length;s++)n+=`, ${l[s].name}`;i(`union(${n})`)}},[l]);const f=()=>{if(!l||l.length<2)return alert("Please select two layers"),!1;const n=l.flatMap(u=>u.featureCollection.features),s=ie({type:"FeatureCollection",features:n});return s?(r({featureCollection:{type:"FeatureCollection",features:[s]},name:a}),!0):(alert("No results found"),!1)};return e.jsxs(L,{buttonLabel:"Union",onFormSubmit:f,children:[e.jsx(T,{isMulti:!0,options:t.filter(n=>n.renderingType==="fill").map(n=>({value:n.id,label:n.name,color:n.color})),value:l==null?void 0:l.map(n=>({value:n.id,label:n.name,color:n.color})),onChange:n=>o(n==null?void 0:n.map(s=>t.find(u=>u.id===s.value))),styles:{control:n=>({...n,backgroundColor:"white",border:"1px solid #ccc",boxShadow:"none","&:hover":{border:"1px solid #aaa"}}),multiValue:(n,s)=>({...n,backgroundColor:`hsl(${s.data.color.h},${s.data.color.s}%,${s.data.color.l}%)`,opacity:s.isFocused?.8:1}),option:(n,s)=>({...n,backgroundColor:`hsl(${s.data.color.h},${s.data.color.s}%,${s.data.color.l}%)`,opacity:s.isFocused?.8:1,color:"white"})}}),e.jsx("input",{type:"text",value:a,onChange:n=>i(n.target.value)})]})},Ce=()=>{const{addLayer:t}=j(),[r,l]=c.useState(void 0),[o,a]=c.useState(void 0),[i,f]=c.useState("");c.useEffect(()=>{r&&o&&f(`difference(${r.name}, ${o.name})`)},[r,o]);const n=()=>{if(!r||!o)return alert("Please select two layers"),!1;const s={type:"FeatureCollection",features:[]},u=r.featureCollection,d=o.featureCollection,p=ce(d).features[0];return u.features.forEach(b=>{const y=ue({type:"FeatureCollection",features:[b,p]});y&&s.features.push(y)}),!s||s.features.length===0?(alert("No results found"),!1):(t({featureCollection:s,name:i}),!0)};return e.jsxs(L,{buttonLabel:"Difference",onFormSubmit:n,children:["selected base layer: ",r==null?void 0:r.name,e.jsx(w,{selectedLayer:r,setSelectedLayer:l,renderingType:"fill"}),"selected layer to subtract: ",o==null?void 0:o.name,e.jsx(w,{selectedLayer:o,setSelectedLayer:a,renderingType:"fill",unselectableLayerIds:[r==null?void 0:r.id]}),e.jsx("input",{type:"text",value:i,onChange:s=>f(s.target.value)})]})},Se=()=>{const{addLayer:t}=j(),[r,l]=c.useState(void 0),[o,a]=c.useState(!1),[i,f]=c.useState(void 0),[n,s]=c.useState("");c.useEffect(()=>{r&&s(o&&i?`dissolve(${r.name}, ${i})`:`dissolve(${r.name})`)},[r,o,i]);const u=()=>{if(!r)return alert("Please select a layer"),!1;const d=r.featureCollection,p=o&&i?B($(d),{propertyName:i}):B($(d));return!p||p.features.length===0?(alert("No results found"),!1):(t({featureCollection:p,name:n}),!0)};return e.jsxs(L,{buttonLabel:"Dissolve",onFormSubmit:u,children:["selected layer: ",r==null?void 0:r.name,e.jsx(w,{selectedLayer:r,setSelectedLayer:l,renderingType:"fill"}),e.jsxs("span",{children:[e.jsx("input",{type:"checkbox",checked:o,onChange:d=>a(d.target.checked),id:"checkboxPropertyEnabled"}),e.jsxs("label",{htmlFor:"checkboxPropertyEnabled",children:["dissolve by property: ",o&&i]})]}),e.jsxs("select",{required:!0,disabled:!o,value:i,onChange:d=>f(d.target.value),children:[e.jsx("option",{value:"",children:"Select a property"}),(r==null?void 0:r.featureCollection.features[0].properties)&&Object.keys(r.featureCollection.features[0].properties).map(d=>e.jsx("option",{value:d,children:d},d))]}),e.jsx("input",{type:"text",value:n,onChange:d=>s(d.target.value)})]})},Le=()=>{const{addLayer:t}=j(),[r,l]=c.useState(void 0),[o,a]=c.useState("");c.useEffect(()=>{r&&a(`voronoi(${r.name})`)},[r]);const i=()=>{if(!r)return alert("Please select a layer"),!1;const f=$(r.featureCollection),n=de(f,{bbox:M(f)});return!n||n.features.length===0?(alert("No results found"),!1):(n.features=n.features.filter(s=>s.geometry.type==="Polygon"),t({featureCollection:n,name:o}),!0)};return e.jsxs(L,{buttonLabel:"Voronoi",onFormSubmit:i,children:["selected layer: ",r==null?void 0:r.name,e.jsx(w,{selectedLayer:r,setSelectedLayer:l,renderingType:"circle"}),e.jsx("input",{type:"text",value:o,onChange:f=>a(f.target.value)})]})},Ne=()=>{const{layers:t,addLayer:r}=j(),[l,o]=c.useState(void 0),[a,i]=c.useState("");c.useEffect(()=>{if(l&&l.length>=1){let n=l[0].name;for(let s=1;s<l.length;s++)n+=`, ${l[s].name}`;i(`bbox(${n})`)}},[l]);const f=()=>{if(!l||l.length<1)return alert("Please select one or more layers"),!1;const n=l.flatMap(u=>u.featureCollection.features),s=fe(M({type:"FeatureCollection",features:n}));return s?(r({featureCollection:{type:"FeatureCollection",features:[s]},name:a}),!0):(alert("No results found"),!1)};return e.jsxs(L,{buttonLabel:"Bbox",onFormSubmit:f,children:[e.jsx(T,{isMulti:!0,options:t.map(n=>({value:n.id,label:n.name,color:n.color})),value:l==null?void 0:l.map(n=>({value:n.id,label:n.name,color:n.color})),onChange:n=>o(n==null?void 0:n.map(s=>t.find(u=>u.id===s.value))),styles:{control:n=>({...n,backgroundColor:"white",border:"1px solid #ccc",boxShadow:"none","&:hover":{border:"1px solid #aaa"}}),multiValue:(n,s)=>({...n,backgroundColor:`hsl(${s.data.color.h},${s.data.color.s}%,${s.data.color.l}%)`,opacity:s.isFocused?.8:1}),option:(n,s)=>({...n,backgroundColor:`hsl(${s.data.color.h},${s.data.color.s}%,${s.data.color.l}%)`,opacity:s.isFocused?.8:1,color:"white"})}}),e.jsx("input",{type:"text",value:a,onChange:n=>i(n.target.value)})]})},we=()=>{const{addLayer:t}=j(),[r,l]=c.useState(void 0),[o,a]=c.useState(void 0),[i,f]=c.useState("");c.useEffect(()=>{r&&o&&f(`clip(${o.name}, ${r.name})`)},[o,r]);const n=()=>{if(!r||!o)return alert("Please select two layers"),!1;let s={type:"FeatureCollection",features:[]};if(o.renderingType==="circle")s=me(o.featureCollection,r.featureCollection);else if(o.renderingType==="fill"){const u=r.featureCollection,d=o.featureCollection;u.features.forEach(p=>{d.features.forEach(b=>{const y=A({type:"FeatureCollection",features:[b,p]});y&&s.features.push(y)})})}else if(o.renderingType==="line"){const u=$(r.featureCollection),d=$(o.featureCollection);u.features.forEach(p=>{const b=V(p,.01,{units:"meters"});d.features.forEach(y=>{O(y,b)?s.features.push(y):pe(y,p).features.forEach(v=>{O(v,b)&&s.features.push(v)})})})}else throw new Error("Unknown rendering type");return!s||s.features.length===0?(alert("No results found"),!1):(t({featureCollection:s,name:i}),!0)};return e.jsxs(L,{buttonLabel:"Clip",onFormSubmit:n,children:["selected layer: ",o==null?void 0:o.name,e.jsx(w,{selectedLayer:o,setSelectedLayer:a}),"selected mask layer: ",r==null?void 0:r.name,e.jsx(w,{selectedLayer:r,setSelectedLayer:l,renderingType:"fill",unselectableLayerIds:[o==null?void 0:o.id]}),e.jsx("input",{type:"text",value:i,onChange:s=>f(s.target.value)})]})},ke=()=>e.jsxs(e.Fragment,{children:[e.jsx(ge,{}),e.jsx(je,{}),e.jsx(ve,{}),e.jsx(Ce,{}),e.jsx(Se,{}),e.jsx(Le,{}),e.jsx(Ne,{}),e.jsx(we,{})]}),Pe=({setWidth:t,setOpen:r})=>{const{mapRef:l}=k(),o=c.useRef(null),[a,i]=c.useState(!1),f=u=>{i(!0),u.preventDefault(),u.stopPropagation()},n=c.useCallback(()=>{i(!1),setTimeout(()=>{var u;(u=l.current)==null||u.resize()},1),setTimeout(()=>{var u;(u=l.current)==null||u.resize()},100)},[l]),s=c.useCallback(u=>{var d;a&&((d=l.current)==null||d.resize(),t(u.clientX),u.clientX<100?r(!1):r(!0))},[a,l,t,r]);return c.useEffect(()=>(window.addEventListener("mousemove",s),window.addEventListener("mouseup",n),()=>{window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",n)}),[a,s,n]),e.jsx("div",{className:`resizeHandle ${a?"resizing":""}`,onMouseDown:f,ref:o})},$e=({color:t,onChange:r})=>{const[l,o]=c.useState(!1),a=c.useRef(null);return E(a,()=>{o(!1)}),e.jsxs("div",{className:"colorPicker",ref:a,children:[e.jsx("button",{type:"button",className:"colorPickerButton",onClick:()=>{o(!l)},style:{backgroundColor:`hsl(${t.h},${t.s}%,${t.l}%)`}}),l&&e.jsx("div",{className:"colorPickerPopover",children:e.jsx(Q,{color:t,onChange:i=>{r(i)}})})]})},Ee=({layerId:t,initialLayerName:r,isEditing:l,setIsEditing:o})=>{const{changeLayerName:a}=j(),[i,f]=c.useState(r),n=c.useRef(null);c.useEffect(()=>{l&&n.current&&n.current.focus()},[l,n]);const s=u=>{u==null||u.preventDefault(),a(t,i),o(!1)};return e.jsx("div",{className:"layerNameContainer",children:l?e.jsx("form",{onSubmit:s,children:e.jsx("input",{type:"text",value:i,onChange:u=>f(u.target.value),ref:n,onFocus:()=>o(!0),onBlur:()=>s()})}):e.jsx("div",{children:e.jsx("span",{onDoubleClick:()=>o(!0),children:i})})})},Fe=({layerData:t,layerAboveId:r})=>{const[l,o]=c.useState(!1),a=c.useRef(null);E(a,()=>{o(!1)});const{moveLayerUp:i,moveLayerDown:f,deleteLayer:n,toggleLayerVisibility:s,changeLayerColor:u}=j(),{mapRef:d}=k();c.useEffect(()=>{var m,h,x,S;(m=d.current)!=null&&m.getSource(t.id)||(h=d.current)==null||h.addSource(t.id,{type:"geojson",data:t.featureCollection}),(x=d.current)!=null&&x.getLayer(t.id)||(S=d.current)==null||S.addLayer({id:t.id,type:t.renderingType,source:t.id,paint:t.renderingType==="fill"?{"fill-color":`hsl(${t.color.h},${t.color.s}%,${t.color.l}%)`,"fill-opacity":t.color.a}:t.renderingType==="line"?{"line-color":`hsl(${t.color.h},${t.color.s}%,${t.color.l}%)`,"line-opacity":t.color.a,"line-width":2}:t.renderingType==="circle"?{"circle-color":`hsl(${t.color.h},${t.color.s}%,${t.color.l}%)`,"circle-opacity":t.color.a,"circle-radius":5}:{}})},[d,t]),c.useEffect(()=>{var m;(m=d.current)==null||m.moveLayer(t.id,r)},[r,t.id,d,t.updater]),c.useEffect(()=>{var m;(m=d.current)==null||m.setLayoutProperty(t.id,"visibility",t.visible?"visible":"none")},[t.visible,d,t.id,t.updater]);const p=m=>{var h,x,S,N,R,I;u(t.id,m),t.renderingType==="fill"?((h=d.current)==null||h.setPaintProperty(t.id,"fill-color",`hsl(${m.h},${m.s}%,${m.l}%)`),(x=d.current)==null||x.setPaintProperty(t.id,"fill-opacity",m.a)):t.renderingType==="line"?((S=d.current)==null||S.setPaintProperty(t.id,"line-color",`hsl(${m.h},${m.s}%,${m.l}%)`),(N=d.current)==null||N.setPaintProperty(t.id,"line-opacity",m.a)):t.renderingType==="circle"&&((R=d.current)==null||R.setPaintProperty(t.id,"circle-color",`hsl(${m.h},${m.s}%,${m.l}%)`),(I=d.current)==null||I.setPaintProperty(t.id,"circle-opacity",m.a))},b=()=>{var m,h;(m=d.current)==null||m.removeLayer(t.id),(h=d.current)==null||h.removeSource(t.id),n(t.id)},y=()=>{const m=new Blob([JSON.stringify(t.featureCollection)],{type:"application/geo+json"}),h=URL.createObjectURL(m),x=document.createElement("a");x.href=h,x.download=t.name+".geojson",document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(h)},C=()=>{var h;const m=M(t.featureCollection).slice(0,4);(h=d.current)==null||h.fitBounds(m,{padding:20})},[v,g]=c.useState(!1);return e.jsxs("div",{className:"layerItem",children:[e.jsx($e,{color:t.color,onChange:p}),e.jsx(Ee,{layerId:t.id,initialLayerName:t.name,isEditing:v,setIsEditing:g}),e.jsxs("div",{className:"layerMenu",ref:a,children:[e.jsx("button",{type:"button",onClick:()=>{o(!l)},children:e.jsx(Y,{})}),l&&e.jsx("div",{className:"layerMenuPopover",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:b,children:[e.jsx(_,{})," Delete layer"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:y,children:[e.jsx(D,{})," Download layer"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:C,children:[e.jsx(ee,{})," Zoom to layer"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:m=>{m.stopPropagation(),g(!v)},children:[v?e.jsx(re,{}):e.jsx(te,{})," Edit layer name"]})})]})})]}),e.jsxs("div",{className:"layerMoveControls",children:[e.jsx("button",{type:"button",onClick:()=>i(t.id),children:e.jsx(ne,{})}),e.jsx("button",{type:"button",onClick:()=>f(t.id),children:e.jsx(oe,{})})]}),e.jsx("button",{type:"button",onClick:()=>s(t.id),children:t.visible?e.jsx(U,{}):e.jsx(z,{})})]})},Te=()=>{const{layers:t,moveLayerUp:r,moveLayerDown:l}=j(),[o,a]=c.useState(null),i=(s,u)=>{a(u),s.dataTransfer.setDragImage(new Image,0,0)},f=(s,u)=>{s.preventDefault(),!(o===null||o===u)&&(t.findIndex(d=>d.id===o)<t.findIndex(d=>d.id===u)?l(o):r(o))},n=()=>{a(null)};return e.jsx("ol",{className:"layerList",children:t.map((s,u)=>e.jsx("li",{draggable:!0,className:"layerListItem",onDragStart:d=>i(d,s.id),onDragOver:d=>f(d,s.id),onDrop:n,children:e.jsx(Fe,{layerData:s,layerAboveId:u===0?void 0:t[u-1].id})},s.id))})};function Me(){const[t,r]=c.useState(!0),[l,o]=c.useState(300),{layers:a,addLayer:i,toggleLayerVisibilityAll:f}=j(),{mapRef:n,mapReady:s}=k();c.useEffect(()=>{const d=setInterval(()=>{var p;(p=n.current)==null||p.resize()},1);setTimeout(()=>{clearInterval(d)},1)},[n,t]);const u=d=>{const p=d.target.files;if(!p){console.log("no file selected");return}Array.from(p).forEach(b=>{const y=new FileReader;y.onload=C=>{var v;try{const g=JSON.parse((v=C.target)==null?void 0:v.result);if(g.type!=="FeatureCollection")throw new Error("Not a valid GeoJSON file, must be a FeatureCollection");i({featureCollection:g,name:b.name})}catch(g){console.log(g)}},y.readAsText(b),d.target.value=""})};return e.jsxs("div",{className:"pageContainer",children:[e.jsxs("header",{className:"mainHeader",children:[e.jsx("h1",{children:"μGIS"}),e.jsx("button",{type:"button",onClick:()=>r(!t),children:"Sidebar"}),e.jsx(ke,{}),e.jsx(xe,{})]}),e.jsxs("main",{className:"mainContainer",children:[e.jsxs("div",{className:`sidebarContainer ${t?"open":""}`,children:[e.jsx(Pe,{setWidth:o,setOpen:r}),e.jsxs("aside",{className:"sidebar",style:{width:`${l}px`},children:[e.jsx("h2",{children:"Sidebar"}),e.jsx("button",{type:"button",onClick:f,children:a.every(d=>d.visible)?e.jsx(U,{}):e.jsx(z,{})}),e.jsx("div",{className:"layerListContainer",children:s&&e.jsx(Te,{})}),e.jsxs("div",{className:"sidebarFooter",children:[e.jsxs("label",{htmlFor:"layerFileInput",children:[e.jsx(se,{}),"Upload GeoJSON file"]}),e.jsx("input",{id:"layerFileInput",type:"file",multiple:!0,accept:".geojson",onChange:u})]})]})]}),e.jsx("div",{className:"mapFlexContainer",children:e.jsx(he,{})})]})]})}le.createRoot(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsx(Me,{})}));

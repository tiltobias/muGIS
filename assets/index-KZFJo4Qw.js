import{c as M,r as a,j as t,a as T,E as F,T as $,F as B,Z as I,P as U,b as z,C as A,d as G,e as E,f as O,M as J,S as V,g as Z,h as q,i as H,G as W,U as X,k as _}from"./vendor-react-CMZc712D.js";import{m as N,M as K}from"./vendor-mapbox-CETUCrzD.js";import{b as Q,i as Y,a as D}from"./vendor-turf-ZY3aDcbg.js";import"./vendor-C94V4G80.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(n){if(n.ep)return;n.ep=!0;const l=r(n);fetch(n.href,l)}})();const C=M(e=>({mapRef:a.createRef(),setMapRef:s=>e({mapRef:s}),mapReady:!1,setMapReady:s=>e({mapReady:s}),basemap:{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"},setBasemap:s=>e(r=>s.url===r.basemap.url?{}:{basemap:s}),resetMapStore:()=>e(()=>({mapReady:!1,basemap:{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"}}))})),S=M(e=>({layers:[],resetLayerStore:()=>e(()=>({layers:[]})),loadProjectLayers:s=>e(()=>({layers:s})),addLayer:s=>e(r=>{const o=f=>r.layers.some(d=>d.id===f)?o(f+"1"):f,n=s.featureCollection.features[0].geometry.type,l=n==="Polygon"||n==="MultiPolygon"?"fill":n==="LineString"||n==="MultiLineString"?"line":n==="Point"||n==="MultiPoint"?"circle":null;if(!l)throw new Error("Unsupported geometry type: "+n);s.name||(s.name=l==="fill"?"polygon layer":l==="line"?"line layer":l==="circle"?"point layer":"not possible");const c={h:Math.floor(Math.random()*360),s:90,l:48,a:l==="fill"?.7:1};return{layers:[{featureCollection:s.featureCollection,id:o(s.name),name:s.name,renderingType:l,visible:!0,color:c},...r.layers]}}),moveLayerUp:s=>e(r=>{const o=r.layers.findIndex(l=>l.id===s);if(o===0)return r;const n=[...r.layers];return n.splice(o-1,0,n.splice(o,1)[0]),{layers:n}}),moveLayerDown:s=>e(r=>{const o=r.layers.findIndex(l=>l.id===s);if(o===r.layers.length-1)return r;const n=[...r.layers];return n.splice(o+1,0,n.splice(o,1)[0]),{layers:n}}),deleteLayer:s=>e(r=>({layers:r.layers.filter(o=>o.id!==s)})),toggleLayerVisibility:s=>e(r=>({layers:r.layers.map(o=>o.id===s?{...o,visible:!o.visible}:o)})),toggleLayerVisibilityAll:()=>e(s=>{const r=s.layers.every(o=>o.visible);return{layers:s.layers.map(o=>({...o,visible:!r}))}}),changeLayerColor:(s,r)=>e(o=>({layers:o.layers.map(n=>n.id===s?{...n,color:r}:n)})),updateAllLayers:()=>e(s=>({layers:s.layers.map(r=>({...r,updater:r.updater?r.updater+1:1}))})),changeLayerName:(s,r)=>e(o=>({layers:o.layers.map(n=>n.id===s?{...n,name:r}:n)}))}));N.accessToken="pk.eyJ1IjoidG9iaWFuZCIsImEiOiJjbTdiMGZwemwwNmxlMnFyNTV4YWh2ZzB3In0.B3fVZMQOYEs2V23kKWB5XQ";const ee=()=>{const{mapRef:e,mapReady:s,setMapReady:r,basemap:o}=C(),{addLayer:n,updateAllLayers:l}=S(),c=a.useRef(null);a.useEffect(()=>{var u,b,x,j,g,i;if(!s&&c.current){c.current.innerHTML="",e.current=new N.Map({container:c.current,style:o.url,center:[10.4,63.425],zoom:12}),(u=e.current)==null||u.addControl(new N.FullscreenControl,"top-right"),(b=e.current)==null||b.addControl(new N.NavigationControl({visualizePitch:!0}),"top-right"),(x=e.current)==null||x.addControl(new N.ScaleControl,"bottom-right");const y=new K({displayControlsDefault:!1,controls:{point:!0,line_string:!0,polygon:!0},boxSelect:!1});(j=e.current)==null||j.addControl(y,"bottom-left"),(g=e.current)==null||g.on("draw.create",()=>{n({featureCollection:y.getAll(),name:null}),y.deleteAll()}),(i=e.current)==null||i.on("style.load",()=>{r(!0)})}},[e,n,s,r,o]);const[h,f]=a.useState(!1),d=a.useRef(o),[m,p]=a.useState(o);return a.useEffect(()=>{var u;d.current.url!==o.url&&(d.current=o),!h&&m.url!==d.current.url&&(f(!0),s&&e.current&&(e.current.setStyle(d.current.url),p(o)),(u=e.current)==null||u.once("style.load",()=>{l()}),setTimeout(()=>{f(!1)},200))},[o,e,s,h,m,l]),t.jsx("div",{ref:c,className:"mapContainer"})},P=(e,s,r=[])=>{a.useEffect(()=>{const o=n=>{const l=n.target;e.current&&!e.current.contains(l)&&!r.some(c=>{var h;return(h=c.current)==null?void 0:h.contains(l)})&&s()};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}},[e,s,r])},te=({color:e,onChange:s})=>{const[r,o]=a.useState(!1),n=a.useRef(null);return P(n,()=>{o(!1)}),t.jsxs("div",{className:"colorPicker",ref:n,children:[t.jsx("button",{type:"button",className:"colorPickerButton",onClick:()=>{o(!r)},style:{backgroundColor:`hsl(${e.h},${e.s}%,${e.l}%)`}}),r&&t.jsx("div",{className:"colorPickerPopover",children:t.jsx(T,{color:e,onChange:l=>{s(l)}})})]})},ne=({layerId:e,initialLayerName:s,isEditing:r,setIsEditing:o})=>{const{changeLayerName:n}=S(),[l,c]=a.useState(s),h=a.useRef(null);a.useEffect(()=>{r&&h.current&&h.current.focus()},[r,h]);const f=d=>{d==null||d.preventDefault(),n(e,l),o(!1)};return t.jsx("div",{className:"layerNameContainer",children:r?t.jsx("form",{onSubmit:f,children:t.jsx("input",{type:"text",value:l,onChange:d=>c(d.target.value),ref:h,onFocus:()=>o(!0),onBlur:()=>f()})}):t.jsx("div",{children:t.jsx("span",{onDoubleClick:()=>o(!0),children:l})})})},se=({layerData:e,layerAboveId:s})=>{const[r,o]=a.useState(!1),n=a.useRef(null);P(n,()=>{o(!1)});const{moveLayerUp:l,moveLayerDown:c,deleteLayer:h,toggleLayerVisibility:f,changeLayerColor:d}=S(),{mapRef:m}=C();a.useEffect(()=>{var i,y,v,L;(i=m.current)!=null&&i.getSource(e.id)||(y=m.current)==null||y.addSource(e.id,{type:"geojson",data:e.featureCollection}),(v=m.current)!=null&&v.getLayer(e.id)||(L=m.current)==null||L.addLayer({id:e.id,type:e.renderingType,source:e.id,paint:e.renderingType==="fill"?{"fill-color":`hsl(${e.color.h},${e.color.s}%,${e.color.l}%)`,"fill-opacity":e.color.a}:e.renderingType==="line"?{"line-color":`hsl(${e.color.h},${e.color.s}%,${e.color.l}%)`,"line-opacity":e.color.a,"line-width":2}:e.renderingType==="circle"?{"circle-color":`hsl(${e.color.h},${e.color.s}%,${e.color.l}%)`,"circle-opacity":e.color.a,"circle-radius":5}:{}})},[m,e]),a.useEffect(()=>{var i;(i=m.current)==null||i.moveLayer(e.id,s)},[s,e.id,m,e.updater]),a.useEffect(()=>{var i;(i=m.current)==null||i.setLayoutProperty(e.id,"visibility",e.visible?"visible":"none")},[e.visible,m,e.id,e.updater]);const p=i=>{var y,v,L,k,w,R;d(e.id,i),e.renderingType==="fill"?((y=m.current)==null||y.setPaintProperty(e.id,"fill-color",`hsl(${i.h},${i.s}%,${i.l}%)`),(v=m.current)==null||v.setPaintProperty(e.id,"fill-opacity",i.a)):e.renderingType==="line"?((L=m.current)==null||L.setPaintProperty(e.id,"line-color",`hsl(${i.h},${i.s}%,${i.l}%)`),(k=m.current)==null||k.setPaintProperty(e.id,"line-opacity",i.a)):e.renderingType==="circle"&&((w=m.current)==null||w.setPaintProperty(e.id,"circle-color",`hsl(${i.h},${i.s}%,${i.l}%)`),(R=m.current)==null||R.setPaintProperty(e.id,"circle-opacity",i.a))},u=()=>{var i,y;(i=m.current)==null||i.removeLayer(e.id),(y=m.current)==null||y.removeSource(e.id),h(e.id)},b=()=>{const i=new Blob([JSON.stringify(e.featureCollection)],{type:"application/geo+json"}),y=URL.createObjectURL(i),v=document.createElement("a");v.href=y,v.download=e.id+".geojson",document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(y)},x=()=>{var y;const i=Q(e.featureCollection).slice(0,4);(y=m.current)==null||y.fitBounds(i,{padding:20})},[j,g]=a.useState(!1);return t.jsx("li",{className:"layerListItem",children:t.jsxs("div",{className:"layerItem",children:[t.jsx(te,{color:e.color,onChange:p}),t.jsx(ne,{layerId:e.id,initialLayerName:e.name,isEditing:j,setIsEditing:g}),t.jsxs("div",{className:"layerMenu",ref:n,children:[t.jsx("button",{type:"button",onClick:()=>{o(!r)},children:t.jsx(F,{})}),r&&t.jsx("div",{className:"layerMenuPopover",children:t.jsxs("ul",{children:[t.jsx("li",{children:t.jsx("button",{type:"button",onClick:u,children:t.jsx($,{})})}),t.jsx("li",{children:t.jsx("button",{type:"button",onClick:b,children:t.jsx(B,{})})}),t.jsx("li",{children:t.jsx("button",{type:"button",onClick:x,children:t.jsx(I,{})})}),t.jsx("li",{children:t.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),g(!j)},children:j?t.jsx(z,{}):t.jsx(U,{})})})]})})]}),t.jsxs("div",{className:"layerMoveControls",children:[t.jsx("button",{type:"button",onClick:()=>l(e.id),children:t.jsx(A,{})}),t.jsx("button",{type:"button",onClick:()=>c(e.id),children:t.jsx(G,{})})]}),t.jsx("button",{type:"button",onClick:()=>f(e.id),children:e.visible?t.jsx(E,{}):t.jsx(O,{})})]})})},re=()=>{const[e,s]=a.useState(!1),r=a.useRef(null);P(r,()=>{s(!1)});const[o,n]=a.useState(null),{basemap:l,setBasemap:c}=C(),h=[{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"},{url:"mapbox://styles/mapbox/outdoors-v12",name:"Outdoors"},{url:"mapbox://styles/mapbox/light-v11",name:"Light"},{url:"mapbox://styles/mapbox/dark-v11",name:"Dark"},{url:"mapbox://styles/mapbox/satellite-v9",name:"Satellite"},{url:"mapbox://styles/mapbox/satellite-streets-v12",name:"Satellite Streets"},{url:"mapbox://styles/mapbox/navigation-day-v1",name:"Navigation Day"},{url:"mapbox://styles/mapbox/navigation-night-v1",name:"Navigation Night"},{url:"mapbox://styles/tobiand/cm8rbg7j900be01sa5wc6d4lq",name:"Off (white)"},{url:"mapbox://styles/tobiand/cm8rbd89l00az01sb97a8hfyh",name:"Off (black)"}];return t.jsxs("div",{className:"basemap",ref:r,children:[t.jsxs("button",{type:"button",onClick:()=>s(!e),children:[t.jsx(J,{})," Change basemap"]}),e&&t.jsx("div",{className:"basemapPopover",children:t.jsx("ul",{onMouseEnter:()=>{n(l)},onMouseLeave:()=>{c(o),n(null)},children:h.map(f=>t.jsx("li",{children:t.jsxs("button",{type:"button",onClick:()=>{n(f)},onMouseEnter:()=>{c(f)},children:[o===null&&f.name===l.name||o!==null&&f.name===o.name?"*":"",f.name]})},f.name))})})]})},oe=()=>{const[e,s]=a.useState(!1),r=a.useRef(null);P(r,()=>{s(!1)});const{layers:o,resetLayerStore:n,loadProjectLayers:l}=S(),{basemap:c,setBasemap:h,resetMapStore:f}=C(),d=()=>{n(),f()},m=()=>{const x={layers:o,basemap:c},j=new Blob([JSON.stringify(x)],{type:"application/json"}),g=URL.createObjectURL(j),i=document.createElement("a");i.href=g,i.download="μGIS_project.mugis",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(g)},p=a.useRef(null),u=()=>{var x;(x=p.current)==null||x.click()},b=x=>{const j=x.target.files;if(!j){console.log("no file selected");return}const g=new FileReader;g.onload=i=>{var y;try{const v=JSON.parse((y=i.target)==null?void 0:y.result);l(v.layers),h(v.basemap)}catch(v){console.log(v)}},g.readAsText(j[0])};return t.jsxs("div",{className:"settings",ref:r,children:[t.jsx("button",{type:"button",onClick:()=>{s(!e)},children:t.jsx(V,{})}),e&&t.jsx("div",{className:"settingsPopover",children:t.jsxs("ul",{children:[t.jsx("li",{children:t.jsxs("button",{type:"button",onClick:d,children:[t.jsx(Z,{})," New project"]})}),t.jsx("li",{children:t.jsxs("button",{type:"button",onClick:m,children:[t.jsx(q,{})," Save project"]})}),t.jsxs("li",{children:[t.jsx("input",{ref:p,type:"file",accept:".mugis",onChange:b}),t.jsxs("button",{type:"button",onClick:u,children:[t.jsx(H,{})," Load project"]})]}),t.jsx("li",{children:t.jsx(re,{})}),t.jsx("li",{children:t.jsxs("button",{type:"button",onClick:()=>{},children:[t.jsx(W,{})," Start tutorial"]})})]})})]})},le=({children:e,buttonLabel:s,onFormSubmit:r})=>{const[o,n]=a.useState(!1);return t.jsxs("div",{children:[t.jsx("button",{type:"button",onClick:()=>{n(!o)},children:s}),o&&t.jsx("div",{className:"cover",onClick:l=>{l.target===l.currentTarget&&n(!1)},children:t.jsx("div",{className:"modal",children:t.jsxs("form",{onSubmit:l=>{if(l.preventDefault(),r())n(!1);else return},children:[t.jsx("h3",{children:s}),e,t.jsx("button",{type:"button",onClick:()=>{n(!1)},children:"Close"}),t.jsx("button",{type:"submit",children:"Submit"})]})})})]})},ie=()=>{const{layers:e,addLayer:s}=S(),[r,o]=a.useState([]);a.useEffect(()=>{o(e.filter(p=>p.renderingType==="fill").map(({id:p,name:u,renderingType:b})=>({id:p,name:u,renderingType:b})))},[e]);const[n,l]=a.useState(null),[c,h]=a.useState(null),[f,d]=a.useState("");a.useEffect(()=>{n&&c&&d(`intersect: ${n.name} & ${c.name}`)},[n,c]);const m=()=>{if(!n||!c)return alert("Please select two layers"),!1;const p={type:"FeatureCollection",features:[]},u=n.featureCollection,b=c.featureCollection;return u.features.forEach(x=>{b.features.forEach(j=>{const g=Y({type:"FeatureCollection",features:[x,j]});g&&p.features.push(g)})}),p?(s({featureCollection:p,name:f}),!0):(alert("No intersection found"),!1)};return t.jsxs(le,{buttonLabel:"Intersect",onFormSubmit:m,children:["selected layer1: ",n==null?void 0:n.name,t.jsxs("select",{name:"layer1",id:"",required:!0,value:n==null?void 0:n.id,onChange:p=>{const u=e.find(b=>b.id===p.target.value);l(u||null)},children:[t.jsx("option",{value:void 0,children:"Select a layer"}),r.map(p=>t.jsx("option",{value:p.id,children:p.name},p.id))]}),"selected layer2: ",c==null?void 0:c.name,t.jsxs("select",{name:"layer1",id:"",required:!0,value:c==null?void 0:c.id,onChange:p=>{const u=e.find(b=>b.id===p.target.value);h(u||null)},children:[t.jsx("option",{value:void 0,children:"Select a layer"}),r.filter(p=>p.id!==(n==null?void 0:n.id)).map(p=>t.jsx("option",{value:p.id,children:p.name},p.id))]}),t.jsx("input",{type:"text",value:f,onChange:p=>d(p.target.value)})]})},ae=({setWidth:e,setOpen:s})=>{const{mapRef:r}=C(),o=a.useRef(null),[n,l]=a.useState(!1),c=d=>{l(!0),d.preventDefault(),d.stopPropagation()},h=a.useCallback(()=>{l(!1),setTimeout(()=>{var d;(d=r.current)==null||d.resize()},1),setTimeout(()=>{var d;(d=r.current)==null||d.resize()},100)},[r]),f=a.useCallback(d=>{var m;(m=r.current)==null||m.resize(),n&&(e(d.clientX),d.clientX<100?s(!1):s(!0))},[n,r,e,s]);return a.useEffect(()=>(window.addEventListener("mousemove",f),window.addEventListener("mouseup",h),()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",h)}),[n,f,h]),t.jsx("div",{className:"resizeHandle",onMouseDown:c,ref:o})};function ce(){const[e,s]=a.useState(!0),{layers:r,addLayer:o,toggleLayerVisibilityAll:n}=S(),{mapRef:l,mapReady:c}=C(),h=()=>{s(!e),setTimeout(()=>{var u;(u=l.current)==null||u.resize()},1),setTimeout(()=>{var u;(u=l.current)==null||u.resize()},100)},f=u=>{const b=u.target.files;if(!b){console.log("no file selected");return}Array.from(b).forEach(x=>{const j=new FileReader;j.onload=g=>{var i;try{const y=JSON.parse((i=g.target)==null?void 0:i.result);if(y.type!=="FeatureCollection")throw new Error("Not a valid GeoJSON file, must be a FeatureCollection");o({featureCollection:y,name:x.name})}catch(y){console.log(y)}},j.readAsText(x)})},d=()=>{const u=r[0],b=D(u.featureCollection,.05);b?o({featureCollection:b,name:u.name+"_buffer"}):console.error("Buffer operation failed")},[m,p]=a.useState(300);return t.jsxs("div",{className:"pageContainer",children:[t.jsxs("header",{className:"mainHeader",children:[t.jsx("h1",{children:"μGIS"}),t.jsx("button",{type:"button",onClick:h,children:"Sidebar"}),t.jsx("button",{type:"button",onClick:d,children:"Buffer"}),t.jsx(ie,{}),t.jsx(oe,{})]}),t.jsxs("main",{className:"mainContainer",children:[t.jsxs("div",{className:`sidebarContainer ${e?"open":""}`,children:[t.jsx(ae,{setWidth:p,setOpen:s}),t.jsxs("aside",{className:"sidebar",style:{width:`${m}px`},children:[t.jsx("h2",{children:"Sidebar"}),t.jsx("button",{type:"button",onClick:n,children:r.every(u=>u.visible)?t.jsx(E,{}):t.jsx(O,{})}),t.jsx("div",{className:"layerListContainer",children:c&&t.jsx("ol",{className:"layerList",children:r.map((u,b)=>t.jsx(se,{layerData:u,layerAboveId:b===0?void 0:r[b-1].id},u.id))})}),t.jsxs("div",{className:"sidebarFooter",children:[t.jsxs("label",{htmlFor:"layerFileInput",children:[t.jsx(X,{}),"Upload GeoJSON file"]}),t.jsx("input",{id:"layerFileInput",type:"file",multiple:!0,accept:".geojson",onChange:f})]})]})]}),t.jsx("div",{className:"mapFlexContainer",children:t.jsx(ee,{})})]})]})}_.createRoot(document.getElementById("root")).render(t.jsx(a.StrictMode,{children:t.jsx(ce,{})}));

import{e as F,f as c,j as e,M as z,S as A,F as W,h as G,k as H,l as J,m as Z,G as q,n as M,o as X,E as K,T as Q,q as Y,Z as _,P as D,t as ee,w as B,x as O,U as te,y as re}from"./vendor-BycCkqXq.js";import{m as P,M as ne}from"./vendor-mapbox-B-2qnAHL.js";import{b as U,i as V,u as oe,c as se,d as le,a as R,f as $,v as ae,e as T,g as ie,p as ce,h as I,l as ue}from"./vendor-turf-Cd3MU2FC.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function l(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=l(a);fetch(a.href,i)}})();const N=F(t=>({mapRef:c.createRef(),setMapRef:r=>t({mapRef:r}),mapReady:!1,setMapReady:r=>t({mapReady:r}),basemap:{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"},setBasemap:r=>t(l=>r.url===l.basemap.url?l:{basemap:r}),resetMapStore:()=>t(()=>({mapReady:!1,basemap:{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"}}))})),j=F(t=>({layers:[],resetLayerStore:()=>t(()=>({layers:[]})),loadProjectLayers:r=>t(()=>({layers:r})),addLayer:r=>t(l=>{const o=n=>l.layers.some(d=>d.id===n)?o(n+"1"):n,a=r.featureCollection.features[0].geometry.type,i=a==="Polygon"||a==="MultiPolygon"?"fill":a==="LineString"||a==="MultiLineString"?"line":a==="Point"||a==="MultiPoint"?"circle":null;if(!i)throw new Error("Unsupported geometry type: "+a);r.name||(r.name=i==="fill"?"polygon layer":i==="line"?"line layer":i==="circle"?"point layer":"not possible");const u={h:Math.floor(Math.random()*360),s:90,l:48,a:i==="fill"?.7:1};return{layers:[{featureCollection:r.featureCollection,id:o(r.name),name:r.name,renderingType:i,visible:!0,color:u},...l.layers]}}),moveLayerUp:r=>t(l=>{const o=l.layers.findIndex(i=>i.id===r);if(o===0)return l;const a=[...l.layers];return a.splice(o-1,0,a.splice(o,1)[0]),{layers:a}}),moveLayerDown:r=>t(l=>{const o=l.layers.findIndex(i=>i.id===r);if(o===l.layers.length-1)return l;const a=[...l.layers];return a.splice(o+1,0,a.splice(o,1)[0]),{layers:a}}),deleteLayer:r=>t(l=>({layers:l.layers.filter(o=>o.id!==r)})),toggleLayerVisibility:r=>t(l=>({layers:l.layers.map(o=>o.id===r?{...o,visible:!o.visible}:o)})),toggleLayerVisibilityAll:()=>t(r=>{const l=r.layers.every(o=>o.visible);return{layers:r.layers.map(o=>({...o,visible:!l}))}}),changeLayerColor:(r,l)=>t(o=>({layers:o.layers.map(a=>a.id===r?{...a,color:l}:a)})),updateAllLayers:()=>t(r=>({layers:r.layers.map(l=>({...l,updater:l.updater?l.updater+1:1}))})),changeLayerName:(r,l)=>t(o=>({layers:o.layers.map(a=>a.id===r?{...a,name:l}:a)}))}));P.accessToken="pk.eyJ1IjoidG9iaWFuZCIsImEiOiJjbTdiMGZwemwwNmxlMnFyNTV4YWh2ZzB3In0.B3fVZMQOYEs2V23kKWB5XQ";const de=()=>{const{mapRef:t,mapReady:r,setMapReady:l,basemap:o}=N(),{addLayer:a,updateAllLayers:i}=j(),u=c.useRef(null);c.useEffect(()=>{var m,h,v,p,x,b;if(!r&&u.current){u.current.innerHTML="",t.current=new P.Map({container:u.current,style:o.url,center:[10.4,63.425],zoom:12}),(m=t.current)==null||m.addControl(new P.FullscreenControl,"top-right"),(h=t.current)==null||h.addControl(new P.NavigationControl({visualizePitch:!0}),"top-right"),(v=t.current)==null||v.addControl(new P.ScaleControl,"bottom-right");const g=new ne({displayControlsDefault:!1,controls:{point:!0,line_string:!0,polygon:!0},boxSelect:!1});(p=t.current)==null||p.addControl(g,"bottom-left"),(x=t.current)==null||x.on("draw.create",()=>{a({featureCollection:g.getAll(),name:null}),g.deleteAll()}),(b=t.current)==null||b.on("style.load",()=>{l(!0)})}},[t,a,r,l,o]);const[s,n]=c.useState(!1),d=c.useRef(o),[f,y]=c.useState(o);return c.useEffect(()=>{var m;d.current.url!==o.url&&(d.current=o),!s&&f.url!==d.current.url&&(n(!0),r&&t.current&&(t.current.setStyle(d.current.url),y(o)),(m=t.current)==null||m.once("style.load",()=>{i()}),setTimeout(()=>{n(!1)},200))},[o,t,r,s,f,i]),e.jsx("div",{ref:u,className:"mapContainer"})},E=(t,r,l=[])=>{c.useEffect(()=>{const o=a=>{const i=a.target;t.current&&!t.current.contains(i)&&!l.some(u=>{var s;return(s=u.current)==null?void 0:s.contains(i)})&&r()};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}},[t,r,l])},fe=()=>{const[t,r]=c.useState(!1),l=c.useRef(null);E(l,()=>{r(!1)});const[o,a]=c.useState(null),{basemap:i,setBasemap:u}=N(),s=[{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"},{url:"mapbox://styles/mapbox/outdoors-v12",name:"Outdoors"},{url:"mapbox://styles/mapbox/light-v11",name:"Light"},{url:"mapbox://styles/mapbox/dark-v11",name:"Dark"},{url:"mapbox://styles/mapbox/satellite-v9",name:"Satellite"},{url:"mapbox://styles/mapbox/satellite-streets-v12",name:"Satellite Streets"},{url:"mapbox://styles/mapbox/navigation-day-v1",name:"Navigation Day"},{url:"mapbox://styles/mapbox/navigation-night-v1",name:"Navigation Night"},{url:"mapbox://styles/tobiand/cm8rbg7j900be01sa5wc6d4lq",name:"Off (white)"},{url:"mapbox://styles/tobiand/cm8rbd89l00az01sb97a8hfyh",name:"Off (black)"}];return e.jsxs("div",{className:"basemap",ref:l,children:[e.jsxs("button",{type:"button",onClick:()=>r(!t),children:[e.jsx(z,{})," Change basemap"]}),t&&e.jsx("div",{className:"basemapPopover",children:e.jsx("ul",{onMouseEnter:()=>{a(i)},onMouseLeave:()=>{u(o),a(null)},children:s.map(n=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{a(n)},onMouseEnter:()=>{u(n)},children:[o===null&&n.name===i.name||o!==null&&n.name===o.name?"*":"",n.name]})},n.name))})})]})},me=F(t=>({theme:localStorage.getItem("theme")||"light",setTheme:r=>t(l=>(localStorage.setItem("theme",r),r===l.theme?l:{theme:r}))})),pe=()=>{const[t,r]=c.useState(!1),l=c.useRef(null);E(l,()=>{r(!1)});const{layers:o,resetLayerStore:a,loadProjectLayers:i}=j(),{basemap:u,setBasemap:s,resetMapStore:n}=N(),{theme:d,setTheme:f}=me(),y=()=>{a(),n()},m=()=>{const x={layers:o,basemap:u},b=new Blob([JSON.stringify(x)],{type:"application/json"}),g=URL.createObjectURL(b),C=document.createElement("a");C.href=g,C.download="μGIS_project.mugis",document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(g)},h=c.useRef(null),v=()=>{var x;(x=h.current)==null||x.click()},p=x=>{const b=x.target.files;if(!b){console.log("no file selected");return}const g=new FileReader;g.onload=C=>{var k;try{const L=JSON.parse((k=C.target)==null?void 0:k.result);i(L.layers),s(L.basemap)}catch(L){console.log(L)}},g.readAsText(b[0])};return c.useEffect(()=>{document.documentElement.setAttribute("data-theme",d)},[d]),e.jsxs("div",{className:"settings",ref:l,children:[e.jsx("button",{type:"button",onClick:()=>{r(!t)},children:e.jsx(A,{})}),t&&e.jsx("div",{className:"settingsPopover",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:y,children:[e.jsx(W,{})," New project"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:m,children:[e.jsx(G,{})," Save project"]})}),e.jsxs("li",{children:[e.jsx("input",{ref:h,type:"file",accept:".mugis",onChange:p}),e.jsxs("button",{type:"button",onClick:v,children:[e.jsx(H,{})," Load project"]})]}),e.jsx("li",{children:e.jsx(fe,{})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{f(d==="light"?"dark":"light")},children:[d==="light"?e.jsx(J,{}):e.jsx(Z,{})," Toggle theme"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{},children:[e.jsx(q,{})," Start tutorial"]})})]})})]})},S=({children:t,buttonLabel:r,onFormSubmit:l})=>{const[o,a]=c.useState(!1),[i,u]=c.useState(!1);return e.jsxs("div",{children:[e.jsx("button",{type:"button",onClick:()=>a(!o),children:r}),o&&e.jsx("div",{className:"cover",onClick:s=>{s.target===s.currentTarget&&a(!1)},children:e.jsx("div",{className:"modal"+(i?" loading":""),children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),u(!0),setTimeout(()=>{l()&&a(!1),u(!1)},0)},children:[e.jsx("h3",{children:r}),t,e.jsx("button",{type:"button",onClick:()=>a(!1),children:"Close"}),e.jsx("button",{type:"submit",children:"Submit"})]})})})]})},w=({selectedLayer:t,setSelectedLayer:r,renderingType:l=void 0,unselectableLayerIds:o=[]})=>{const{layers:a}=j();return e.jsxs("select",{required:!0,value:t==null?void 0:t.id,onChange:i=>r(a.find(u=>u.id===i.target.value)),children:[e.jsx("option",{value:void 0,children:"Select a layer1"}),a.filter(i=>l?i.renderingType===l:!0).filter(i=>!o.includes(i.id)).map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})},he=()=>{const{addLayer:t}=j(),[r,l]=c.useState(void 0),[o,a]=c.useState(""),[i,u]=c.useState("");c.useEffect(()=>{r&&u(`buffer(${r.name}, ${o}m)`)},[r,o]);const s=()=>{if(!r||o==="")return alert("Please select a layer and enter a radius"),!1;const n=r.featureCollection,d=U(n,o*.001,{units:"kilometers"});return!d||d.features.length===0?(alert("No results found"),!1):(t({featureCollection:d,name:i}),!0)};return e.jsxs(S,{buttonLabel:"Buffer",onFormSubmit:s,children:["selected layer: ",r==null?void 0:r.name,e.jsx(w,{selectedLayer:r,setSelectedLayer:l}),"buffer radius [m]: ",o,e.jsx("input",{type:"number",value:o,onChange:n=>a(n.target.value)}),e.jsx("input",{type:"text",value:i,onChange:n=>u(n.target.value)})]})},ye=()=>{const{layers:t,addLayer:r}=j(),[l,o]=c.useState(void 0),[a,i]=c.useState("");c.useEffect(()=>{if(l&&l.length>=2){let s=l[0].name;for(let n=1;n<l.length;n++)s+=`, ${l[n].name}`;i(`intersect(${s})`)}},[l]);const u=()=>{if(!l||l.length<2)return alert("Please select two layers"),!1;const s={type:"FeatureCollection",features:l[0].featureCollection.features};for(let n=1;n<l.length;n++){const d=l[n].featureCollection,f=[];s.features.forEach(y=>{d.features.forEach(m=>{const h=V({type:"FeatureCollection",features:[y,m]});h&&f.push(h)})}),s.features=f}return!s||s.features.length===0?(alert("No results found"),!1):(r({featureCollection:s,name:a}),!0)};return e.jsxs(S,{buttonLabel:"Intersect",onFormSubmit:u,children:[e.jsx(M,{isMulti:!0,options:t.filter(s=>s.renderingType==="fill").map(s=>({value:s.id,label:s.name,color:s.color})),value:l==null?void 0:l.map(s=>({value:s.id,label:s.name,color:s.color})),onChange:s=>o(s==null?void 0:s.map(n=>t.find(d=>d.id===n.value))),styles:{control:s=>({...s,backgroundColor:"white",border:"1px solid #ccc",boxShadow:"none","&:hover":{border:"1px solid #aaa"}}),multiValue:(s,n)=>({...s,backgroundColor:`hsl(${n.data.color.h},${n.data.color.s}%,${n.data.color.l}%)`,opacity:n.isFocused?.8:1}),option:(s,n)=>({...s,backgroundColor:`hsl(${n.data.color.h},${n.data.color.s}%,${n.data.color.l}%)`,opacity:n.isFocused?.8:1,color:"white"})}}),e.jsx("input",{type:"text",value:a,onChange:s=>i(s.target.value)})]})},xe=()=>{const{layers:t,addLayer:r}=j(),[l,o]=c.useState(void 0),[a,i]=c.useState("");c.useEffect(()=>{if(l&&l.length>=2){let s=l[0].name;for(let n=1;n<l.length;n++)s+=`, ${l[n].name}`;i(`union(${s})`)}},[l]);const u=()=>{if(!l||l.length<2)return alert("Please select two layers"),!1;const s=l.flatMap(d=>d.featureCollection.features),n=oe({type:"FeatureCollection",features:s});return n?(r({featureCollection:{type:"FeatureCollection",features:[n]},name:a}),!0):(alert("No results found"),!1)};return e.jsxs(S,{buttonLabel:"Union",onFormSubmit:u,children:[e.jsx(M,{isMulti:!0,options:t.filter(s=>s.renderingType==="fill").map(s=>({value:s.id,label:s.name,color:s.color})),value:l==null?void 0:l.map(s=>({value:s.id,label:s.name,color:s.color})),onChange:s=>o(s==null?void 0:s.map(n=>t.find(d=>d.id===n.value))),styles:{control:s=>({...s,backgroundColor:"white",border:"1px solid #ccc",boxShadow:"none","&:hover":{border:"1px solid #aaa"}}),multiValue:(s,n)=>({...s,backgroundColor:`hsl(${n.data.color.h},${n.data.color.s}%,${n.data.color.l}%)`,opacity:n.isFocused?.8:1}),option:(s,n)=>({...s,backgroundColor:`hsl(${n.data.color.h},${n.data.color.s}%,${n.data.color.l}%)`,opacity:n.isFocused?.8:1,color:"white"})}}),e.jsx("input",{type:"text",value:a,onChange:s=>i(s.target.value)})]})},be=()=>{const{addLayer:t}=j(),[r,l]=c.useState(void 0),[o,a]=c.useState(void 0),[i,u]=c.useState("");c.useEffect(()=>{r&&o&&u(`difference(${r.name}, ${o.name})`)},[r,o]);const s=()=>{if(!r||!o)return alert("Please select two layers"),!1;const n={type:"FeatureCollection",features:[]},d=r.featureCollection,f=o.featureCollection,y=se(f).features[0];return d.features.forEach(m=>{const h=le({type:"FeatureCollection",features:[m,y]});h&&n.features.push(h)}),!n||n.features.length===0?(alert("No results found"),!1):(t({featureCollection:n,name:i}),!0)};return e.jsxs(S,{buttonLabel:"Difference",onFormSubmit:s,children:["selected base layer: ",r==null?void 0:r.name,e.jsx(w,{selectedLayer:r,setSelectedLayer:l,renderingType:"fill"}),"selected layer to subtract: ",o==null?void 0:o.name,e.jsx(w,{selectedLayer:o,setSelectedLayer:a,renderingType:"fill",unselectableLayerIds:[r==null?void 0:r.id]}),e.jsx("input",{type:"text",value:i,onChange:n=>u(n.target.value)})]})},ge=()=>{const{addLayer:t}=j(),[r,l]=c.useState(void 0),[o,a]=c.useState(!1),[i,u]=c.useState(void 0),[s,n]=c.useState("");c.useEffect(()=>{r&&n(o&&i?`dissolve(${r.name}, ${i})`:`dissolve(${r.name})`)},[r,o,i]);const d=()=>{if(!r)return alert("Please select a layer"),!1;const f=r.featureCollection,y=o&&i?R($(f),{propertyName:i}):R($(f));return!y||y.features.length===0?(alert("No results found"),!1):(t({featureCollection:y,name:s}),!0)};return e.jsxs(S,{buttonLabel:"Dissolve",onFormSubmit:d,children:["selected layer: ",r==null?void 0:r.name,e.jsx(w,{selectedLayer:r,setSelectedLayer:l,renderingType:"fill"}),e.jsxs("span",{children:[e.jsx("input",{type:"checkbox",checked:o,onChange:f=>a(f.target.checked),id:"checkboxPropertyEnabled"}),e.jsxs("label",{htmlFor:"checkboxPropertyEnabled",children:["dissolve by property: ",o&&i]})]}),e.jsxs("select",{required:!0,disabled:!o,value:i,onChange:f=>u(f.target.value),children:[e.jsx("option",{value:"",children:"Select a property"}),(r==null?void 0:r.featureCollection.features[0].properties)&&Object.keys(r.featureCollection.features[0].properties).map(f=>e.jsx("option",{value:f,children:f},f))]}),e.jsx("input",{type:"text",value:s,onChange:f=>n(f.target.value)})]})},je=()=>{const{addLayer:t}=j(),[r,l]=c.useState(void 0),[o,a]=c.useState("");c.useEffect(()=>{r&&a(`voronoi(${r.name})`)},[r]);const i=()=>{if(!r)return alert("Please select a layer"),!1;const u=$(r.featureCollection),s=ae(u,{bbox:T(u)});return!s||s.features.length===0?(alert("No results found"),!1):(s.features=s.features.filter(n=>n.geometry.type==="Polygon"),t({featureCollection:s,name:o}),!0)};return e.jsxs(S,{buttonLabel:"Voronoi",onFormSubmit:i,children:["selected layer: ",r==null?void 0:r.name,e.jsx(w,{selectedLayer:r,setSelectedLayer:l,renderingType:"circle"}),e.jsx("input",{type:"text",value:o,onChange:u=>a(u.target.value)})]})},ve=()=>{const{layers:t,addLayer:r}=j(),[l,o]=c.useState(void 0),[a,i]=c.useState("");c.useEffect(()=>{if(l&&l.length>=1){let s=l[0].name;for(let n=1;n<l.length;n++)s+=`, ${l[n].name}`;i(`bbox(${s})`)}},[l]);const u=()=>{if(!l||l.length<1)return alert("Please select one or more layers"),!1;const s=l.flatMap(d=>d.featureCollection.features),n=ie(T({type:"FeatureCollection",features:s}));return n?(r({featureCollection:{type:"FeatureCollection",features:[n]},name:a}),!0):(alert("No results found"),!1)};return e.jsxs(S,{buttonLabel:"Bbox",onFormSubmit:u,children:[e.jsx(M,{isMulti:!0,options:t.map(s=>({value:s.id,label:s.name,color:s.color})),value:l==null?void 0:l.map(s=>({value:s.id,label:s.name,color:s.color})),onChange:s=>o(s==null?void 0:s.map(n=>t.find(d=>d.id===n.value))),styles:{control:s=>({...s,backgroundColor:"white",border:"1px solid #ccc",boxShadow:"none","&:hover":{border:"1px solid #aaa"}}),multiValue:(s,n)=>({...s,backgroundColor:`hsl(${n.data.color.h},${n.data.color.s}%,${n.data.color.l}%)`,opacity:n.isFocused?.8:1}),option:(s,n)=>({...s,backgroundColor:`hsl(${n.data.color.h},${n.data.color.s}%,${n.data.color.l}%)`,opacity:n.isFocused?.8:1,color:"white"})}}),e.jsx("input",{type:"text",value:a,onChange:s=>i(s.target.value)})]})},Ce=()=>{const{addLayer:t}=j(),[r,l]=c.useState(void 0),[o,a]=c.useState(void 0),[i,u]=c.useState("");c.useEffect(()=>{r&&o&&u(`clip(${o.name}, ${r.name})`)},[o,r]);const s=()=>{if(!r||!o)return alert("Please select two layers"),!1;let n={type:"FeatureCollection",features:[]};if(o.renderingType==="circle")n=ce(o.featureCollection,r.featureCollection);else if(o.renderingType==="fill"){const d=r.featureCollection,f=o.featureCollection;d.features.forEach(y=>{f.features.forEach(m=>{const h=V({type:"FeatureCollection",features:[m,y]});h&&n.features.push(h)})})}else if(o.renderingType==="line"){const d=$(r.featureCollection),f=$(o.featureCollection);d.features.forEach(y=>{const m=U(y,.01,{units:"meters"});f.features.forEach(h=>{I(h,m)?n.features.push(h):ue(h,y).features.forEach(p=>{I(p,m)&&n.features.push(p)})})})}else throw new Error("Unknown rendering type");return!n||n.features.length===0?(alert("No results found"),!1):(t({featureCollection:n,name:i}),!0)};return e.jsxs(S,{buttonLabel:"Clip",onFormSubmit:s,children:["selected layer: ",o==null?void 0:o.name,e.jsx(w,{selectedLayer:o,setSelectedLayer:a}),"selected mask layer: ",r==null?void 0:r.name,e.jsx(w,{selectedLayer:r,setSelectedLayer:l,renderingType:"fill",unselectableLayerIds:[o==null?void 0:o.id]}),e.jsx("input",{type:"text",value:i,onChange:n=>u(n.target.value)})]})},Se=()=>e.jsxs(e.Fragment,{children:[e.jsx(he,{}),e.jsx(ye,{}),e.jsx(xe,{}),e.jsx(be,{}),e.jsx(ge,{}),e.jsx(je,{}),e.jsx(ve,{}),e.jsx(Ce,{})]}),Le=({setWidth:t,setOpen:r})=>{const{mapRef:l}=N(),o=c.useRef(null),[a,i]=c.useState(!1),u=d=>{i(!0),d.preventDefault(),d.stopPropagation()},s=c.useCallback(()=>{i(!1),setTimeout(()=>{var d;(d=l.current)==null||d.resize()},1),setTimeout(()=>{var d;(d=l.current)==null||d.resize()},100)},[l]),n=c.useCallback(d=>{var f;a&&((f=l.current)==null||f.resize(),t(d.clientX),d.clientX<100?r(!1):r(!0))},[a,l,t,r]);return c.useEffect(()=>(window.addEventListener("mousemove",n),window.addEventListener("mouseup",s),()=>{window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",s)}),[a,n,s]),e.jsx("div",{className:`resizeHandle ${a?"resizing":""}`,onMouseDown:u,ref:o})};function we({size:t=120}){return e.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{style:{fill:"none",stroke:"currentColor",strokeWidth:16,strokeLinejoin:"round",strokeOpacity:1},d:"M 15,55 50,80 70,40 105,65"}),e.jsx("circle",{cx:"15",cy:"55",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"50",cy:"80",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"70",cy:"40",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"105",cy:"65",r:"12",fill:"currentColor"})]})}function Ne({size:t=120}){return e.jsx("svg",{width:t,height:t,viewBox:"0 0 120 120",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("circle",{cx:"60",cy:"60",r:"25",fill:"currentColor"})})}function ke({size:t=120}){return e.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{style:{fill:"currentColor",stroke:"currentColor",strokeWidth:16,strokeLinejoin:"round",strokeOpacity:1,fillOpacity:.5},d:"M 60,17 100,48 88,95 H 32 L 20,48 60,17"}),e.jsx("circle",{cx:"60",cy:"17",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"100",cy:"48",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"88",cy:"95",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"32",cy:"95",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"20",cy:"48",r:"12",fill:"currentColor"})]})}const Pe=({color:t,onChange:r,layerType:l})=>{const[o,a]=c.useState(!1),i=c.useRef(null);return E(i,()=>{a(!1)}),e.jsxs("div",{className:"colorPicker",ref:i,children:[e.jsxs("button",{type:"button",className:"colorPickerButton",onClick:()=>{a(!o)},style:{color:`hsl(${t.h},${t.s}%,${t.l}%)`},children:[l==="circle"&&e.jsx(Ne,{}),l==="line"&&e.jsx(we,{}),l==="fill"&&e.jsx("div",{className:"polygonShrinker",children:e.jsx(ke,{})})]}),o&&e.jsx("div",{className:"colorPickerPopover",children:e.jsx(X,{color:t,onChange:u=>{r(u)}})})]})},$e=({layerId:t,initialLayerName:r,isEditing:l,setIsEditing:o,closeMenu:a})=>{const{changeLayerName:i}=j(),[u,s]=c.useState(r),n=c.useRef(null);return c.useEffect(()=>{l&&n.current&&n.current.focus()},[l,n]),E(n,()=>{l&&(i(t,u),o(!1),a())}),e.jsx("div",{className:"layerNameContainer",children:l?e.jsx("form",{onSubmit:d=>{d.preventDefault(),i(t,u),o(!1)},children:e.jsx("input",{type:"text",value:u,onChange:d=>s(d.target.value),ref:n,onFocus:()=>o(!0),onBlur:()=>i(t,u)})}):e.jsx("div",{children:e.jsx("span",{onDoubleClick:()=>o(!0),children:u})})})},Ee=({layerData:t,layerAboveId:r})=>{const[l,o]=c.useState(!1),a=c.useRef(null);E(a,()=>{o(!1)});const{deleteLayer:i,toggleLayerVisibility:u,changeLayerColor:s}=j(),{mapRef:n}=N();c.useEffect(()=>{var p,x,b,g;(p=n.current)!=null&&p.getSource(t.id)||(x=n.current)==null||x.addSource(t.id,{type:"geojson",data:t.featureCollection}),(b=n.current)!=null&&b.getLayer(t.id)||(g=n.current)==null||g.addLayer({id:t.id,type:t.renderingType,source:t.id,paint:t.renderingType==="fill"?{"fill-color":`hsl(${t.color.h},${t.color.s}%,${t.color.l}%)`,"fill-opacity":t.color.a}:t.renderingType==="line"?{"line-color":`hsl(${t.color.h},${t.color.s}%,${t.color.l}%)`,"line-opacity":t.color.a,"line-width":2}:t.renderingType==="circle"?{"circle-color":`hsl(${t.color.h},${t.color.s}%,${t.color.l}%)`,"circle-opacity":t.color.a,"circle-radius":5}:{}})},[n,t]),c.useEffect(()=>{var p;(p=n.current)==null||p.moveLayer(t.id,r)},[r,t.id,n,t.updater]),c.useEffect(()=>{var p;(p=n.current)==null||p.setLayoutProperty(t.id,"visibility",t.visible?"visible":"none")},[t.visible,n,t.id,t.updater]);const d=p=>{var x,b,g,C,k,L;s(t.id,p),t.renderingType==="fill"?((x=n.current)==null||x.setPaintProperty(t.id,"fill-color",`hsl(${p.h},${p.s}%,${p.l}%)`),(b=n.current)==null||b.setPaintProperty(t.id,"fill-opacity",p.a)):t.renderingType==="line"?((g=n.current)==null||g.setPaintProperty(t.id,"line-color",`hsl(${p.h},${p.s}%,${p.l}%)`),(C=n.current)==null||C.setPaintProperty(t.id,"line-opacity",p.a)):t.renderingType==="circle"&&((k=n.current)==null||k.setPaintProperty(t.id,"circle-color",`hsl(${p.h},${p.s}%,${p.l}%)`),(L=n.current)==null||L.setPaintProperty(t.id,"circle-opacity",p.a))},f=()=>{var p,x;(p=n.current)==null||p.removeLayer(t.id),(x=n.current)==null||x.removeSource(t.id),i(t.id)},y=()=>{const p=new Blob([JSON.stringify(t.featureCollection)],{type:"application/geo+json"}),x=URL.createObjectURL(p),b=document.createElement("a");b.href=x,b.download=t.name+".geojson",document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(x)},m=()=>{var x;const p=T(t.featureCollection).slice(0,4);(x=n.current)==null||x.fitBounds(p,{padding:20})},[h,v]=c.useState(!1);return e.jsxs("div",{className:"layerItem",children:[e.jsx("span",{className:"layerItemHelper"}),e.jsx(Pe,{color:t.color,onChange:d,layerType:t.renderingType}),e.jsx($e,{layerId:t.id,initialLayerName:t.name,isEditing:h,setIsEditing:v,closeMenu:()=>o(!1)}),e.jsxs("div",{className:`layerMenu ${l?"open":""}`,ref:a,children:[e.jsx("button",{type:"button",onClick:()=>{o(!l)},children:e.jsx(K,{})}),l&&e.jsx("div",{className:"layerMenuPopover",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:f,children:[e.jsx(Q,{})," Delete layer"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:y,children:[e.jsx(Y,{})," Download layer"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:m,children:[e.jsx(_,{})," Zoom to layer"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:p=>{p.stopPropagation(),v(!h)},children:[h?e.jsx(ee,{}):e.jsx(D,{})," Edit layer name"]})})]})})]}),e.jsx("button",{type:"button",onClick:()=>u(t.id),children:t.visible?e.jsx(B,{}):e.jsx(O,{})})]})},Fe=()=>{const{layers:t,moveLayerUp:r,moveLayerDown:l}=j(),[o,a]=c.useState(null),[i,u]=c.useState(null);c.useEffect(()=>{o!==null&&u(o)},[o]);const s=(f,y)=>{a(y),f.dataTransfer.setDragImage(new Image,0,0)},n=(f,y)=>{f.preventDefault(),f.dataTransfer.dropEffect="move",!(o===null||o===y)&&(t.findIndex(m=>m.id===o)<t.findIndex(m=>m.id===y)?l(o):r(o))},d=()=>{a(null)};return e.jsx("ol",{className:"layerList",children:t.map((f,y)=>e.jsx("li",{draggable:!0,className:`layerListItem ${i===f.id?"hovering":""}`,onDragStart:m=>s(m,f.id),onDragOver:m=>n(m,f.id),onDragEnd:d,onMouseOver:()=>o===null?u(f.id):void 0,onMouseOut:()=>o===null?u(null):void 0,children:e.jsx(Ee,{layerData:f,layerAboveId:y===0?void 0:t[y-1].id})},f.id))})};function Me(){const[t,r]=c.useState(!0),[l,o]=c.useState(300),{layers:a,addLayer:i,toggleLayerVisibilityAll:u}=j(),{mapRef:s,mapReady:n}=N();c.useEffect(()=>{const m=setInterval(()=>{var h;(h=s.current)==null||h.resize()},1);setTimeout(()=>{clearInterval(m)},1)},[s,t]);const d=m=>{if(!m){console.log("no file selected");return}Array.from(m).forEach(h=>{const v=new FileReader;v.onload=p=>{var x;try{const b=JSON.parse((x=p.target)==null?void 0:x.result);if(b.type!=="FeatureCollection")throw new Error("Not a valid GeoJSON file, must be a FeatureCollection");i({featureCollection:b,name:h.name})}catch(b){console.log(b)}},v.readAsText(h)})},f=m=>{const h=m.target.files;d(h),m.target.value=""},y=m=>{m.preventDefault();const h=m.dataTransfer.files;d(h)};return e.jsxs("div",{className:"pageContainer",onDragOver:m=>m.preventDefault(),onDrop:y,children:[e.jsxs("header",{className:"mainHeader",children:[e.jsx("h1",{children:"μGIS"}),e.jsx("button",{type:"button",onClick:()=>r(!t),children:"Sidebar"}),e.jsx(Se,{}),e.jsx(pe,{})]}),e.jsxs("main",{className:"mainContainer",children:[e.jsxs("div",{className:`sidebarContainer ${t?"open":""}`,children:[e.jsx(Le,{setWidth:o,setOpen:r}),e.jsxs("aside",{className:"sidebar",style:{width:`${l}px`},children:[e.jsx("h2",{children:"Sidebar"}),e.jsx("button",{type:"button",onClick:u,children:a.every(m=>m.visible)?e.jsx(B,{}):e.jsx(O,{})}),e.jsx("div",{className:"layerListContainer",children:n&&e.jsx(Fe,{})}),e.jsxs("div",{className:"sidebarFooter",children:[e.jsxs("label",{htmlFor:"layerFileInput",children:[e.jsx(te,{}),"Upload GeoJSON file"]}),e.jsx("input",{id:"layerFileInput",type:"file",multiple:!0,accept:".geojson",onChange:f})]})]})]}),e.jsx("div",{className:"mapFlexContainer",children:e.jsx(de,{})})]})]})}re.createRoot(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsx(Me,{})}));

import{e as F,f as c,j as e,M as V,S as A,F as W,h as G,k as J,l as Z,m as q,G as H,n as T,o as X,E as K,T as Q,q as Y,Z as _,P as D,t as ee,w as B,x as O,U as te,y as re}from"./vendor-D3H5dm-Z.js";import{m as P,M as ne}from"./vendor-mapbox--0x3yUqA.js";import{b as U,i as z,u as oe,c as se,d as le,a as R,f as $,v as ae,e as M,g as ie,p as ce,h as I,l as ue}from"./vendor-turf-B9EgS0Um.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();const N=F(t=>({mapRef:c.createRef(),setMapRef:r=>t({mapRef:r}),mapReady:!1,setMapReady:r=>t({mapReady:r}),basemap:{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"},setBasemap:r=>t(s=>r.url===s.basemap.url?s:{basemap:r}),resetMapStore:()=>t(()=>({mapReady:!1,basemap:{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"}}))})),j=F(t=>({layers:[],resetLayerStore:()=>t(()=>({layers:[]})),loadProjectLayers:r=>t(()=>({layers:r})),addLayer:r=>t(s=>{const l=n=>s.layers.some(u=>u.id===n)?l(n+"1"):n,a=r.featureCollection.features[0].geometry.type,i=a==="Polygon"||a==="MultiPolygon"?"fill":a==="LineString"||a==="MultiLineString"?"line":a==="Point"||a==="MultiPoint"?"circle":null;if(!i)throw new Error("Unsupported geometry type: "+a);r.name||(r.name=i==="fill"?"polygon layer":i==="line"?"line layer":i==="circle"?"point layer":"not possible");const d={h:Math.floor(Math.random()*360),s:90,l:48,a:i==="fill"?.7:1};return{layers:[{featureCollection:r.featureCollection,id:l(r.name),name:r.name,renderingType:i,visible:!0,color:d},...s.layers]}}),moveLayerUp:r=>t(s=>{const l=s.layers.findIndex(i=>i.id===r);if(l===0)return s;const a=[...s.layers];return a.splice(l-1,0,a.splice(l,1)[0]),{layers:a}}),moveLayerDown:r=>t(s=>{const l=s.layers.findIndex(i=>i.id===r);if(l===s.layers.length-1)return s;const a=[...s.layers];return a.splice(l+1,0,a.splice(l,1)[0]),{layers:a}}),deleteLayer:r=>t(s=>({layers:s.layers.filter(l=>l.id!==r)})),toggleLayerVisibility:r=>t(s=>({layers:s.layers.map(l=>l.id===r?{...l,visible:!l.visible}:l)})),toggleLayerVisibilityAll:()=>t(r=>{const s=r.layers.every(l=>l.visible);return{layers:r.layers.map(l=>({...l,visible:!s}))}}),changeLayerColor:(r,s)=>t(l=>({layers:l.layers.map(a=>a.id===r?{...a,color:s}:a)})),updateAllLayers:()=>t(r=>({layers:r.layers.map(s=>({...s,updater:s.updater?s.updater+1:1}))})),changeLayerName:(r,s)=>t(l=>({layers:l.layers.map(a=>a.id===r?{...a,name:s}:a)}))}));P.accessToken="pk.eyJ1IjoidG9iaWFuZCIsImEiOiJjbTdiMGZwemwwNmxlMnFyNTV4YWh2ZzB3In0.B3fVZMQOYEs2V23kKWB5XQ";const de=()=>{const{mapRef:t,mapReady:r,setMapReady:s,basemap:l}=N(),{addLayer:a,updateAllLayers:i}=j(),d=c.useRef(null);c.useEffect(()=>{var p,h,v,m,y,x;if(!r&&d.current){d.current.innerHTML="",t.current=new P.Map({container:d.current,style:l.url,center:[10.4,63.425],zoom:12}),(p=t.current)==null||p.addControl(new P.FullscreenControl,"top-right"),(h=t.current)==null||h.addControl(new P.NavigationControl({visualizePitch:!0}),"top-right"),(v=t.current)==null||v.addControl(new P.ScaleControl,"bottom-right");const g=new ne({displayControlsDefault:!1,controls:{point:!0,line_string:!0,polygon:!0},boxSelect:!1});(m=t.current)==null||m.addControl(g,"bottom-left"),(y=t.current)==null||y.on("draw.create",()=>{a({featureCollection:g.getAll(),name:null}),g.deleteAll()}),(x=t.current)==null||x.on("style.load",()=>{s(!0)})}},[t,a,r,s,l]);const[o,n]=c.useState(!1),u=c.useRef(l),[f,b]=c.useState(l);return c.useEffect(()=>{var p;u.current.url!==l.url&&(u.current=l),!o&&f.url!==u.current.url&&(n(!0),r&&t.current&&(t.current.setStyle(u.current.url),b(l)),(p=t.current)==null||p.once("style.load",()=>{i()}),setTimeout(()=>{n(!1)},200))},[l,t,r,o,f,i]),e.jsx("div",{ref:d,className:"mapContainer"})},E=(t,r,s=[])=>{c.useEffect(()=>{const l=a=>{const i=a.target;t.current&&!t.current.contains(i)&&!s.some(d=>{var o;return(o=d.current)==null?void 0:o.contains(i)})&&r()};return document.addEventListener("click",l),()=>{document.removeEventListener("click",l)}},[t,r,s])},fe=()=>{const[t,r]=c.useState(!1),s=c.useRef(null);E(s,()=>{r(!1)});const[l,a]=c.useState(null),{basemap:i,setBasemap:d}=N(),o=[{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"},{url:"mapbox://styles/mapbox/outdoors-v12",name:"Outdoors"},{url:"mapbox://styles/mapbox/light-v11",name:"Light"},{url:"mapbox://styles/mapbox/dark-v11",name:"Dark"},{url:"mapbox://styles/mapbox/satellite-v9",name:"Satellite"},{url:"mapbox://styles/mapbox/satellite-streets-v12",name:"Satellite Streets"},{url:"mapbox://styles/mapbox/navigation-day-v1",name:"Navigation Day"},{url:"mapbox://styles/mapbox/navigation-night-v1",name:"Navigation Night"},{url:"mapbox://styles/tobiand/cm8rbg7j900be01sa5wc6d4lq",name:"Off (white)"},{url:"mapbox://styles/tobiand/cm8rbd89l00az01sb97a8hfyh",name:"Off (black)"}];return e.jsxs("div",{className:"basemap",ref:s,children:[e.jsxs("button",{type:"button",onClick:()=>r(!t),children:[e.jsx(V,{})," Change basemap"]}),t&&e.jsx("div",{className:"basemapPopover",children:e.jsx("ul",{onMouseEnter:()=>{a(i)},onMouseLeave:()=>{d(l),a(null)},children:o.map(n=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{a(n)},onMouseEnter:()=>{d(n)},children:[l===null&&n.name===i.name||l!==null&&n.name===l.name?"*":"",n.name]})},n.name))})})]})},me=F(t=>({theme:localStorage.getItem("theme")||"light",setTheme:r=>t(s=>(localStorage.setItem("theme",r),r===s.theme?s:{theme:r}))})),pe=()=>{const[t,r]=c.useState(!1),s=c.useRef(null);E(s,()=>{r(!1)});const{layers:l,resetLayerStore:a,loadProjectLayers:i}=j(),{basemap:d,setBasemap:o,resetMapStore:n}=N(),{theme:u,setTheme:f}=me(),b=()=>{a(),n()},p=()=>{const y={layers:l,basemap:d},x=new Blob([JSON.stringify(y)],{type:"application/json"}),g=URL.createObjectURL(x),C=document.createElement("a");C.href=g,C.download="μGIS_project.mugis",document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(g)},h=c.useRef(null),v=()=>{var y;(y=h.current)==null||y.click()},m=y=>{const x=y.target.files;if(!x){console.log("no file selected");return}const g=new FileReader;g.onload=C=>{var k;try{const L=JSON.parse((k=C.target)==null?void 0:k.result);i(L.layers),o(L.basemap)}catch(L){console.log(L)}},g.readAsText(x[0])};return c.useEffect(()=>{document.documentElement.setAttribute("data-theme",u)},[u]),e.jsxs("div",{className:"settings",ref:s,children:[e.jsx("button",{type:"button",onClick:()=>{r(!t)},children:e.jsx(A,{})}),t&&e.jsx("div",{className:"settingsPopover",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:b,children:[e.jsx(W,{})," New project"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:p,children:[e.jsx(G,{})," Save project"]})}),e.jsxs("li",{children:[e.jsx("input",{ref:h,type:"file",accept:".mugis",onChange:m}),e.jsxs("button",{type:"button",onClick:v,children:[e.jsx(J,{})," Load project"]})]}),e.jsx("li",{children:e.jsx(fe,{})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{f(u==="light"?"dark":"light")},children:[u==="light"?e.jsx(Z,{}):e.jsx(q,{})," Toggle theme"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{},children:[e.jsx(H,{})," Start tutorial"]})})]})})]})},S=({children:t,buttonLabel:r,onFormSubmit:s})=>{const[l,a]=c.useState(!1),[i,d]=c.useState(!1);return e.jsxs("div",{children:[e.jsx("button",{type:"button",onClick:()=>a(!l),children:r}),l&&e.jsx("div",{className:"cover",onClick:o=>{o.target===o.currentTarget&&a(!1)},children:e.jsx("div",{className:"modal"+(i?" loading":""),children:e.jsxs("form",{onSubmit:o=>{o.preventDefault(),d(!0),setTimeout(()=>{s()&&a(!1),d(!1)},0)},children:[e.jsx("h3",{children:r}),t,e.jsx("button",{type:"button",onClick:()=>a(!1),children:"Close"}),e.jsx("button",{type:"submit",children:"Submit"})]})})})]})},w=({selectedLayer:t,setSelectedLayer:r,renderingType:s=void 0,unselectableLayerIds:l=[]})=>{const{layers:a}=j();return e.jsxs("select",{required:!0,value:t==null?void 0:t.id,onChange:i=>r(a.find(d=>d.id===i.target.value)),children:[e.jsx("option",{value:void 0,children:"Select a layer1"}),a.filter(i=>s?i.renderingType===s:!0).filter(i=>!l.includes(i.id)).map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})},he=()=>{const{addLayer:t}=j(),[r,s]=c.useState(void 0),[l,a]=c.useState(""),[i,d]=c.useState("");c.useEffect(()=>{r&&d(`buffer(${r.name}, ${l}m)`)},[r,l]);const o=()=>{if(!r||l==="")return alert("Please select a layer and enter a radius"),!1;const n=r.featureCollection,u=U(n,l*.001,{units:"kilometers"});return!u||u.features.length===0?(alert("No results found"),!1):(t({featureCollection:u,name:i}),!0)};return e.jsxs(S,{buttonLabel:"Buffer",onFormSubmit:o,children:["selected layer: ",r==null?void 0:r.name,e.jsx(w,{selectedLayer:r,setSelectedLayer:s}),"buffer radius [m]: ",l,e.jsx("input",{type:"number",value:l,onChange:n=>a(n.target.value)}),e.jsx("input",{type:"text",value:i,onChange:n=>d(n.target.value)})]})},ye=()=>{const{layers:t,addLayer:r}=j(),[s,l]=c.useState(void 0),[a,i]=c.useState("");c.useEffect(()=>{if(s&&s.length>=2){let o=s[0].name;for(let n=1;n<s.length;n++)o+=`, ${s[n].name}`;i(`intersect(${o})`)}},[s]);const d=()=>{if(!s||s.length<2)return alert("Please select two layers"),!1;const o={type:"FeatureCollection",features:s[0].featureCollection.features};for(let n=1;n<s.length;n++){const u=s[n].featureCollection,f=[];o.features.forEach(b=>{u.features.forEach(p=>{const h=z({type:"FeatureCollection",features:[b,p]});h&&f.push(h)})}),o.features=f}return!o||o.features.length===0?(alert("No results found"),!1):(r({featureCollection:o,name:a}),!0)};return e.jsxs(S,{buttonLabel:"Intersect",onFormSubmit:d,children:[e.jsx(T,{isMulti:!0,options:t.filter(o=>o.renderingType==="fill").map(o=>({value:o.id,label:o.name,color:o.color})),value:s==null?void 0:s.map(o=>({value:o.id,label:o.name,color:o.color})),onChange:o=>l(o==null?void 0:o.map(n=>t.find(u=>u.id===n.value))),styles:{control:o=>({...o,backgroundColor:"white",border:"1px solid #ccc",boxShadow:"none","&:hover":{border:"1px solid #aaa"}}),multiValue:(o,n)=>({...o,backgroundColor:`hsl(${n.data.color.h},${n.data.color.s}%,${n.data.color.l}%)`,opacity:n.isFocused?.8:1}),option:(o,n)=>({...o,backgroundColor:`hsl(${n.data.color.h},${n.data.color.s}%,${n.data.color.l}%)`,opacity:n.isFocused?.8:1,color:"white"})}}),e.jsx("input",{type:"text",value:a,onChange:o=>i(o.target.value)})]})},xe=()=>{const{layers:t,addLayer:r}=j(),[s,l]=c.useState(void 0),[a,i]=c.useState("");c.useEffect(()=>{if(s&&s.length>=2){let o=s[0].name;for(let n=1;n<s.length;n++)o+=`, ${s[n].name}`;i(`union(${o})`)}},[s]);const d=()=>{if(!s||s.length<2)return alert("Please select two layers"),!1;const o=s.flatMap(u=>u.featureCollection.features),n=oe({type:"FeatureCollection",features:o});return n?(r({featureCollection:{type:"FeatureCollection",features:[n]},name:a}),!0):(alert("No results found"),!1)};return e.jsxs(S,{buttonLabel:"Union",onFormSubmit:d,children:[e.jsx(T,{isMulti:!0,options:t.filter(o=>o.renderingType==="fill").map(o=>({value:o.id,label:o.name,color:o.color})),value:s==null?void 0:s.map(o=>({value:o.id,label:o.name,color:o.color})),onChange:o=>l(o==null?void 0:o.map(n=>t.find(u=>u.id===n.value))),styles:{control:o=>({...o,backgroundColor:"white",border:"1px solid #ccc",boxShadow:"none","&:hover":{border:"1px solid #aaa"}}),multiValue:(o,n)=>({...o,backgroundColor:`hsl(${n.data.color.h},${n.data.color.s}%,${n.data.color.l}%)`,opacity:n.isFocused?.8:1}),option:(o,n)=>({...o,backgroundColor:`hsl(${n.data.color.h},${n.data.color.s}%,${n.data.color.l}%)`,opacity:n.isFocused?.8:1,color:"white"})}}),e.jsx("input",{type:"text",value:a,onChange:o=>i(o.target.value)})]})},be=()=>{const{addLayer:t}=j(),[r,s]=c.useState(void 0),[l,a]=c.useState(void 0),[i,d]=c.useState("");c.useEffect(()=>{r&&l&&d(`difference(${r.name}, ${l.name})`)},[r,l]);const o=()=>{if(!r||!l)return alert("Please select two layers"),!1;const n={type:"FeatureCollection",features:[]},u=r.featureCollection,f=l.featureCollection,b=se(f).features[0];return u.features.forEach(p=>{const h=le({type:"FeatureCollection",features:[p,b]});h&&n.features.push(h)}),!n||n.features.length===0?(alert("No results found"),!1):(t({featureCollection:n,name:i}),!0)};return e.jsxs(S,{buttonLabel:"Difference",onFormSubmit:o,children:["selected base layer: ",r==null?void 0:r.name,e.jsx(w,{selectedLayer:r,setSelectedLayer:s,renderingType:"fill"}),"selected layer to subtract: ",l==null?void 0:l.name,e.jsx(w,{selectedLayer:l,setSelectedLayer:a,renderingType:"fill",unselectableLayerIds:[r==null?void 0:r.id]}),e.jsx("input",{type:"text",value:i,onChange:n=>d(n.target.value)})]})},ge=()=>{const{addLayer:t}=j(),[r,s]=c.useState(void 0),[l,a]=c.useState(!1),[i,d]=c.useState(void 0),[o,n]=c.useState("");c.useEffect(()=>{r&&n(l&&i?`dissolve(${r.name}, ${i})`:`dissolve(${r.name})`)},[r,l,i]);const u=()=>{if(!r)return alert("Please select a layer"),!1;const f=r.featureCollection,b=l&&i?R($(f),{propertyName:i}):R($(f));return!b||b.features.length===0?(alert("No results found"),!1):(t({featureCollection:b,name:o}),!0)};return e.jsxs(S,{buttonLabel:"Dissolve",onFormSubmit:u,children:["selected layer: ",r==null?void 0:r.name,e.jsx(w,{selectedLayer:r,setSelectedLayer:s,renderingType:"fill"}),e.jsxs("span",{children:[e.jsx("input",{type:"checkbox",checked:l,onChange:f=>a(f.target.checked),id:"checkboxPropertyEnabled"}),e.jsxs("label",{htmlFor:"checkboxPropertyEnabled",children:["dissolve by property: ",l&&i]})]}),e.jsxs("select",{required:!0,disabled:!l,value:i,onChange:f=>d(f.target.value),children:[e.jsx("option",{value:"",children:"Select a property"}),(r==null?void 0:r.featureCollection.features[0].properties)&&Object.keys(r.featureCollection.features[0].properties).map(f=>e.jsx("option",{value:f,children:f},f))]}),e.jsx("input",{type:"text",value:o,onChange:f=>n(f.target.value)})]})},je=()=>{const{addLayer:t}=j(),[r,s]=c.useState(void 0),[l,a]=c.useState("");c.useEffect(()=>{r&&a(`voronoi(${r.name})`)},[r]);const i=()=>{if(!r)return alert("Please select a layer"),!1;const d=$(r.featureCollection),o=ae(d,{bbox:M(d)});return!o||o.features.length===0?(alert("No results found"),!1):(o.features=o.features.filter(n=>n.geometry.type==="Polygon"),t({featureCollection:o,name:l}),!0)};return e.jsxs(S,{buttonLabel:"Voronoi",onFormSubmit:i,children:["selected layer: ",r==null?void 0:r.name,e.jsx(w,{selectedLayer:r,setSelectedLayer:s,renderingType:"circle"}),e.jsx("input",{type:"text",value:l,onChange:d=>a(d.target.value)})]})},ve=()=>{const{layers:t,addLayer:r}=j(),[s,l]=c.useState(void 0),[a,i]=c.useState("");c.useEffect(()=>{if(s&&s.length>=1){let o=s[0].name;for(let n=1;n<s.length;n++)o+=`, ${s[n].name}`;i(`bbox(${o})`)}},[s]);const d=()=>{if(!s||s.length<1)return alert("Please select one or more layers"),!1;const o=s.flatMap(u=>u.featureCollection.features),n=ie(M({type:"FeatureCollection",features:o}));return n?(r({featureCollection:{type:"FeatureCollection",features:[n]},name:a}),!0):(alert("No results found"),!1)};return e.jsxs(S,{buttonLabel:"Bbox",onFormSubmit:d,children:[e.jsx(T,{isMulti:!0,options:t.map(o=>({value:o.id,label:o.name,color:o.color})),value:s==null?void 0:s.map(o=>({value:o.id,label:o.name,color:o.color})),onChange:o=>l(o==null?void 0:o.map(n=>t.find(u=>u.id===n.value))),styles:{control:o=>({...o,backgroundColor:"white",border:"1px solid #ccc",boxShadow:"none","&:hover":{border:"1px solid #aaa"}}),multiValue:(o,n)=>({...o,backgroundColor:`hsl(${n.data.color.h},${n.data.color.s}%,${n.data.color.l}%)`,opacity:n.isFocused?.8:1}),option:(o,n)=>({...o,backgroundColor:`hsl(${n.data.color.h},${n.data.color.s}%,${n.data.color.l}%)`,opacity:n.isFocused?.8:1,color:"white"})}}),e.jsx("input",{type:"text",value:a,onChange:o=>i(o.target.value)})]})},Ce=()=>{const{addLayer:t}=j(),[r,s]=c.useState(void 0),[l,a]=c.useState(void 0),[i,d]=c.useState("");c.useEffect(()=>{r&&l&&d(`clip(${l.name}, ${r.name})`)},[l,r]);const o=()=>{if(!r||!l)return alert("Please select two layers"),!1;let n={type:"FeatureCollection",features:[]};if(l.renderingType==="circle")n=ce(l.featureCollection,r.featureCollection);else if(l.renderingType==="fill"){const u=r.featureCollection,f=l.featureCollection;u.features.forEach(b=>{f.features.forEach(p=>{const h=z({type:"FeatureCollection",features:[p,b]});h&&n.features.push(h)})})}else if(l.renderingType==="line"){const u=$(r.featureCollection),f=$(l.featureCollection);u.features.forEach(b=>{const p=U(b,.01,{units:"meters"});f.features.forEach(h=>{I(h,p)?n.features.push(h):ue(h,b).features.forEach(m=>{I(m,p)&&n.features.push(m)})})})}else throw new Error("Unknown rendering type");return!n||n.features.length===0?(alert("No results found"),!1):(t({featureCollection:n,name:i}),!0)};return e.jsxs(S,{buttonLabel:"Clip",onFormSubmit:o,children:["selected layer: ",l==null?void 0:l.name,e.jsx(w,{selectedLayer:l,setSelectedLayer:a}),"selected mask layer: ",r==null?void 0:r.name,e.jsx(w,{selectedLayer:r,setSelectedLayer:s,renderingType:"fill",unselectableLayerIds:[l==null?void 0:l.id]}),e.jsx("input",{type:"text",value:i,onChange:n=>d(n.target.value)})]})},Se=()=>e.jsxs(e.Fragment,{children:[e.jsx(he,{}),e.jsx(ye,{}),e.jsx(xe,{}),e.jsx(be,{}),e.jsx(ge,{}),e.jsx(je,{}),e.jsx(ve,{}),e.jsx(Ce,{})]}),Le=({setWidth:t,setOpen:r})=>{const{mapRef:s}=N(),l=c.useRef(null),[a,i]=c.useState(!1),d=u=>{i(!0),u.preventDefault(),u.stopPropagation()},o=c.useCallback(()=>{i(!1),setTimeout(()=>{var u;(u=s.current)==null||u.resize()},1),setTimeout(()=>{var u;(u=s.current)==null||u.resize()},100)},[s]),n=c.useCallback(u=>{var f;a&&((f=s.current)==null||f.resize(),t(u.clientX),u.clientX<100?r(!1):r(!0))},[a,s,t,r]);return c.useEffect(()=>(window.addEventListener("mousemove",n),window.addEventListener("mouseup",o),()=>{window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",o)}),[a,n,o]),e.jsx("div",{className:`resizeHandle ${a?"resizing":""}`,onMouseDown:d,ref:l})};function we({size:t=120}){return e.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{style:{fill:"none",stroke:"currentColor",strokeWidth:16,strokeLinejoin:"round",strokeOpacity:1},d:"M 15,55 50,80 70,40 105,65"}),e.jsx("circle",{cx:"15",cy:"55",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"50",cy:"80",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"70",cy:"40",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"105",cy:"65",r:"12",fill:"currentColor"})]})}function Ne({size:t=120}){return e.jsx("svg",{width:t,height:t,viewBox:"0 0 120 120",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("circle",{cx:"60",cy:"60",r:"25",fill:"currentColor"})})}function ke({size:t=120}){return e.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{style:{fill:"currentColor",stroke:"currentColor",strokeWidth:16,strokeLinejoin:"round",strokeOpacity:1,fillOpacity:.5},d:"M 60,17 100,48 88,95 H 32 L 20,48 60,17"}),e.jsx("circle",{cx:"60",cy:"17",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"100",cy:"48",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"88",cy:"95",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"32",cy:"95",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"20",cy:"48",r:"12",fill:"currentColor"})]})}const Pe=({color:t,onChange:r,layerType:s})=>{const[l,a]=c.useState(!1),i=c.useRef(null);return E(i,()=>{a(!1)}),e.jsxs("div",{className:"colorPicker",ref:i,children:[e.jsxs("button",{type:"button",className:"colorPickerButton",onClick:()=>{a(!l)},style:{color:`hsl(${t.h},${t.s}%,${t.l}%)`},children:[s==="circle"&&e.jsx(Ne,{}),s==="line"&&e.jsx(we,{}),s==="fill"&&e.jsx("div",{className:"polygonShrinker",children:e.jsx(ke,{})})]}),l&&e.jsx("div",{className:"colorPickerPopover",children:e.jsx(X,{color:t,onChange:d=>{r(d)}})})]})},$e=({layerId:t,initialLayerName:r,isEditing:s,setIsEditing:l})=>{const{changeLayerName:a}=j(),[i,d]=c.useState(r),o=c.useRef(null);c.useEffect(()=>{s&&o.current&&o.current.focus()},[s,o]);const n=u=>{u==null||u.preventDefault(),a(t,i),l(!1)};return e.jsx("div",{className:"layerNameContainer",children:s?e.jsx("form",{onSubmit:n,children:e.jsx("input",{type:"text",value:i,onChange:u=>d(u.target.value),ref:o,onFocus:()=>l(!0),onBlur:()=>n()})}):e.jsx("div",{children:e.jsx("span",{onDoubleClick:()=>l(!0),children:i})})})},Ee=({layerData:t,layerAboveId:r})=>{const[s,l]=c.useState(!1),a=c.useRef(null);E(a,()=>{l(!1)});const{deleteLayer:i,toggleLayerVisibility:d,changeLayerColor:o}=j(),{mapRef:n}=N();c.useEffect(()=>{var m,y,x,g;(m=n.current)!=null&&m.getSource(t.id)||(y=n.current)==null||y.addSource(t.id,{type:"geojson",data:t.featureCollection}),(x=n.current)!=null&&x.getLayer(t.id)||(g=n.current)==null||g.addLayer({id:t.id,type:t.renderingType,source:t.id,paint:t.renderingType==="fill"?{"fill-color":`hsl(${t.color.h},${t.color.s}%,${t.color.l}%)`,"fill-opacity":t.color.a}:t.renderingType==="line"?{"line-color":`hsl(${t.color.h},${t.color.s}%,${t.color.l}%)`,"line-opacity":t.color.a,"line-width":2}:t.renderingType==="circle"?{"circle-color":`hsl(${t.color.h},${t.color.s}%,${t.color.l}%)`,"circle-opacity":t.color.a,"circle-radius":5}:{}})},[n,t]),c.useEffect(()=>{var m;(m=n.current)==null||m.moveLayer(t.id,r)},[r,t.id,n,t.updater]),c.useEffect(()=>{var m;(m=n.current)==null||m.setLayoutProperty(t.id,"visibility",t.visible?"visible":"none")},[t.visible,n,t.id,t.updater]);const u=m=>{var y,x,g,C,k,L;o(t.id,m),t.renderingType==="fill"?((y=n.current)==null||y.setPaintProperty(t.id,"fill-color",`hsl(${m.h},${m.s}%,${m.l}%)`),(x=n.current)==null||x.setPaintProperty(t.id,"fill-opacity",m.a)):t.renderingType==="line"?((g=n.current)==null||g.setPaintProperty(t.id,"line-color",`hsl(${m.h},${m.s}%,${m.l}%)`),(C=n.current)==null||C.setPaintProperty(t.id,"line-opacity",m.a)):t.renderingType==="circle"&&((k=n.current)==null||k.setPaintProperty(t.id,"circle-color",`hsl(${m.h},${m.s}%,${m.l}%)`),(L=n.current)==null||L.setPaintProperty(t.id,"circle-opacity",m.a))},f=()=>{var m,y;(m=n.current)==null||m.removeLayer(t.id),(y=n.current)==null||y.removeSource(t.id),i(t.id)},b=()=>{const m=new Blob([JSON.stringify(t.featureCollection)],{type:"application/geo+json"}),y=URL.createObjectURL(m),x=document.createElement("a");x.href=y,x.download=t.name+".geojson",document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(y)},p=()=>{var y;const m=M(t.featureCollection).slice(0,4);(y=n.current)==null||y.fitBounds(m,{padding:20})},[h,v]=c.useState(!1);return e.jsxs("div",{className:"layerItem",children:[e.jsx("span",{className:"layerItemHelper"}),e.jsx(Pe,{color:t.color,onChange:u,layerType:t.renderingType}),e.jsx($e,{layerId:t.id,initialLayerName:t.name,isEditing:h,setIsEditing:v}),e.jsxs("div",{className:`layerMenu ${s?"open":""}`,ref:a,children:[e.jsx("button",{type:"button",onClick:()=>{l(!s)},children:e.jsx(K,{})}),s&&e.jsx("div",{className:"layerMenuPopover",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:f,children:[e.jsx(Q,{})," Delete layer"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:b,children:[e.jsx(Y,{})," Download layer"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:p,children:[e.jsx(_,{})," Zoom to layer"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:m=>{m.stopPropagation(),v(!h)},children:[h?e.jsx(ee,{}):e.jsx(D,{})," Edit layer name"]})})]})})]}),e.jsx("button",{type:"button",onClick:()=>d(t.id),children:t.visible?e.jsx(B,{}):e.jsx(O,{})})]})},Fe=()=>{const{layers:t,moveLayerUp:r,moveLayerDown:s}=j(),[l,a]=c.useState(null),i=(n,u)=>{a(u),n.dataTransfer.setDragImage(new Image,0,0)},d=(n,u)=>{n.preventDefault(),n.dataTransfer.dropEffect="move",!(l===null||l===u)&&(t.findIndex(f=>f.id===l)<t.findIndex(f=>f.id===u)?s(l):r(l))},o=()=>{a(null)};return e.jsx("ol",{className:"layerList",children:t.map((n,u)=>e.jsx("li",{draggable:!0,className:"layerListItem",onDragStart:f=>i(f,n.id),onDragOver:f=>d(f,n.id),onDrop:o,children:e.jsx(Ee,{layerData:n,layerAboveId:u===0?void 0:t[u-1].id})},n.id))})};function Te(){const[t,r]=c.useState(!0),[s,l]=c.useState(300),{layers:a,addLayer:i,toggleLayerVisibilityAll:d}=j(),{mapRef:o,mapReady:n}=N();c.useEffect(()=>{const p=setInterval(()=>{var h;(h=o.current)==null||h.resize()},1);setTimeout(()=>{clearInterval(p)},1)},[o,t]);const u=p=>{if(!p){console.log("no file selected");return}Array.from(p).forEach(h=>{const v=new FileReader;v.onload=m=>{var y;try{const x=JSON.parse((y=m.target)==null?void 0:y.result);if(x.type!=="FeatureCollection")throw new Error("Not a valid GeoJSON file, must be a FeatureCollection");i({featureCollection:x,name:h.name})}catch(x){console.log(x)}},v.readAsText(h)})},f=p=>{const h=p.target.files;u(h),p.target.value=""},b=p=>{p.preventDefault();const h=p.dataTransfer.files;u(h)};return e.jsxs("div",{className:"pageContainer",onDragOver:p=>p.preventDefault(),onDrop:b,children:[e.jsxs("header",{className:"mainHeader",children:[e.jsx("h1",{children:"μGIS"}),e.jsx("button",{type:"button",onClick:()=>r(!t),children:"Sidebar"}),e.jsx(Se,{}),e.jsx(pe,{})]}),e.jsxs("main",{className:"mainContainer",children:[e.jsxs("div",{className:`sidebarContainer ${t?"open":""}`,children:[e.jsx(Le,{setWidth:l,setOpen:r}),e.jsxs("aside",{className:"sidebar",style:{width:`${s}px`},children:[e.jsx("h2",{children:"Sidebar"}),e.jsx("button",{type:"button",onClick:d,children:a.every(p=>p.visible)?e.jsx(B,{}):e.jsx(O,{})}),e.jsx("div",{className:"layerListContainer",children:n&&e.jsx(Fe,{})}),e.jsxs("div",{className:"sidebarFooter",children:[e.jsxs("label",{htmlFor:"layerFileInput",children:[e.jsx(te,{}),"Upload GeoJSON file"]}),e.jsx("input",{id:"layerFileInput",type:"file",multiple:!0,accept:".geojson",onChange:f})]})]})]}),e.jsx("div",{className:"mapFlexContainer",children:e.jsx(de,{})})]})]})}re.createRoot(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsx(Te,{})}));

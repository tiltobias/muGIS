import{e as T,f as c,j as e,M as H,S as J,F as Z,h as q,k as X,l as Y,m as K,G as Q,X as _,n as D,o as ee,E as te,T as se,q as re,Z as ne,P as le,t as oe,w as I,x as U,U as ae,y as ie}from"./vendor-CWTJF5jC.js";import{m as E,M as ce}from"./vendor-mapbox-BnNDjcEO.js";import{b as z,i as A,u as ue,c as de,d as fe,a as F,f as R,v as me,e as $,g as pe,p as ye,h as O,l as he}from"./vendor-turf-DzUQQYEG.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function l(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=l(n);fetch(n.href,i)}})();const w=T(s=>({mapRef:c.createRef(),setMapRef:t=>s({mapRef:t}),mapReady:!1,setMapReady:t=>s({mapReady:t}),basemap:{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"},setBasemap:t=>s(l=>t.url===l.basemap.url?l:{basemap:t}),resetMapStore:()=>s(()=>({mapReady:!1,basemap:{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"}}))})),b=T(s=>({layers:[],resetLayerStore:()=>s(()=>({layers:[]})),loadProjectLayers:t=>s(()=>({layers:t})),addLayer:t=>s(l=>{const r=d=>l.layers.some(a=>a.id===d)?r(d+"1"):d,n=t.featureCollection.features[0].geometry.type,i=n==="Polygon"||n==="MultiPolygon"?"fill":n==="LineString"||n==="MultiLineString"?"line":n==="Point"||n==="MultiPoint"?"circle":null;if(!i)throw new Error("Unsupported geometry type: "+n);t.name||(t.name=i==="fill"?"polygon layer":i==="line"?"line layer":i==="circle"?"point layer":"not possible");const o={h:Math.floor(Math.random()*360),s:90,l:48,a:i==="fill"?.7:1};return{layers:[{featureCollection:t.featureCollection,id:r(t.name),name:t.name,renderingType:i,visible:!0,color:o},...l.layers]}}),moveLayerUp:t=>s(l=>{const r=l.layers.findIndex(i=>i.id===t);if(r===0)return l;const n=[...l.layers];return n.splice(r-1,0,n.splice(r,1)[0]),{layers:n}}),moveLayerDown:t=>s(l=>{const r=l.layers.findIndex(i=>i.id===t);if(r===l.layers.length-1)return l;const n=[...l.layers];return n.splice(r+1,0,n.splice(r,1)[0]),{layers:n}}),deleteLayer:t=>s(l=>({layers:l.layers.filter(r=>r.id!==t)})),toggleLayerVisibility:t=>s(l=>({layers:l.layers.map(r=>r.id===t?{...r,visible:!r.visible}:r)})),toggleLayerVisibilityAll:()=>s(t=>{const l=t.layers.every(r=>r.visible);return{layers:t.layers.map(r=>({...r,visible:!l}))}}),changeLayerColor:(t,l)=>s(r=>({layers:r.layers.map(n=>n.id===t?{...n,color:l}:n)})),updateAllLayers:()=>s(t=>({layers:t.layers.map(l=>({...l,updater:l.updater?l.updater+1:1}))})),changeLayerName:(t,l)=>s(r=>({layers:r.layers.map(n=>n.id===t?{...n,name:l}:n)}))}));E.accessToken="pk.eyJ1IjoidG9iaWFuZCIsImEiOiJjbTdiMGZwemwwNmxlMnFyNTV4YWh2ZzB3In0.B3fVZMQOYEs2V23kKWB5XQ";const xe=()=>{const{mapRef:s,mapReady:t,setMapReady:l,basemap:r}=w(),{addLayer:n,updateAllLayers:i}=b(),o=c.useRef(null);c.useEffect(()=>{var m,h,g,v,p,x;if(!t&&o.current){o.current.innerHTML="",s.current=new E.Map({container:o.current,style:r.url,center:[10.4,63.425],zoom:12}),(m=s.current)==null||m.addControl(new E.FullscreenControl,"top-right"),(h=s.current)==null||h.addControl(new E.NavigationControl({visualizePitch:!0}),"top-right"),(g=s.current)==null||g.addControl(new E.ScaleControl,"bottom-right");const j=new ce({displayControlsDefault:!1,controls:{point:!0,line_string:!0,polygon:!0},boxSelect:!1});(v=s.current)==null||v.addControl(j,"bottom-left"),(p=s.current)==null||p.on("draw.create",()=>{n({featureCollection:j.getAll(),name:null}),j.deleteAll()}),(x=s.current)==null||x.on("style.load",()=>{l(!0)})}},[s,n,t,l,r]);const[u,d]=c.useState(!1),a=c.useRef(r),[f,y]=c.useState(r);return c.useEffect(()=>{var m;a.current.url!==r.url&&(a.current=r),!u&&f.url!==a.current.url&&(d(!0),t&&s.current&&(s.current.setStyle(a.current.url),y(r)),(m=s.current)==null||m.once("style.load",()=>{i()}),setTimeout(()=>{d(!1)},200))},[r,s,t,u,f,i]),e.jsx("div",{ref:o,className:"mapContainer"})},k=(s,t,l=[])=>{c.useEffect(()=>{const r=n=>{const i=n.target;s.current&&!s.current.contains(i)&&!l.some(o=>{var u;return(u=o.current)==null?void 0:u.contains(i)})&&t()};return document.addEventListener("click",r),()=>{document.removeEventListener("click",r)}},[s,t,l])},ge=()=>{const[s,t]=c.useState(!1),l=c.useRef(null);k(l,()=>{t(!1)});const[r,n]=c.useState(null),{basemap:i,setBasemap:o}=w(),u=[{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"},{url:"mapbox://styles/mapbox/outdoors-v12",name:"Outdoors"},{url:"mapbox://styles/mapbox/light-v11",name:"Light"},{url:"mapbox://styles/mapbox/dark-v11",name:"Dark"},{url:"mapbox://styles/mapbox/satellite-v9",name:"Satellite"},{url:"mapbox://styles/mapbox/satellite-streets-v12",name:"Satellite Streets"},{url:"mapbox://styles/mapbox/navigation-day-v1",name:"Navigation Day"},{url:"mapbox://styles/mapbox/navigation-night-v1",name:"Navigation Night"},{url:"mapbox://styles/tobiand/cm8rbg7j900be01sa5wc6d4lq",name:"Off (white)"},{url:"mapbox://styles/tobiand/cm8rbd89l00az01sb97a8hfyh",name:"Off (black)"}];return e.jsxs("div",{className:"basemap",ref:l,children:[e.jsxs("button",{type:"button",onClick:()=>t(!s),children:[e.jsx(H,{})," Change basemap"]}),s&&e.jsx("div",{className:"basemapPopover",children:e.jsx("ul",{onMouseEnter:()=>{n(i)},onMouseLeave:()=>{o(r),n(null)},children:u.map(d=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{n(d)},onMouseEnter:()=>{o(d)},children:[r===null&&d.name===i.name||r!==null&&d.name===r.name?"*":"",d.name]})},d.name))})})]})},je=T(s=>({theme:localStorage.getItem("theme")||"light",setTheme:t=>s(l=>(localStorage.setItem("theme",t),t===l.theme?l:{theme:t}))})),be=()=>{const[s,t]=c.useState(!1),l=c.useRef(null);k(l,()=>{t(!1)});const{layers:r,resetLayerStore:n,loadProjectLayers:i}=b(),{basemap:o,setBasemap:u,resetMapStore:d}=w(),{theme:a,setTheme:f}=je(),y=()=>{n(),d()},m=()=>{const p={layers:r,basemap:o},x=new Blob([JSON.stringify(p)],{type:"application/json"}),j=URL.createObjectURL(x),L=document.createElement("a");L.href=j,L.download="μGIS_project.mugis",document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(j)},h=c.useRef(null),g=()=>{var p;(p=h.current)==null||p.click()},v=p=>{const x=p.target.files;if(!x){console.log("no file selected");return}const j=new FileReader;j.onload=L=>{var P;try{const N=JSON.parse((P=L.target)==null?void 0:P.result);i(N.layers),u(N.basemap)}catch(N){console.log(N)}},j.readAsText(x[0])};return c.useEffect(()=>{document.documentElement.setAttribute("data-theme",a)},[a]),e.jsxs("div",{className:"settings",ref:l,children:[e.jsx("button",{type:"button",onClick:()=>{t(!s)},children:e.jsx(J,{})}),s&&e.jsx("div",{className:"settingsPopover",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:y,children:[e.jsx(Z,{})," New project"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:m,children:[e.jsx(q,{})," Save project"]})}),e.jsxs("li",{children:[e.jsx("input",{ref:h,type:"file",accept:".mugis",onChange:v}),e.jsxs("button",{type:"button",onClick:g,children:[e.jsx(X,{})," Load project"]})]}),e.jsx("li",{children:e.jsx(ge,{})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{f(a==="light"?"dark":"light")},children:[a==="light"?e.jsx(Y,{}):e.jsx(K,{})," Toggle theme"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{},children:[e.jsx(Q,{})," Start tutorial"]})})]})})]})},S=({children:s,buttonLabel:t,onFormSubmit:l})=>{const[r,n]=c.useState(!1),[i,o]=c.useState(!1);return e.jsxs("div",{children:[e.jsx("button",{type:"button",onClick:()=>n(!r),children:t}),r&&e.jsx("div",{className:"cover",onClick:u=>{u.target===u.currentTarget&&n(!1)},children:e.jsx("div",{className:"modal"+(i?" loading":""),children:e.jsxs("form",{onSubmit:u=>{u.preventDefault(),o(!0),setTimeout(()=>{l()&&n(!1),o(!1)},0)},children:[e.jsx("button",{type:"button",className:"modalCloseButton",onClick:()=>n(!1),children:e.jsx(_,{})}),e.jsx("h3",{children:t}),s,e.jsx("button",{type:"submit",children:"Submit"})]})})})]})};function V({size:s=120}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 120 120",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{style:{fill:"none",stroke:"currentColor",strokeWidth:16,strokeLinejoin:"round",strokeOpacity:1},d:"M 15,55 50,80 70,40 105,65"}),e.jsx("circle",{cx:"15",cy:"55",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"50",cy:"80",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"70",cy:"40",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"105",cy:"65",r:"12",fill:"currentColor"})]})}function W({size:s=120}){return e.jsx("svg",{width:s,height:s,viewBox:"0 0 120 120",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("circle",{cx:"60",cy:"60",r:"25",fill:"currentColor"})})}function G({size:s=120}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 120 120",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{style:{fill:"currentColor",stroke:"currentColor",strokeWidth:16,strokeLinejoin:"round",strokeOpacity:1,fillOpacity:.5},d:"M 60,17 100,48 88,95 H 32 L 20,48 60,17"}),e.jsx("circle",{cx:"60",cy:"17",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"100",cy:"48",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"88",cy:"95",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"32",cy:"95",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"20",cy:"48",r:"12",fill:"currentColor"})]})}const B=({name:s,type:t,index:l,color:r,onRemove:n})=>e.jsxs("div",{className:"layerItem",children:[e.jsxs("span",{className:"layerIndex",children:[l+1,"."]}),e.jsxs("div",{className:"colorPickerButton",style:{color:`hsl(${r.h},${r.s}%,${r.l}%)`},children:[t==="circle"&&e.jsx(W,{}),t==="line"&&e.jsx(V,{}),t==="fill"&&e.jsx("div",{className:"polygonShrinker",children:e.jsx(G,{})})]}),e.jsx("div",{className:"layerName",children:e.jsx("span",{children:s})}),n&&e.jsx("button",{type:"button",onClick:i=>{n(),i.stopPropagation()},children:e.jsx(D,{})})]}),C=({selectedLayers:s,setSelectedLayers:t,renderingType:l=void 0,multiple:r=!1,unselectableLayerIds:n=[]})=>{const{layers:i}=b(),[o,u]=c.useState(!1),d=c.useRef(null),a=c.useRef(null);return k(d,()=>{u(!1)}),c.useEffect(()=>{var f,y,m,h,g,v;d.current&&a.current&&((y=a.current)==null||y.style.setProperty("max-height",`${window.innerHeight-((f=d.current)==null?void 0:f.getBoundingClientRect().bottom)-10}px`),(h=a.current)==null||h.style.setProperty("width",`${(m=d.current)==null?void 0:m.getBoundingClientRect().width}px`),(v=a.current)==null||v.style.setProperty("top",`${((g=d.current)==null?void 0:g.getBoundingClientRect().bottom)+window.scrollY}px`))},[o,s]),c.useEffect(()=>{s.forEach(f=>{n.includes(f.id)&&t(y=>y.filter(m=>m.id!==f.id))})},[n,s,t]),e.jsxs("div",{className:"selectLayersContainer",ref:d,onClick:()=>{u(!o)},children:[e.jsx("ol",{className:"selectedList",children:s.length===0?e.jsx("p",{children:"No layer selected"}):i.map((f,y)=>l&&f.renderingType!==l||!s.some(m=>m.id===f.id)?null:e.jsx("li",{children:e.jsx(B,{name:f.name,type:f.renderingType,index:y,color:f.color,onRemove:()=>{t(m=>m.filter(h=>h.id!==f.id))}})},f.id))}),o&&e.jsxs("div",{className:"selectListContainer",onClick:f=>{r&&f.stopPropagation()},ref:a,children:[e.jsx("h4",{children:"Select Layers"}),e.jsx("ol",{className:"selectList",children:i.map((f,y)=>l&&f.renderingType!==l||s.some(m=>m.id===f.id)||n.includes(f.id)?null:e.jsx("li",{className:"selectListItem",onClick:()=>{t(r?m=>[...m,f]:[f])},children:e.jsx(B,{name:f.name,type:f.renderingType,index:y,color:f.color})},f.id))||e.jsx("p",{children:"No layers available"})})]})]})},ve=()=>{const{addLayer:s}=b(),[t,l]=c.useState([]),[r,n]=c.useState(""),[i,o]=c.useState("");c.useEffect(()=>{t[0]&&o(`buffer(${t[0].name}, ${r}m)`)},[t,r]);const u=()=>{if(!t[0]||r==="")return alert("Please select a layer and enter a radius"),!1;const d=t[0].featureCollection,a=z(d,r*.001,{units:"kilometers"});return!a||a.features.length===0?(alert("No results found"),!1):(s({featureCollection:a,name:i}),!0)};return e.jsxs(S,{buttonLabel:"Buffer",onFormSubmit:u,children:[e.jsx(C,{selectedLayers:t,setSelectedLayers:l}),"buffer radius [m]: ",r,e.jsx("input",{type:"number",value:r,onChange:d=>n(d.target.value)}),e.jsx("input",{type:"text",value:i,onChange:d=>o(d.target.value)})]})},Le=()=>{const{addLayer:s}=b(),[t,l]=c.useState([]),[r,n]=c.useState("");c.useEffect(()=>{if(t&&t.length>=2){let o=t[0].name;for(let u=1;u<t.length;u++)o+=`, ${t[u].name}`;n(`intersect(${o})`)}},[t]);const i=()=>{if(!t||t.length<2)return alert("Please select two layers"),!1;const o={type:"FeatureCollection",features:t[0].featureCollection.features};for(let u=1;u<t.length;u++){const d=t[u].featureCollection,a=[];o.features.forEach(f=>{d.features.forEach(y=>{const m=A({type:"FeatureCollection",features:[f,y]});m&&a.push(m)})}),o.features=a}return!o||o.features.length===0?(alert("No results found"),!1):(s({featureCollection:o,name:r}),!0)};return e.jsxs(S,{buttonLabel:"Intersect",onFormSubmit:i,children:[e.jsx(C,{selectedLayers:t,setSelectedLayers:l,renderingType:"fill",multiple:!0}),e.jsx("input",{type:"text",value:r,onChange:o=>n(o.target.value)})]})},Ce=()=>{const{addLayer:s}=b(),[t,l]=c.useState([]),[r,n]=c.useState("");c.useEffect(()=>{if(t&&t.length>=2){let o=t[0].name;for(let u=1;u<t.length;u++)o+=`, ${t[u].name}`;n(`union(${o})`)}},[t]);const i=()=>{if(!t||t.length<2)return alert("Please select two layers"),!1;const o=t.flatMap(d=>d.featureCollection.features),u=ue({type:"FeatureCollection",features:o});return u?(s({featureCollection:{type:"FeatureCollection",features:[u]},name:r}),!0):(alert("No results found"),!1)};return e.jsxs(S,{buttonLabel:"Union",onFormSubmit:i,children:[e.jsx(C,{selectedLayers:t,setSelectedLayers:l,renderingType:"fill",multiple:!0}),e.jsx("input",{type:"text",value:r,onChange:o=>n(o.target.value)})]})},Se=()=>{var d;const{addLayer:s}=b(),[t,l]=c.useState([]),[r,n]=c.useState([]),[i,o]=c.useState("");c.useEffect(()=>{t[0]&&r[0]&&o(`difference(${t[0].name}, ${r[0].name})`)},[t,r]);const u=()=>{if(!t[0]||!r[0])return alert("Please select two layers"),!1;const a={type:"FeatureCollection",features:[]},f=t[0].featureCollection,y=r[0].featureCollection,m=de(y).features[0];return f.features.forEach(h=>{const g=fe({type:"FeatureCollection",features:[h,m]});g&&a.features.push(g)}),!a||a.features.length===0?(alert("No results found"),!1):(s({featureCollection:a,name:i}),!0)};return e.jsxs(S,{buttonLabel:"Difference",onFormSubmit:u,children:["select base layer:",e.jsx(C,{selectedLayers:t,setSelectedLayers:l,renderingType:"fill"}),"select layer to subtract:",e.jsx(C,{selectedLayers:r,setSelectedLayers:n,renderingType:"fill",unselectableLayerIds:[(d=t[0])==null?void 0:d.id]}),e.jsx("input",{type:"text",value:i,onChange:a=>o(a.target.value)})]})},Ne=()=>{var f;const{addLayer:s}=b(),[t,l]=c.useState([]),[r,n]=c.useState(!1),[i,o]=c.useState(void 0),[u,d]=c.useState("");c.useEffect(()=>{t[0]&&d(r&&i?`dissolve(${t[0].name}, ${i})`:`dissolve(${t[0].name})`)},[t,r,i]);const a=()=>{if(!t[0])return alert("Please select a layer"),!1;const y=t[0].featureCollection,m=r&&i?F(R(y),{propertyName:i}):F(R(y));return!m||m.features.length===0?(alert("No results found"),!1):(s({featureCollection:m,name:u}),!0)};return e.jsxs(S,{buttonLabel:"Dissolve",onFormSubmit:a,children:["select layer:",e.jsx(C,{selectedLayers:t,setSelectedLayers:l,renderingType:"fill"}),e.jsxs("span",{children:[e.jsx("input",{type:"checkbox",checked:r,onChange:y=>n(y.target.checked),id:"checkboxPropertyEnabled"}),e.jsxs("label",{htmlFor:"checkboxPropertyEnabled",children:["dissolve by property: ",r&&i]})]}),e.jsxs("select",{required:!0,disabled:!r,value:i,onChange:y=>o(y.target.value),children:[e.jsx("option",{value:"",children:"Select a property"}),((f=t[0])==null?void 0:f.featureCollection.features[0].properties)&&Object.keys(t[0].featureCollection.features[0].properties).map(y=>e.jsx("option",{value:y,children:y},y))]}),e.jsx("input",{type:"text",value:u,onChange:y=>d(y.target.value)})]})},we=()=>{const{addLayer:s}=b(),[t,l]=c.useState([]),[r,n]=c.useState("");c.useEffect(()=>{t[0]&&n(`voronoi(${t[0].name})`)},[t]);const i=()=>{if(!t[0])return alert("Please select a layer"),!1;const o=R(t[0].featureCollection),u=me(o,{bbox:$(o)});return!u||u.features.length===0?(alert("No results found"),!1):(u.features=u.features.filter(d=>d.geometry.type==="Polygon"),s({featureCollection:u,name:r}),!0)};return e.jsxs(S,{buttonLabel:"Voronoi",onFormSubmit:i,children:["select layer:",e.jsx(C,{selectedLayers:t,setSelectedLayers:l,renderingType:"circle"}),e.jsx("input",{type:"text",value:r,onChange:o=>n(o.target.value)})]})},ke=()=>{const{addLayer:s}=b(),[t,l]=c.useState([]),[r,n]=c.useState("");c.useEffect(()=>{if(t&&t.length>=1){let o=t[0].name;for(let u=1;u<t.length;u++)o+=`, ${t[u].name}`;n(`bbox(${o})`)}},[t]);const i=()=>{if(!t||t.length<1)return alert("Please select one or more layers"),!1;const o=t.flatMap(d=>d.featureCollection.features),u=pe($({type:"FeatureCollection",features:o}));return u?(s({featureCollection:{type:"FeatureCollection",features:[u]},name:r}),!0):(alert("No results found"),!1)};return e.jsxs(S,{buttonLabel:"Bbox",onFormSubmit:i,children:[e.jsx(C,{selectedLayers:t,setSelectedLayers:l,multiple:!0}),e.jsx("input",{type:"text",value:r,onChange:o=>n(o.target.value)})]})},Pe=()=>{var d;const{addLayer:s}=b(),[t,l]=c.useState([]),[r,n]=c.useState([]),[i,o]=c.useState("");c.useEffect(()=>{t[0]&&r[0]&&o(`clip(${r[0].name}, ${t[0].name})`)},[r,t]);const u=()=>{if(!t[0]||!r[0])return alert("Please select two layers"),!1;let a={type:"FeatureCollection",features:[]};if(r[0].renderingType==="circle")a=ye(r[0].featureCollection,t[0].featureCollection);else if(r[0].renderingType==="fill"){const f=t[0].featureCollection,y=r[0].featureCollection;f.features.forEach(m=>{y.features.forEach(h=>{const g=A({type:"FeatureCollection",features:[h,m]});g&&a.features.push(g)})})}else if(r[0].renderingType==="line"){const f=R(t[0].featureCollection),y=R(r[0].featureCollection);f.features.forEach(m=>{const h=z(m,.01,{units:"meters"});y.features.forEach(g=>{O(g,h)?a.features.push(g):he(g,m).features.forEach(p=>{O(p,h)&&a.features.push(p)})})})}else throw new Error("Unknown rendering type");return!a||a.features.length===0?(alert("No results found"),!1):(s({featureCollection:a,name:i}),!0)};return e.jsxs(S,{buttonLabel:"Clip",onFormSubmit:u,children:["select layer:",e.jsx(C,{selectedLayers:r,setSelectedLayers:n}),"select mask layer:",e.jsx(C,{selectedLayers:t,setSelectedLayers:l,renderingType:"fill",unselectableLayerIds:[(d=r[0])==null?void 0:d.id]}),e.jsx("input",{type:"text",value:i,onChange:a=>o(a.target.value)})]})},Ee=()=>e.jsxs(e.Fragment,{children:[e.jsx(ve,{}),e.jsx(Le,{}),e.jsx(Ce,{}),e.jsx(Se,{}),e.jsx(Ne,{}),e.jsx(we,{}),e.jsx(ke,{}),e.jsx(Pe,{})]}),Re=({setWidth:s,setOpen:t})=>{const{mapRef:l}=w(),r=c.useRef(null),[n,i]=c.useState(!1),o=a=>{i(!0),a.preventDefault(),a.stopPropagation()},u=c.useCallback(()=>{i(!1),setTimeout(()=>{var a;(a=l.current)==null||a.resize()},1),setTimeout(()=>{var a;(a=l.current)==null||a.resize()},100)},[l]),d=c.useCallback(a=>{var f;n&&((f=l.current)==null||f.resize(),s(a.clientX),a.clientX<100?t(!1):t(!0))},[n,l,s,t]);return c.useEffect(()=>(window.addEventListener("mousemove",d),window.addEventListener("mouseup",u),()=>{window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",u)}),[n,d,u]),e.jsx("div",{className:`resizeHandle ${n?"resizing":""}`,onMouseDown:o,ref:r})},Te=({color:s,onChange:t,layerType:l})=>{const[r,n]=c.useState(!1),i=c.useRef(null);return k(i,()=>{n(!1)}),e.jsxs("div",{className:"colorPicker",ref:i,children:[e.jsxs("button",{type:"button",className:"colorPickerButton",onClick:()=>{n(!r)},style:{color:`hsl(${s.h},${s.s}%,${s.l}%)`},children:[l==="circle"&&e.jsx(W,{}),l==="line"&&e.jsx(V,{}),l==="fill"&&e.jsx("div",{className:"polygonShrinker",children:e.jsx(G,{})})]}),r&&e.jsx("div",{className:"colorPickerPopover",children:e.jsx(ee,{color:s,onChange:o=>{t(o)}})})]})},$e=({layerId:s,initialLayerName:t,isEditing:l,setIsEditing:r,closeMenu:n})=>{const{changeLayerName:i}=b(),[o,u]=c.useState(t),d=c.useRef(null);return c.useEffect(()=>{l&&d.current&&d.current.focus()},[l,d]),k(d,()=>{l&&(i(s,o),r(!1),n())}),e.jsx("div",{className:"layerNameContainer",children:l?e.jsx("form",{onSubmit:a=>{a.preventDefault(),i(s,o),r(!1)},children:e.jsx("input",{type:"text",value:o,onChange:a=>u(a.target.value),ref:d,onFocus:()=>r(!0),onBlur:()=>i(s,o)})}):e.jsx("div",{className:"layerName",children:e.jsx("span",{onDoubleClick:()=>r(!0),children:o})})})},Me=({layerData:s,layerAboveId:t,index:l})=>{const[r,n]=c.useState(!1),i=c.useRef(null);k(i,()=>{n(!1)});const{deleteLayer:o,toggleLayerVisibility:u,changeLayerColor:d}=b(),{mapRef:a}=w();c.useEffect(()=>{var p,x,j,L;(p=a.current)!=null&&p.getSource(s.id)||(x=a.current)==null||x.addSource(s.id,{type:"geojson",data:s.featureCollection}),(j=a.current)!=null&&j.getLayer(s.id)||(L=a.current)==null||L.addLayer({id:s.id,type:s.renderingType,source:s.id,paint:s.renderingType==="fill"?{"fill-color":`hsl(${s.color.h},${s.color.s}%,${s.color.l}%)`,"fill-opacity":s.color.a}:s.renderingType==="line"?{"line-color":`hsl(${s.color.h},${s.color.s}%,${s.color.l}%)`,"line-opacity":s.color.a,"line-width":2}:s.renderingType==="circle"?{"circle-color":`hsl(${s.color.h},${s.color.s}%,${s.color.l}%)`,"circle-opacity":s.color.a,"circle-radius":5}:{}})},[a,s]),c.useEffect(()=>{var p;(p=a.current)==null||p.moveLayer(s.id,t)},[t,s.id,a,s.updater]),c.useEffect(()=>{var p;(p=a.current)==null||p.setLayoutProperty(s.id,"visibility",s.visible?"visible":"none")},[s.visible,a,s.id,s.updater]);const f=p=>{var x,j,L,P,N,M;d(s.id,p),s.renderingType==="fill"?((x=a.current)==null||x.setPaintProperty(s.id,"fill-color",`hsl(${p.h},${p.s}%,${p.l}%)`),(j=a.current)==null||j.setPaintProperty(s.id,"fill-opacity",p.a)):s.renderingType==="line"?((L=a.current)==null||L.setPaintProperty(s.id,"line-color",`hsl(${p.h},${p.s}%,${p.l}%)`),(P=a.current)==null||P.setPaintProperty(s.id,"line-opacity",p.a)):s.renderingType==="circle"&&((N=a.current)==null||N.setPaintProperty(s.id,"circle-color",`hsl(${p.h},${p.s}%,${p.l}%)`),(M=a.current)==null||M.setPaintProperty(s.id,"circle-opacity",p.a))},y=()=>{var p,x;(p=a.current)==null||p.removeLayer(s.id),(x=a.current)==null||x.removeSource(s.id),o(s.id)},m=()=>{const p=new Blob([JSON.stringify(s.featureCollection)],{type:"application/geo+json"}),x=URL.createObjectURL(p),j=document.createElement("a");j.href=x,j.download=s.name+".geojson",document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(x)},h=()=>{var x;const p=$(s.featureCollection).slice(0,4);(x=a.current)==null||x.fitBounds(p,{padding:20})},[g,v]=c.useState(!1);return e.jsxs("div",{className:"layerItem",children:[e.jsxs("span",{className:"layerIndex",children:[l+1,"."]}),e.jsx(Te,{color:s.color,onChange:f,layerType:s.renderingType}),e.jsx($e,{layerId:s.id,initialLayerName:s.name,isEditing:g,setIsEditing:v,closeMenu:()=>n(!1)}),e.jsxs("div",{className:`layerMenu ${r?"open":""}`,ref:i,children:[e.jsx("button",{type:"button",onClick:()=>{n(!r)},children:e.jsx(te,{})}),r&&e.jsx("div",{className:"layerMenuPopover",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:y,children:[e.jsx(se,{})," Delete layer"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:m,children:[e.jsx(re,{})," Download layer"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:h,children:[e.jsx(ne,{})," Zoom to layer"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:p=>{p.stopPropagation(),v(!g)},children:[g?e.jsx(oe,{}):e.jsx(le,{})," Edit layer name"]})})]})})]}),e.jsx("button",{type:"button",onClick:()=>u(s.id),children:s.visible?e.jsx(I,{}):e.jsx(U,{})})]})},Fe=()=>{const{layers:s,moveLayerUp:t,moveLayerDown:l}=b(),[r,n]=c.useState(null),[i,o]=c.useState(null);c.useEffect(()=>{r!==null&&o(r)},[r]);const u=(f,y)=>{n(y),f.dataTransfer.setDragImage(new Image,0,0)},d=(f,y)=>{f.preventDefault(),f.dataTransfer.dropEffect="move",!(r===null||r===y)&&(s.findIndex(m=>m.id===r)<s.findIndex(m=>m.id===y)?l(r):t(r))},a=()=>{n(null)};return e.jsx("ol",{className:"layerList",children:s.map((f,y)=>e.jsx("li",{draggable:!0,className:`layerListItem ${i===f.id?"hovering":""}`,onDragStart:m=>u(m,f.id),onDragOver:m=>d(m,f.id),onDragEnd:a,onMouseOver:()=>r===null?o(f.id):void 0,onMouseOut:()=>r===null?o(null):void 0,children:e.jsx(Me,{layerData:f,layerAboveId:y===0?void 0:s[y-1].id,index:y})},f.id))})};function Oe(){const[s,t]=c.useState(!0),[l,r]=c.useState(300),{layers:n,addLayer:i,toggleLayerVisibilityAll:o}=b(),{mapRef:u,mapReady:d}=w();c.useEffect(()=>{const m=setInterval(()=>{var h;(h=u.current)==null||h.resize()},1);setTimeout(()=>{clearInterval(m)},1)},[u,s]);const a=m=>{if(!m){console.log("no file selected");return}Array.from(m).forEach(h=>{const g=new FileReader;g.onload=v=>{var p;try{const x=JSON.parse((p=v.target)==null?void 0:p.result);if(x.type!=="FeatureCollection")throw new Error("Not a valid GeoJSON file, must be a FeatureCollection");i({featureCollection:x,name:h.name})}catch(x){console.log(x)}},g.readAsText(h)})},f=m=>{const h=m.target.files;a(h),m.target.value=""},y=m=>{m.preventDefault();const h=m.dataTransfer.files;a(h)};return e.jsxs("div",{className:"pageContainer",onDragOver:m=>m.preventDefault(),onDrop:y,children:[e.jsxs("header",{className:"mainHeader",children:[e.jsx("h1",{children:"μGIS"}),e.jsx("button",{type:"button",onClick:()=>t(!s),children:"Sidebar"}),e.jsx(Ee,{}),e.jsx(be,{})]}),e.jsxs("main",{className:"mainContainer",children:[e.jsxs("div",{className:`sidebarContainer ${s?"open":""}`,children:[e.jsx(Re,{setWidth:r,setOpen:t}),e.jsxs("aside",{className:"sidebar",style:{width:`${l}px`},children:[e.jsx("h2",{children:"Sidebar"}),e.jsx("button",{type:"button",onClick:o,children:n.every(m=>m.visible)?e.jsx(I,{}):e.jsx(U,{})}),e.jsx("div",{className:"layerListContainer",children:d&&e.jsx(Fe,{})}),e.jsxs("div",{className:"sidebarFooter",children:[e.jsxs("label",{htmlFor:"layerFileInput",children:[e.jsx(ae,{}),"Upload GeoJSON file"]}),e.jsx("input",{id:"layerFileInput",type:"file",multiple:!0,accept:".geojson",onChange:f})]})]})]}),e.jsx("div",{className:"mapFlexContainer",children:e.jsx(xe,{})})]})]})}ie.createRoot(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsx(Oe,{})}));

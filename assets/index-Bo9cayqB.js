import{r as h,j as e,a as T,E as $,T as O,F as M,Z as I,C as F,b as B,c as E,d as w,e as U}from"./vendor-react-CJdBGvrx.js";import{m as j}from"./vendor-mapbox-BXanVIXe.js";import{b as V,a as Z}from"./vendor-turf-DFyfF60h.js";import"./vendor-PCuCHA1E.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))u(s);new MutationObserver(s=>{for(const d of s)if(d.type==="childList")for(const f of d.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&u(f)}).observe(document,{childList:!0,subtree:!0});function a(s){const d={};return s.integrity&&(d.integrity=s.integrity),s.referrerPolicy&&(d.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?d.credentials="include":s.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function u(s){if(s.ep)return;s.ep=!0;const d=a(s);fetch(s.href,d)}})();j.accessToken="pk.eyJ1IjoidG9iaWFuZCIsImEiOiJjbTdiMGZwemwwNmxlMnFyNTV4YWh2ZzB3In0.B3fVZMQOYEs2V23kKWB5XQ";const z=({mapRef:i})=>(h.useEffect(()=>{var n,a,u;i.current||(i.current=new j.Map({container:"mapContainer",style:"mapbox://styles/mapbox/streets-v12",center:[10.4,63.425],zoom:12}),(n=i.current)==null||n.addControl(new j.FullscreenControl,"top-right"),(a=i.current)==null||a.addControl(new j.NavigationControl({visualizePitch:!0}),"top-right"),(u=i.current)==null||u.addControl(new j.ScaleControl,"bottom-right"))},[]),e.jsx("div",{id:"mapContainer",className:"mapContainer"})),k=(i,n)=>{h.useEffect(()=>{let a=!1,u=!1;const s=f=>{a||!u||!i.current||i.current.contains(f.target)||n()},d=f=>{u=!!i.current,a=!!i.current&&i.current.contains(f.target)};return document.addEventListener("mousedown",d),document.addEventListener("touchstart",d),document.addEventListener("click",s),()=>{document.removeEventListener("mousedown",d),document.removeEventListener("touchstart",d),document.removeEventListener("click",s)}},[i,n])},A=({color:i,onChange:n})=>{const[a,u]=h.useState(!1),s=h.useRef(null);return k(s,()=>{u(!1)}),e.jsxs("div",{className:"colorPicker",children:[e.jsx("button",{type:"button",className:"colorPickerButton",onClick:()=>{u(!a)},style:{backgroundColor:`hsl(${i.h},${i.s}%,${i.l}%)`}}),a&&e.jsx("div",{className:"colorPickerPopover",ref:s,children:e.jsx(T,{color:i,onChange:d=>{n(d)}})})]})},J=({mapRef:i,layerData:n,handleLayerUp:a,handleLayerDown:u,layerAboveId:s,handleDeleteLayer:d,handleToggleVisibility:f})=>{const[L]=h.useState(n.name),[p,P]=h.useState({h:Math.floor(Math.random()*360),s:90,l:48,a:n.renderingType==="fill"?.7:1}),[g,v]=h.useState(!1),C=h.useRef(null);k(C,()=>{v(!1)}),h.useEffect(()=>{var t,l,c,b;(t=i.current)!=null&&t.getSource(n.id)||(l=i.current)==null||l.addSource(n.id,{type:"geojson",data:n.featureCollection}),(c=i.current)!=null&&c.getLayer(n.id)||(b=i.current)==null||b.addLayer({id:n.id,type:n.renderingType,source:n.id,paint:n.renderingType==="fill"?{"fill-color":`hsl(${p.h},${p.s}%,${p.l}%)`,"fill-opacity":p.a}:n.renderingType==="line"?{"line-color":`hsl(${p.h},${p.s}%,${p.l}%)`,"line-opacity":p.a,"line-width":2}:n.renderingType==="circle"?{"circle-color":`hsl(${p.h},${p.s}%,${p.l}%)`,"circle-opacity":p.a,"circle-radius":5}:{}})},[]),h.useEffect(()=>{var t;(t=i.current)==null||t.moveLayer(n.id,s)},[s]),h.useEffect(()=>{var t;(t=i.current)==null||t.setLayoutProperty(n.id,"visibility",n.visible?"visible":"none")},[n.visible]);const N=t=>{var l,c,b,y,m,x;P(t),n.renderingType==="fill"?((l=i.current)==null||l.setPaintProperty(n.id,"fill-color",`hsl(${t.h},${t.s}%,${t.l}%)`),(c=i.current)==null||c.setPaintProperty(n.id,"fill-opacity",t.a)):n.renderingType==="line"?((b=i.current)==null||b.setPaintProperty(n.id,"line-color",`hsl(${t.h},${t.s}%,${t.l}%)`),(y=i.current)==null||y.setPaintProperty(n.id,"line-opacity",t.a)):n.renderingType==="circle"&&((m=i.current)==null||m.setPaintProperty(n.id,"circle-color",`hsl(${t.h},${t.s}%,${t.l}%)`),(x=i.current)==null||x.setPaintProperty(n.id,"circle-opacity",t.a))},r=()=>{const t=new Blob([JSON.stringify(n.featureCollection)],{type:"application/geo+json"}),l=URL.createObjectURL(t),c=document.createElement("a");c.href=l,c.download=n.id+".geojson",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(l)},o=()=>{var l;const t=V(n.featureCollection).slice(0,4);(l=i.current)==null||l.fitBounds(t,{padding:20})};return e.jsx("li",{className:"layerListItem",children:e.jsxs("div",{className:"layerItem",children:[e.jsx(A,{color:p,onChange:N}),e.jsx("div",{className:"layerName",children:L}),e.jsxs("div",{className:"layerMenu",children:[e.jsx("button",{type:"button",onClick:()=>{v(!g)},children:e.jsx($,{})}),g&&e.jsx("div",{className:"layerMenuPopover",ref:C,children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("button",{type:"button",onClick:d,children:e.jsx(O,{})})}),e.jsx("li",{children:e.jsx("button",{type:"button",onClick:r,children:e.jsx(M,{})})}),e.jsx("li",{children:e.jsx("button",{type:"button",onClick:o,children:e.jsx(I,{})})})]})})]}),e.jsxs("div",{className:"layerMoveControls",children:[e.jsx("button",{type:"button",onClick:a,children:e.jsx(F,{})}),e.jsx("button",{type:"button",onClick:u,children:e.jsx(B,{})})]}),e.jsx("button",{type:"button",onClick:f,children:n.visible?e.jsx(E,{}):e.jsx(w,{})})]})})};function G(){const[i,n]=h.useState(!0),a=h.useRef(null),[u,s]=h.useState([]),d=()=>{n(!i),setTimeout(()=>{var r;(r=a.current)==null||r.resize()},1),setTimeout(()=>{var r;(r=a.current)==null||r.resize()},100)},f=r=>u.some(o=>o.id===r)?f(r+"1"):r,L=r=>{const o=r.target.files;if(!o){console.log("no file selected");return}Array.from(o).forEach(t=>{const l=new FileReader;l.onload=c=>{var b;try{const y=JSON.parse((b=c.target)==null?void 0:b.result);if(y.type!=="FeatureCollection")throw new Error("Not a valid GeoJSON file, must be a FeatureCollection");const m=y.features[0].geometry.type,x=m==="Polygon"||m==="MultiPolygon"?"fill":m==="LineString"||m==="MultiLineString"?"line":m==="Point"||m==="MultiPoint"?"circle":null;if(!x)throw new Error("Unsupported geometry type: "+m);s(S=>[{featureCollection:y,id:f(t.name),name:t.name,renderingType:x,visible:!0},...S])}catch(y){console.log(y)}},l.readAsText(t)})},p=r=>{s(o=>{const t=o.findIndex(c=>c.id===r);if(t===0)return o;const l=[...o];return l.splice(t-1,0,l.splice(t,1)[0]),l})},P=r=>{s(o=>{const t=o.findIndex(c=>c.id===r);if(t===o.length-1)return o;const l=[...o];return l.splice(t+1,0,l.splice(t,1)[0]),l})},g=r=>{var o,t;s(l=>l.filter(c=>c.id!==r)),(o=a.current)==null||o.removeLayer(r),(t=a.current)==null||t.removeSource(r)},v=r=>{var t;const o=u.find(l=>l.id===r);s(l=>l.map(c=>c.id===r?{...c,visible:!c.visible}:c)),(t=a.current)==null||t.setLayoutProperty(r,"visibility",o!=null&&o.visible?"none":"visible")},C=()=>{const r=u.every(o=>o.visible);s(o=>o.map(t=>({...t,visible:!r})))},N=()=>{const r=u[0],o=Z(r.featureCollection,.05);o?s(t=>[{featureCollection:o,id:f(r.id+"_buffer"),name:r.name+"_buffer",renderingType:"fill",visible:!0},...t]):console.error("Buffer operation failed")};return e.jsxs("div",{className:"pageContainer",children:[e.jsxs("header",{className:"mainHeader",children:[e.jsx("h1",{children:"Î¼GIS"}),e.jsx("button",{type:"button",onClick:d,children:"Sidebar"}),e.jsx("button",{type:"button",onClick:N,children:"Buffer"})]}),e.jsxs("main",{className:"mainContainer",children:[e.jsx("div",{className:`sidebarContainer ${i?"open":""}`,children:e.jsxs("aside",{className:"sidebar",children:[e.jsx("h2",{children:"Sidebar"}),e.jsx("button",{type:"button",onClick:C,children:u.every(r=>r.visible)?e.jsx(E,{}):e.jsx(w,{})}),e.jsx("ol",{className:"layerList",children:u.map((r,o)=>e.jsx(J,{mapRef:a,layerData:r,handleLayerUp:()=>p(r.id),handleLayerDown:()=>P(r.id),layerAboveId:o===0?void 0:u[o-1].id,handleDeleteLayer:()=>g(r.id),handleToggleVisibility:()=>v(r.id)},r.id))}),e.jsxs("div",{className:"sidebarFooter",children:[e.jsx("label",{htmlFor:"layerFileInput",children:"Upload Layer Data"}),e.jsx("input",{id:"layerFileInput",type:"file",multiple:!0,accept:".geojson,.json",onChange:L})]})]})}),e.jsx("div",{className:"mapFlexContainer",children:e.jsx(z,{mapRef:a})})]})]})}U.createRoot(document.getElementById("root")).render(e.jsx(h.StrictMode,{children:e.jsx(G,{})}));

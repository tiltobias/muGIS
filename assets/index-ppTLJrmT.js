import{e as V,f as u,j as e,M as me,S as he,F as ye,h as xe,k as be,l as ge,m as je,G as ve,X as D,I as ee,n as te,C as Le,o as Ce,q as Se,t as Ne,w as we,x as ke,y as Fe,z as Pe,E as Te,T as se,P as Ee,A as Oe,Z as Ie,B as Re,D as re,H as ne,J as oe,K as $e,L as W,N as H,O as Me,Q as Be,U as Ae,V as Ue,W as Ve,Y as We,_ as He,$ as ze,a0 as qe,a1 as Ge}from"./vendor-1ZAvUA_E.js";import{m as B,M as Je}from"./vendor-mapbox-BqvCt9Kj.js";import{b as le,i as ae,u as Ze,c as Ye,d as Ke,a as Y,f as $,v as Xe,e as z,g as _e,p as Qe,h as K,l as De}from"./vendor-turf-8u3JTLNS.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function a(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=a(o);fetch(o.href,i)}})();const M=V(s=>({mapRef:u.createRef(),setMapRef:t=>s({mapRef:t}),mapReady:!1,setMapReady:t=>s({mapReady:t}),basemap:{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"},setBasemap:t=>s(a=>t.url===a.basemap.url?a:{basemap:t}),resetMapStore:()=>s(()=>({mapReady:!1,basemap:{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"}}))}));function X(s){return s==="Polygon"||s==="MultiPolygon"?"fill":s==="LineString"||s==="MultiLineString"?"line":s==="Point"||s==="MultiPoint"?"circle":null}const w=V(s=>({layers:[],resetLayerStore:()=>s(()=>({layers:[]})),loadProjectLayers:t=>s(()=>({layers:t})),addLayer:t=>s(a=>{const r=l=>a.layers.some(n=>n.id===l)?r(l+"1"):l,o=t.featureCollection.features[0].geometry.type,i=X(o);if(t.featureCollection.features.forEach(l=>{if(X(l.geometry.type)!==i)throw new Error(`All features must have the same geometry (rendering) type, found both ${o} and ${l.geometry.type}`)}),!i)throw new Error("Unsupported geometry type: "+o);t.name||(t.name=i==="fill"?"polygon":i==="line"?"line":i==="circle"?"point":"not possible");const d={h:Math.floor(Math.random()*360),s:90,l:48,a:i==="fill"?.7:1};return{layers:[{featureCollection:t.featureCollection,id:r(t.name),name:t.name,renderingType:i,visible:!0,color:d,outline:t.outline},...a.layers]}}),moveLayerUp:t=>s(a=>{const r=a.layers.findIndex(i=>i.id===t);if(r===0)return a;const o=[...a.layers];return o.splice(r-1,0,o.splice(r,1)[0]),{layers:o}}),moveLayerDown:t=>s(a=>{const r=a.layers.findIndex(i=>i.id===t);if(r===a.layers.length-1)return a;const o=[...a.layers];return o.splice(r+1,0,o.splice(r,1)[0]),{layers:o}}),deleteLayer:t=>s(a=>({layers:a.layers.filter(r=>r.id!==t)})),toggleLayerVisibility:t=>s(a=>({layers:a.layers.map(r=>r.id===t?{...r,visible:!r.visible}:r)})),toggleLayerVisibilityAll:()=>s(t=>{const a=t.layers.every(r=>r.visible);return{layers:t.layers.map(r=>({...r,visible:!a}))}}),changeLayerColor:(t,a)=>s(r=>({layers:r.layers.map(o=>o.id===t?{...o,color:a}:o)})),updateAllLayers:()=>s(t=>({layers:t.layers.map(a=>({...a,updater:a.updater?a.updater+1:1}))})),changeLayerName:(t,a)=>s(r=>({layers:r.layers.map(o=>o.id===t?{...o,name:a}:o)}))}));B.accessToken="pk.eyJ1IjoidG9iaWFuZCIsImEiOiJjbTdiMGZwemwwNmxlMnFyNTV4YWh2ZzB3In0.B3fVZMQOYEs2V23kKWB5XQ";const et=()=>{const{mapRef:s,mapReady:t,setMapReady:a,basemap:r}=M(),{addLayer:o,updateAllLayers:i}=w(),d=u.useRef(null);u.useEffect(()=>{var m,y,g,L,C,x;if(!t&&d.current){d.current.innerHTML="",s.current=new B.Map({container:d.current,style:r.url,center:[10.4,63.425],zoom:12}),(m=s.current)==null||m.addControl(new B.FullscreenControl,"top-right"),(y=s.current)==null||y.addControl(new B.NavigationControl({visualizePitch:!0}),"top-right"),(g=s.current)==null||g.addControl(new B.ScaleControl,"bottom-right");const j=new Je({displayControlsDefault:!1,controls:{point:!0,line_string:!0,polygon:!0},boxSelect:!1});(L=s.current)==null||L.addControl(j,"bottom-left"),(C=s.current)==null||C.on("draw.create",()=>{o({featureCollection:j.getAll(),name:null}),j.deleteAll()}),(x=s.current)==null||x.on("style.load",()=>{a(!0)})}},[s,o,t,a,r]);const[p,l]=u.useState(!1),n=u.useRef(r),[c,h]=u.useState(r);return u.useEffect(()=>{var m;n.current.url!==r.url&&(n.current=r),!p&&c.url!==n.current.url&&(l(!0),t&&s.current&&(s.current.setStyle(n.current.url),h(r)),(m=s.current)==null||m.once("style.load",()=>{i()}),setTimeout(()=>{l(!1)},200))},[r,s,t,p,c,i]),e.jsx("div",{ref:d,className:"mapContainer"})},R=(s,t,a=[])=>{u.useEffect(()=>{const r=o=>{const i=o.target;s.current&&!s.current.contains(i)&&!a.some(d=>{var p;return(p=d.current)==null?void 0:p.contains(i)})&&t()};return document.addEventListener("click",r),()=>{document.removeEventListener("click",r)}},[s,t,a])},tt=()=>{const[s,t]=u.useState(!1),a=u.useRef(null);R(a,()=>{t(!1)});const[r,o]=u.useState(null),{basemap:i,setBasemap:d}=M(),p=[{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"},{url:"mapbox://styles/mapbox/outdoors-v12",name:"Outdoors"},{url:"mapbox://styles/mapbox/light-v11",name:"Light"},{url:"mapbox://styles/mapbox/dark-v11",name:"Dark"},{url:"mapbox://styles/mapbox/satellite-v9",name:"Satellite"},{url:"mapbox://styles/mapbox/satellite-streets-v12",name:"Satellite Streets"},{url:"mapbox://styles/mapbox/navigation-day-v1",name:"Navigation Day"},{url:"mapbox://styles/mapbox/navigation-night-v1",name:"Navigation Night"},{url:"mapbox://styles/tobiand/cm8rbg7j900be01sa5wc6d4lq",name:"Off (white)"},{url:"mapbox://styles/tobiand/cm8rbd89l00az01sb97a8hfyh",name:"Off (black)"}];return e.jsxs("div",{className:"basemap",ref:a,children:[e.jsxs("button",{type:"button",onClick:()=>t(!s),children:[e.jsx(me,{})," Change basemap"]}),s&&e.jsx("div",{className:"basemapPopover",children:e.jsx("ul",{onMouseEnter:()=>{o(i)},onMouseLeave:()=>{d(r),o(null)},children:p.map(l=>e.jsx("li",{children:e.jsx("button",{type:"button",onClick:()=>{o(l)},onMouseEnter:()=>{d(l)},className:`basemapOption ${r===null&&l.name===i.name||r!==null&&l.name===r.name?"active":""}`,children:l.name})},l.name))})})]})},st=V(s=>({theme:localStorage.getItem("theme")||"light",setTheme:t=>s(a=>(localStorage.setItem("theme",t),t===a.theme?a:{theme:t}))})),rt=()=>{const[s,t]=u.useState(!1),a=u.useRef(null);R(a,()=>{t(!1)});const{layers:r,resetLayerStore:o,loadProjectLayers:i}=w(),{basemap:d,setBasemap:p,resetMapStore:l}=M(),{theme:n,setTheme:c}=st(),h=()=>{o(),l()},m=()=>{const C={layers:r,basemap:d},x=new Blob([JSON.stringify(C)],{type:"application/json"}),j=URL.createObjectURL(x),S=document.createElement("a");S.href=j,S.download="μGIS_project.mugis",document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(j)},y=u.useRef(null),g=()=>{var C;(C=y.current)==null||C.click()},L=C=>{const x=C.target.files;if(!x){console.log("no file selected");return}const j=new FileReader;j.onload=S=>{var P;try{const T=JSON.parse((P=S.target)==null?void 0:P.result);i(T.layers),p(T.basemap)}catch(T){console.log(T)}},j.readAsText(x[0])};return u.useEffect(()=>{document.documentElement.setAttribute("data-theme",n)},[n]),e.jsxs("div",{className:"settings",ref:a,children:[e.jsx("button",{type:"button",className:"toolButton",onClick:()=>{t(!s)},children:e.jsx(he,{})}),s&&e.jsx("div",{className:"settingsPopover",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:h,children:[e.jsx(ye,{})," New project"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:m,children:[e.jsx(xe,{})," Save project"]})}),e.jsxs("li",{children:[e.jsx("input",{ref:y,type:"file",accept:".mugis",onChange:L}),e.jsxs("button",{type:"button",onClick:g,children:[e.jsx(be,{})," Load project"]})]}),e.jsx("li",{children:e.jsx(tt,{})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:C=>{C.stopPropagation(),c(n==="light"?"dark":"light")},children:[n==="light"?e.jsx(ge,{}):e.jsx(je,{})," Toggle theme"]})}),e.jsx("li",{children:e.jsxs("a",{href:"https://github.com/tiltobias/muGIS/blob/main/docs/tutorial.md",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(ve,{})," Go to tutorial"]})})]})})]})},O=({children:s,buttonLabel:t,onFormSubmit:a,buttonIcon:r,description:o})=>{const[i,d]=u.useState(!1),[p,l]=u.useState(!1),[n,c]=u.useState(!1);return e.jsxs("div",{children:[e.jsxs("button",{type:"button",className:"toolButton",onClick:()=>d(!i),children:[r," ",t]}),i&&e.jsx("div",{className:"cover",onClick:h=>{h.target===h.currentTarget&&d(!1)},children:e.jsx("div",{className:"modal"+(p?" loading":""),children:e.jsxs("form",{onSubmit:h=>{h.preventDefault(),l(!0),setTimeout(()=>{a()&&d(!1),l(!1)},0)},children:[e.jsx("button",{type:"button",className:"modalCloseButton",onClick:()=>d(!1),children:e.jsx(D,{})}),e.jsxs("div",{className:"modalHeader",children:[e.jsx("h3",{children:t}),o&&e.jsx("button",{type:"button",onClick:()=>c(!n),children:e.jsx(ee,{})})]}),n&&e.jsx("p",{className:"modalDescription",children:o}),s,e.jsx("button",{type:"submit",children:"Submit"})]})})})]})};function ie({size:s=120}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 120 120",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{style:{fill:"none",stroke:"currentColor",strokeWidth:16,strokeLinejoin:"round",strokeOpacity:1},d:"M 15,55 50,80 70,40 105,65"}),e.jsx("circle",{cx:"15",cy:"55",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"50",cy:"80",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"70",cy:"40",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"105",cy:"65",r:"12",fill:"currentColor"})]})}function ce({size:s=120}){return e.jsx("svg",{width:s,height:s,viewBox:"0 0 120 120",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("circle",{cx:"60",cy:"60",r:"25",fill:"currentColor"})})}function ue({size:s=120}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 120 120",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{style:{fill:"currentColor",stroke:"currentColor",strokeWidth:16,strokeLinejoin:"round",strokeOpacity:1,fillOpacity:.5},d:"M 60,17 100,48 88,95 H 32 L 20,48 60,17"}),e.jsx("circle",{cx:"60",cy:"17",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"100",cy:"48",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"88",cy:"95",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"32",cy:"95",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"20",cy:"48",r:"12",fill:"currentColor"})]})}function nt(){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{width:"20",height:"20",x:"2",y:"2",rx:"2"}),e.jsx("circle",{cx:"7",cy:"9",r:"1"}),e.jsx("circle",{cx:"9",cy:"17",r:"1"}),e.jsx("circle",{cx:"17",cy:"10",r:"1"}),e.jsx("line",{x1:"11.7436",y1:"12.0641",x2:"19.5625",y2:"21"}),e.jsx("line",{x1:"11.7436",y1:"12.0641",x2:"12.65",y2:"3"}),e.jsx("line",{x1:"11.7436",y1:"12.0641",x2:"3",y2:"14.25"})]})}const _=({name:s,type:t,index:a,color:r,onRemove:o})=>e.jsxs("div",{className:"layerItem",children:[e.jsxs("span",{className:"layerIndex",children:[a+1,"."]}),e.jsxs("div",{className:"colorPickerButton",style:{color:`hsl(${r.h},${r.s}%,${r.l}%)`},children:[t==="circle"&&e.jsx(ce,{}),t==="line"&&e.jsx(ie,{}),t==="fill"&&e.jsx("div",{className:"polygonShrinker",children:e.jsx(ue,{})})]}),e.jsx("div",{className:"layerName",children:e.jsx("span",{children:s})}),o&&e.jsx("button",{type:"button",onClick:i=>{o(),i.stopPropagation()},children:e.jsx(te,{})})]}),k=({selectedLayers:s,setSelectedLayers:t,renderingType:a=void 0,multiple:r=!1,unselectableLayerIds:o=[]})=>{const{layers:i}=w(),[d,p]=u.useState(!1),l=u.useRef(null),n=u.useRef(null);return R(l,()=>{p(!1)}),u.useEffect(()=>{var c,h,m,y,g,L;l.current&&n.current&&((h=n.current)==null||h.style.setProperty("max-height",`${window.innerHeight-((c=l.current)==null?void 0:c.getBoundingClientRect().bottom)-10}px`),(y=n.current)==null||y.style.setProperty("width",`${(m=l.current)==null?void 0:m.getBoundingClientRect().width}px`),(L=n.current)==null||L.style.setProperty("top",`${((g=l.current)==null?void 0:g.getBoundingClientRect().bottom)+window.scrollY}px`))},[d,s]),u.useEffect(()=>{s.forEach(c=>{o.includes(c.id)&&t(h=>h.filter(m=>m.id!==c.id))})},[o,s,t]),e.jsxs("div",{className:"selectLayersContainer",ref:l,onClick:()=>{p(!d)},children:[e.jsx("ol",{className:"selectedList",children:s.length===0?e.jsx("p",{children:"No layer selected"}):i.map((c,h)=>a&&c.renderingType!==a||!s.some(m=>m.id===c.id)?null:e.jsx("li",{children:e.jsx(_,{name:c.name,type:c.renderingType,index:h,color:c.color,onRemove:()=>{t(m=>m.filter(y=>y.id!==c.id))}})},c.id))}),d&&e.jsxs("div",{className:"selectListContainer",onClick:c=>{r&&c.stopPropagation()},ref:n,children:[e.jsx("h4",{children:"Select Layers"}),e.jsx("ol",{className:"selectList",children:i.map((c,h)=>a&&c.renderingType!==a||s.some(m=>m.id===c.id)||o.includes(c.id)?null:e.jsx("li",{className:"selectListItem",onClick:()=>{t(r?m=>[...m,c]:[c])},children:e.jsx(_,{name:c.name,type:c.renderingType,index:h,color:c.color})},c.id))||e.jsx("p",{children:"No layers available"})})]})]})},ot=()=>{const{addLayer:s}=w(),[t,a]=u.useState([]),[r,o]=u.useState(""),[i,d]=u.useState("");u.useEffect(()=>{t[0]&&d(`buffer(${t[0].name}, ${r}m)`)},[t,r]);const p=()=>{if(!t[0]||r==="")return alert("Please select a layer and enter a radius"),!1;const n=t[0].featureCollection,c=le(n,r*.001,{units:"kilometers"});return!c||c.features.length===0?(alert("No results found"),!1):(s({featureCollection:c,name:i}),!0)};return e.jsxs(O,{buttonLabel:"Buffer",onFormSubmit:p,buttonIcon:e.jsx(Le,{}),description:"Create a buffer around the selected layer's features. The buffer radius is specified in meters, and can be a positive or negative decimal number. The output will be a polygon layer containing the buffered geometries.",children:[e.jsx("span",{className:"toolInputLabel",children:"Select a layer:"}),e.jsx(k,{selectedLayers:t,setSelectedLayers:a}),e.jsx("span",{className:"toolInputLabel",children:"Buffer radius [m]:"}),e.jsx("input",{type:"number",className:"toolNumberInput",value:r,onChange:n=>o(n.target.value)}),e.jsx("label",{htmlFor:"outputLayerName",children:"Output Layer Name:"}),e.jsx("input",{id:"outputLayerName",type:"text",value:i,onChange:n=>d(n.target.value)})]})},lt=()=>{const{addLayer:s}=w(),[t,a]=u.useState([]),[r,o]=u.useState("");u.useEffect(()=>{if(t&&t.length>=2){let p=t[0].name;for(let l=1;l<t.length;l++)p+=`, ${t[l].name}`;o(`intersect(${p})`)}},[t]);const i=()=>{if(!t||t.length<2)return alert("Please select two layers"),!1;const p={type:"FeatureCollection",features:t[0].featureCollection.features};for(let l=1;l<t.length;l++){const n=t[l].featureCollection,c=[];p.features.forEach(h=>{n.features.forEach(m=>{const y=ae({type:"FeatureCollection",features:[h,m]});y&&c.push(y)})}),p.features=c}return!p||p.features.length===0?(alert("No results found"),!1):(s({featureCollection:p,name:r}),!0)};return e.jsxs(O,{buttonLabel:"Intersect",onFormSubmit:i,buttonIcon:e.jsx(Ce,{}),description:"Intersect two or more polygon layers to create a new layer containing the overlapping areas. The output will be a polygon layer containing the intersected geometries.",children:[e.jsx("span",{className:"toolInputLabel",children:"Select two or more polygon layers:"}),e.jsx(k,{selectedLayers:t,setSelectedLayers:a,renderingType:"fill",multiple:!0}),e.jsx("label",{htmlFor:"outputLayerName",children:"Output Layer Name:"}),e.jsx("input",{id:"outputLayerName",type:"text",value:r,onChange:p=>o(p.target.value)})]})},at=()=>{const{addLayer:s}=w(),[t,a]=u.useState([]),[r,o]=u.useState("");u.useEffect(()=>{if(t&&t.length>=2){let p=t[0].name;for(let l=1;l<t.length;l++)p+=`, ${t[l].name}`;o(`union(${p})`)}},[t]);const i=()=>{if(!t||t.length<2)return alert("Please select two layers"),!1;const p=t.flatMap(n=>n.featureCollection.features),l=Ze({type:"FeatureCollection",features:p});return l?(s({featureCollection:{type:"FeatureCollection",features:[l]},name:r}),!0):(alert("No results found"),!1)};return e.jsxs(O,{buttonLabel:"Union",onFormSubmit:i,buttonIcon:e.jsx(Se,{}),description:"Create a union of two or more polygon layers. The output will be a polygon layer containing the union of all the geometries.",children:[e.jsx("span",{className:"toolInputLabel",children:"Select two or more polygon layers:"}),e.jsx(k,{selectedLayers:t,setSelectedLayers:a,renderingType:"fill",multiple:!0}),e.jsx("label",{htmlFor:"outputLayerName",children:"Output Layer Name:"}),e.jsx("input",{id:"outputLayerName",type:"text",value:r,onChange:p=>o(p.target.value)})]})},it=()=>{var n;const{addLayer:s}=w(),[t,a]=u.useState([]),[r,o]=u.useState([]),[i,d]=u.useState("");u.useEffect(()=>{t[0]&&r[0]&&d(`difference(${t[0].name}, ${r[0].name})`)},[t,r]);const p=()=>{if(!t[0]||!r[0])return alert("Please select two layers"),!1;const c={type:"FeatureCollection",features:[]},h=t[0].featureCollection,m=r[0].featureCollection,y=Ye(m).features[0];return h.features.forEach(g=>{const L=Ke({type:"FeatureCollection",features:[g,y]});L&&c.features.push(L)}),!c||c.features.length===0?(alert("No results found"),!1):(s({featureCollection:c,name:i}),!0)};return e.jsxs(O,{buttonLabel:"Difference",onFormSubmit:p,buttonIcon:e.jsx(Ne,{}),description:"Create a difference of two polygon layers. The output will be a polygon layer containing the geometries from the first layer that do not intersect with the second layer.",children:[e.jsx("span",{className:"toolInputLabel",children:"Select a polygon layer:"}),e.jsx(k,{selectedLayers:t,setSelectedLayers:a,renderingType:"fill"}),e.jsx("span",{className:"toolInputLabel",children:"Select polygon layer to subtract:"}),e.jsx(k,{selectedLayers:r,setSelectedLayers:o,renderingType:"fill",unselectableLayerIds:[(n=t[0])==null?void 0:n.id]}),e.jsx("label",{htmlFor:"outputLayerName",children:"Output Layer Name:"}),e.jsx("input",{id:"outputLayerName",type:"text",value:i,onChange:c=>d(c.target.value)})]})},U=({options:s,selectedOption:t,setSelectedOption:a,placeholder:r="Select an option",clearable:o=!1})=>{const[i,d]=u.useState(!1),p=u.useRef(null),l=u.useRef(null);return R(p,()=>{d(!1)}),u.useEffect(()=>{var n,c,h,m,y,g;p.current&&l.current&&((c=l.current)==null||c.style.setProperty("max-height",`${window.innerHeight-((n=p.current)==null?void 0:n.getBoundingClientRect().bottom)-10}px`),(m=l.current)==null||m.style.setProperty("width",`${(h=p.current)==null?void 0:h.getBoundingClientRect().width}px`),(g=l.current)==null||g.style.setProperty("top",`${((y=p.current)==null?void 0:y.getBoundingClientRect().bottom)+window.scrollY}px`))},[i,t]),e.jsxs("div",{className:"selectLayersContainer select",ref:p,onClick:()=>{d(!i)},children:[e.jsx("div",{className:"selectedList",children:t?e.jsxs("div",{className:"layerItem",children:[e.jsx("div",{className:"layerName",children:t}),o&&i&&e.jsx("button",{type:"button",onClick:n=>{a(""),n.stopPropagation()},children:e.jsx(te,{})})]}):e.jsx("div",{className:"layerName",children:r})}),i&&e.jsx("div",{className:"selectListContainer",ref:l,children:e.jsxs("ol",{className:"selectList",children:[s.map(n=>e.jsx("li",{className:"selectListItem",onClick:c=>{c.stopPropagation(),a(n),d(!1)},children:e.jsx("div",{className:"selectItem",children:n})},n)),s.length===0&&e.jsx("p",{children:"No options available"})]})})]})},ct=()=>{var h;const{addLayer:s}=w(),[t,a]=u.useState([]),[r,o]=u.useState(!1),[i,d]=u.useState(""),[p,l]=u.useState("");u.useEffect(()=>{t[0]&&l(r&&i?`dissolve(${t[0].name}, ${i})`:`dissolve(${t[0].name})`)},[t,r,i]);const n=()=>{if(!t[0])return alert("Please select a layer"),!1;const m=t[0].featureCollection,y=r&&i?Y($(m),{propertyName:i}):Y($(m));return!y||y.features.length===0?(alert("No results found"),!1):(s({featureCollection:y,name:p}),!0)};return e.jsxs(O,{buttonLabel:"Dissolve",onFormSubmit:n,buttonIcon:e.jsx(we,{}),description:"Dissolve polygons in a layer based on a property or without any property. The output will be a polygon layer containing the dissolved geometries.",children:[e.jsx("span",{className:"toolInputLabel",children:"Select a polygon layer:"}),e.jsx(k,{selectedLayers:t,setSelectedLayers:a,renderingType:"fill"}),e.jsxs("span",{className:r?"toolInputLabel":"",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:m=>o(m.target.checked),id:"checkboxPropertyEnabled"}),e.jsxs("label",{htmlFor:"checkboxPropertyEnabled",children:["Dissolve by property",r&&":"]})]}),r&&e.jsx(U,{options:(h=t[0])!=null&&h.featureCollection.features[0].properties?Object.keys(t[0].featureCollection.features[0].properties):[],selectedOption:i,setSelectedOption:m=>d(m),placeholder:"Select a property",clearable:!0}),e.jsx("label",{htmlFor:"outputLayerName",children:"Output Layer Name:"}),e.jsx("input",{id:"outputLayerName",type:"text",value:p,onChange:m=>l(m.target.value)})]})},ut=()=>{const{addLayer:s}=w(),[t,a]=u.useState([]),[r,o]=u.useState(!1),[i,d]=u.useState([]),[p,l]=u.useState("");u.useEffect(()=>{t[0]&&(r&&i[0]?l(`voronoi(${t[0].name}, ${i[0].name})`):l(`voronoi(${t[0].name})`))},[t,i,r]);const n=()=>{if(!t[0])return alert("Please select a layer"),!1;const h=$(t[0].featureCollection),m=r&&i[0]?$(i[0].featureCollection):h,y=Xe(h,{bbox:z(m)});return!y||y.features.length===0?(alert("No results found"),!1):(y.features=y.features.filter(g=>g.geometry.type==="Polygon"),s({featureCollection:y,name:p,outline:!0}),!0)};return e.jsxs(O,{buttonLabel:"Voronoi",onFormSubmit:n,buttonIcon:e.jsx(nt,{}),description:"Create a Voronoi diagram from a point layer. The output will be a polygon layer containing the Thiessen polygon of each point.",children:[e.jsx("span",{className:"toolInputLabel",children:"Select a point layer:"}),e.jsx(k,{selectedLayers:t,setSelectedLayers:a,renderingType:"circle"}),e.jsxs("span",{className:r?"toolInputLabel":"",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:h=>o(h.target.checked),id:"checkboxPropertyEnabled"}),e.jsxs("label",{htmlFor:"checkboxPropertyEnabled",children:["Use custom bounding box",r&&":"]})]}),r&&e.jsx(k,{selectedLayers:i,setSelectedLayers:d}),e.jsx("label",{htmlFor:"outputLayerName",children:"Output Layer Name:"}),e.jsx("input",{id:"outputLayerName",type:"text",value:p,onChange:h=>l(h.target.value)})]})},dt=()=>{const{addLayer:s}=w(),[t,a]=u.useState([]),[r,o]=u.useState("");u.useEffect(()=>{if(t&&t.length>=1){let p=t[0].name;for(let l=1;l<t.length;l++)p+=`, ${t[l].name}`;o(`bbox(${p})`)}},[t]);const i=()=>{if(!t||t.length<1)return alert("Please select one or more layers"),!1;const p=t.flatMap(n=>n.featureCollection.features),l=_e(z({type:"FeatureCollection",features:p}));return l?(s({featureCollection:{type:"FeatureCollection",features:[l]},name:r}),!0):(alert("No results found"),!1)};return e.jsxs(O,{buttonLabel:"Bbox",onFormSubmit:i,buttonIcon:e.jsx(ke,{}),description:"Create a bounding box polygon from one or more layers. The output will be a polygon layer containing the bounding box of all the selected geometries.",children:[e.jsx("span",{className:"toolInputLabel",children:"Select one or more layers:"}),e.jsx(k,{selectedLayers:t,setSelectedLayers:a,multiple:!0}),e.jsx("label",{htmlFor:"outputLayerName",children:"Output Layer Name:"}),e.jsx("input",{id:"outputLayerName",type:"text",value:r,onChange:p=>o(p.target.value)})]})},pt=()=>{var n;const{addLayer:s}=w(),[t,a]=u.useState([]),[r,o]=u.useState([]),[i,d]=u.useState("");u.useEffect(()=>{t[0]&&r[0]&&d(`clip(${r[0].name}, ${t[0].name})`)},[r,t]);const p=()=>{if(!t[0]||!r[0])return alert("Please select two layers"),!1;let c={type:"FeatureCollection",features:[]};if(r[0].renderingType==="circle")c=Qe(r[0].featureCollection,t[0].featureCollection);else if(r[0].renderingType==="fill"){const h=t[0].featureCollection,m=r[0].featureCollection;h.features.forEach(y=>{m.features.forEach(g=>{const L=ae({type:"FeatureCollection",features:[g,y]});L&&c.features.push(L)})})}else if(r[0].renderingType==="line"){const h=$(t[0].featureCollection),m=$(r[0].featureCollection);h.features.forEach(y=>{const g=le(y,.01,{units:"meters"});m.features.forEach(L=>{K(L,g)?c.features.push(L):De(L,y).features.forEach(x=>{K(x,g)&&c.features.push(x)})})})}else throw new Error("Unknown rendering type");return!c||c.features.length===0?(alert("No results found"),!1):(s({featureCollection:c,name:i}),!0)};return e.jsxs(O,{buttonLabel:"Clip",onFormSubmit:p,buttonIcon:e.jsx(Fe,{}),description:"Clip any type of layer with a polygon layer. The output will be a layer of the same type containing only the features that are within the clip layer.",children:[e.jsx("span",{className:"toolInputLabel",children:"Select layer:"}),e.jsx(k,{selectedLayers:r,setSelectedLayers:o}),e.jsx("span",{className:"toolInputLabel",children:"Select polygon layer to clip with:"}),e.jsx(k,{selectedLayers:t,setSelectedLayers:a,renderingType:"fill",unselectableLayerIds:[(n=r[0])==null?void 0:n.id]}),e.jsx("label",{htmlFor:"outputLayerName",children:"Output Layer Name:"}),e.jsx("input",{id:"outputLayerName",type:"text",value:i,onChange:c=>d(c.target.value)})]})},ft=()=>e.jsxs(e.Fragment,{children:[e.jsx(ot,{}),e.jsx(lt,{}),e.jsx(at,{}),e.jsx(it,{}),e.jsx(ct,{}),e.jsx(ut,{}),e.jsx(dt,{}),e.jsx(pt,{})]}),mt=({setWidth:s,setOpen:t})=>{const{mapRef:a}=M(),r=u.useRef(null),[o,i]=u.useState(!1),d=n=>{i(!0),n.preventDefault(),n.stopPropagation()},p=u.useCallback(()=>{i(!1),setTimeout(()=>{var n;(n=a.current)==null||n.resize()},1),setTimeout(()=>{var n;(n=a.current)==null||n.resize()},100)},[a]),l=u.useCallback(n=>{var c;o&&((c=a.current)==null||c.resize(),s(n.clientX),n.clientX<100?t(!1):t(!0))},[o,a,s,t]);return u.useEffect(()=>(window.addEventListener("mousemove",l),window.addEventListener("mouseup",p),()=>{window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",p)}),[o,l,p]),e.jsx("div",{className:`resizeHandle ${o?"resizing":""}`,onMouseDown:d,ref:r})},ht=({color:s,onChange:t,layerType:a})=>{const[r,o]=u.useState(!1),i=u.useRef(null);return R(i,()=>{o(!1)}),e.jsxs("div",{className:"colorPicker",ref:i,children:[e.jsxs("button",{type:"button",className:"colorPickerButton",onClick:()=>{o(!r)},style:{color:`hsl(${s.h},${s.s}%,${s.l}%)`},children:[a==="circle"&&e.jsx(ce,{}),a==="line"&&e.jsx(ie,{}),a==="fill"&&e.jsx("div",{className:"polygonShrinker",children:e.jsx(ue,{})})]}),r&&e.jsx("div",{className:"colorPickerPopover",children:e.jsx(Pe,{color:s,onChange:d=>{t(d)}})})]})},yt=({layerId:s,initialLayerName:t,isEditing:a,setIsEditing:r,closeMenu:o})=>{const{changeLayerName:i}=w(),[d,p]=u.useState(t),l=u.useRef(null);return u.useEffect(()=>{a&&l.current&&l.current.focus()},[a,l]),R(l,()=>{a&&(i(s,d),r(!1),o())}),e.jsx("div",{className:"layerNameContainer",children:a?e.jsx("form",{onSubmit:n=>{n.preventDefault(),i(s,d),r(!1)},children:e.jsx("input",{type:"text",value:d,onChange:n=>p(n.target.value),ref:l,onFocus:()=>r(!0),onBlur:()=>i(s,d)})}):e.jsx("div",{className:"layerName",children:e.jsx("span",{onDoubleClick:()=>r(!0),children:d})})})},xt=["=","!=","<","<=",">",">="],bt=["=","!=","contains","does not contain","starts with","does not start with","ends with","does not end with"],A={active:!1,attribute:"",attributeType:"string",operator:"=",value:""},q=V(s=>({selectedLayer:[],setSelectedLayer:t=>s(a=>typeof t=="function"?{selectedLayer:t(a.selectedLayer)}:{selectedLayer:t}),tableOpen:!1,setTableOpen:t=>s(()=>({tableOpen:t})),openTableWithLayer:t=>s(()=>({tableOpen:!0,selectedLayer:t})),filters:[{...A}],resetFilters:()=>s(()=>({filters:[{...A}]})),addFilter:()=>s(t=>{const a={...A};return{filters:[...t.filters,a]}}),removeFilter:t=>s(a=>{const r=[...a.filters];return r.splice(t,1),r.length===0&&r.push({...A}),{filters:r}}),updateFilter:(t,a)=>s(r=>{const o=[...r.filters];return o[t]=a,{filters:o}}),filterConnector:"and",setFilterConnector:t=>s(()=>({filterConnector:t}))}));function Q(s,t){var p,l;const{active:a,attribute:r,attributeType:o,operator:i,value:d}=t;if(!a)return!0;if(o==="number"){const n=(p=s.properties)==null?void 0:p[r];if(n==null)switch(i){case"=":return d===void 0||d===""||Number.isNaN(d);case"!=":return d!==void 0&&d!==""&&!Number.isNaN(d);default:return!1}const c=d;switch(i){case"=":return n===c;case"!=":return n!==c;case"<":return n<c;case"<=":return n<=c;case">":return n>c;case">=":return n>=c;default:return!1}}else{const n=(l=s.properties)==null?void 0:l[r];if(n==null)switch(i){case"=":return d===void 0||d==="";case"!=":return d!==void 0&&d!=="";default:return!1}const c=d;switch(i){case"=":return String(n)===c;case"!=":return String(n)!==c;case"contains":return String(n).includes(c);case"does not contain":return!String(n).includes(c);case"starts with":return String(n).startsWith(c);case"does not start with":return!String(n).startsWith(c);case"ends with":return String(n).endsWith(c);case"does not end with":return!String(n).endsWith(c);default:return!1}}}const gt=({layerData:s,layerAboveId:t,index:a})=>{const[r,o]=u.useState(!1),i=u.useRef(null);R(i,()=>{o(!1)});const{deleteLayer:d,toggleLayerVisibility:p,changeLayerColor:l}=w(),{mapRef:n}=M(),{openTableWithLayer:c}=q();u.useEffect(()=>{var x,j,S,P;(x=n.current)!=null&&x.getSource(s.id)||(j=n.current)==null||j.addSource(s.id,{type:"geojson",data:s.featureCollection}),(S=n.current)!=null&&S.getLayer(s.id)||(P=n.current)==null||P.addLayer({id:s.id,type:s.renderingType,source:s.id,paint:s.renderingType==="fill"?{"fill-color":`hsl(${s.color.h},${s.color.s}%,${s.color.l}%)`,"fill-opacity":s.color.a,...s.outline?{"fill-outline-color":"black"}:{}}:s.renderingType==="line"?{"line-color":`hsl(${s.color.h},${s.color.s}%,${s.color.l}%)`,"line-opacity":s.color.a,"line-width":2}:s.renderingType==="circle"?{"circle-color":`hsl(${s.color.h},${s.color.s}%,${s.color.l}%)`,"circle-opacity":s.color.a,"circle-radius":5}:{}})},[n,s]),u.useEffect(()=>{var x;(x=n.current)==null||x.moveLayer(s.id,t)},[t,s.id,n,s.updater]),u.useEffect(()=>{var x;(x=n.current)==null||x.setLayoutProperty(s.id,"visibility",s.visible?"visible":"none")},[s.visible,n,s.id,s.updater]);const h=x=>{var j,S,P,T,F,I;l(s.id,x),s.renderingType==="fill"?((j=n.current)==null||j.setPaintProperty(s.id,"fill-color",`hsl(${x.h},${x.s}%,${x.l}%)`),(S=n.current)==null||S.setPaintProperty(s.id,"fill-opacity",x.a)):s.renderingType==="line"?((P=n.current)==null||P.setPaintProperty(s.id,"line-color",`hsl(${x.h},${x.s}%,${x.l}%)`),(T=n.current)==null||T.setPaintProperty(s.id,"line-opacity",x.a)):s.renderingType==="circle"&&((F=n.current)==null||F.setPaintProperty(s.id,"circle-color",`hsl(${x.h},${x.s}%,${x.l}%)`),(I=n.current)==null||I.setPaintProperty(s.id,"circle-opacity",x.a))},m=()=>{var x,j;(x=n.current)==null||x.removeLayer(s.id),(j=n.current)==null||j.removeSource(s.id),d(s.id)},y=()=>{const x=new Blob([JSON.stringify(s.featureCollection)],{type:"application/geo+json"}),j=URL.createObjectURL(x),S=document.createElement("a");S.href=j,S.download=s.name+".geojson",document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(j)},g=()=>{var j;const x=z(s.featureCollection).slice(0,4);(j=n.current)==null||j.fitBounds(x,{padding:20})},[L,C]=u.useState(!1);return e.jsxs("div",{className:"layerItem",children:[e.jsxs("span",{className:"layerIndex",children:[a+1,"."]}),e.jsx(ht,{color:s.color,onChange:h,layerType:s.renderingType}),e.jsx(yt,{layerId:s.id,initialLayerName:s.name,isEditing:L,setIsEditing:C,closeMenu:()=>o(!1)}),e.jsxs("div",{className:`layerMenu ${r?"open":""}`,ref:i,children:[e.jsx("button",{type:"button",onClick:()=>{o(!r)},children:e.jsx(Te,{})}),r&&e.jsx("div",{className:"layerMenuPopover",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{c([s])},children:[e.jsx(se,{})," Attribute table"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:x=>{x.stopPropagation(),C(!L)},children:[L?e.jsx(Oe,{}):e.jsx(Ee,{})," Edit layer name"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:g,children:[e.jsx(Ie,{})," Zoom to layer"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:y,children:[e.jsx(Re,{})," Download layer"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:m,children:[e.jsx(re,{})," Delete layer"]})})]})})]}),e.jsx("button",{type:"button",onClick:()=>p(s.id),children:s.visible?e.jsx(ne,{}):e.jsx(oe,{})})]})},jt=()=>{const{layers:s,moveLayerUp:t,moveLayerDown:a}=w(),[r,o]=u.useState(null),[i,d]=u.useState(null);u.useEffect(()=>{r!==null&&d(r)},[r]);const p=(c,h)=>{o(h),c.dataTransfer.setDragImage(new Image,0,0)},l=(c,h)=>{c.preventDefault(),c.dataTransfer.dropEffect="move",!(r===null||r===h)&&(s.findIndex(m=>m.id===r)<s.findIndex(m=>m.id===h)?a(r):t(r))},n=()=>{o(null)};return e.jsx("ol",{className:"layerList",children:s.map((c,h)=>e.jsx("li",{draggable:!0,className:`layerListItem ${i===c.id?"hovering":""}`,onDragStart:m=>p(m,c.id),onDragOver:m=>l(m,c.id),onDragEnd:n,onMouseOver:()=>r===null?d(c.id):void 0,onMouseOut:()=>r===null?d(null):void 0,children:e.jsx(gt,{layerData:c,layerAboveId:h===0?void 0:s[h-1].id,index:h})},c.id))})},vt=({headers:s,headerTypes:t})=>{const{filters:a,addFilter:r,removeFilter:o,updateFilter:i,filterConnector:d,setFilterConnector:p}=q();return e.jsx("div",{className:"filterContainer",children:e.jsxs("div",{className:"filterSubContainer",children:[e.jsxs("div",{className:"filterHeader",children:[e.jsxs("button",{onClick:r,children:[e.jsx($e,{}),"Add Filter"]}),e.jsxs("div",{className:"filterConnector",children:[e.jsx("span",{children:"Combine filters by: "}),e.jsx(U,{options:["and","or"],selectedOption:d,setSelectedOption:l=>p(l),placeholder:"Select connector",clearable:!1})]})]}),e.jsx("div",{className:"filterRows",children:a.map((l,n)=>e.jsxs("div",{className:"filterRow"+(l.active?" active":""),children:[e.jsx(U,{options:s,selectedOption:l.attribute,setSelectedOption:c=>i(n,{...l,attribute:c,attributeType:t[s.indexOf(c)]||"string"}),placeholder:"Select an attribute",clearable:!0}),e.jsx(U,{options:l.attributeType==="number"?[...xt]:[...bt],selectedOption:l.operator,setSelectedOption:c=>i(n,{...l,operator:c}),placeholder:"Select operator"}),e.jsx("input",{type:l.attributeType==="number"?"number":"text",placeholder:`Enter ${l.attributeType} value`,value:l.value,onChange:c=>i(n,{...l,value:l.attributeType==="number"?parseFloat(c.target.value):c.target.value})}),e.jsx("button",{type:"button",className:`filterToggle ${l.active?"active":""}`,onClick:()=>{i(n,{...l,active:!l.active})},children:l.active?e.jsx(W,{}):e.jsx(H,{})}),e.jsx("button",{onClick:()=>o(n),children:e.jsx(re,{})})]},n))})]})})},Lt=()=>{const{selectedLayer:s,setSelectedLayer:t,tableOpen:a,setTableOpen:r,filters:o,filterConnector:i}=q(),[d,p]=u.useState([]);u.useEffect(()=>{p(s.length>0?s[0].featureCollection.features.map((f,b)=>{const v={...f.properties||{},mugisSelected:!1,mugisIndex:b};return{...f,properties:v}}):[])},[s]);const l=u.useMemo(()=>{const f=new Set;return d.forEach(b=>{b&&b.properties&&Object.keys(b.properties).forEach(v=>f.add(v))}),f.delete("mugisSelected"),f.delete("mugisIndex"),f.forEach(b=>{d.map(N=>{var E;return(E=N.properties)==null?void 0:E[b]}).every(N=>Array.isArray(N)||N===null||N===void 0)&&f.delete(b)}),Array.from(f)},[d]),n=u.useMemo(()=>l.map(f=>d.map(v=>{var N;return(N=v.properties)==null?void 0:N[f]}).filter(v=>v!=null).every(v=>typeof v=="number")?"number":"string"),[l,d]),[c,h]=u.useState(!1),m=u.useMemo(()=>o.filter(f=>f.active),[o]),y=u.useMemo(()=>m.length===0?d:d.filter(f=>i==="and"?m.every(b=>Q(f,b)):m.some(b=>Q(f,b))),[d,m,i]),[g,L]=u.useState(null),[C,x]=u.useState(!0),j=u.useMemo(()=>g?[...y].sort((f,b)=>{const v=f&&f.properties&&g in f.properties?f.properties[g]??"":"",N=b&&b.properties&&g in b.properties?b.properties[g]??"":"";return v===N?0:v===void 0?1:N===void 0?-1:v<N?C?-1:1:v>N?C?1:-1:0}):y,[y,g,C]),S=f=>{g===f?C?x(!1):L(null):(L(f),x(!0))},{addLayer:P}=w(),T=()=>{if(s.length===0||d.length===0)return;const f=y.filter(b=>{var v;return(v=b.properties)==null?void 0:v.mugisSelected}).map(b=>({...b,properties:{...b.properties,mugisSelected:void 0,mugisIndex:void 0}}));f.length!==0&&(P({featureCollection:{type:"FeatureCollection",features:f},name:`selection(${s[0].name})`,outline:s[0].outline}),r(!1))},[F,I]=u.useState(1),[G,de]=u.useState(!1);return e.jsxs("div",{children:[e.jsx("button",{type:"button",className:"toolButton",onClick:()=>r(!a),children:e.jsx(se,{})}),a&&e.jsx("div",{className:"cover",onClick:f=>{f.target===f.currentTarget&&r(!1)},children:e.jsxs("div",{className:"attributeTable",children:[e.jsx("button",{type:"button",className:"modalCloseButton",onClick:()=>r(!1),children:e.jsx(D,{})}),e.jsxs("div",{className:"modalHeader",children:[e.jsx("h3",{children:"Attribute Table"}),e.jsx("button",{type:"button",className:"infoButton",onClick:()=>de(!G),children:e.jsx(ee,{})})]}),G&&e.jsx("p",{className:"modalDescription",children:"This tool allows you to view and manage the attributes of features in a selected layer. You can filter, sort, and select features, and create a new layer from the selected features. Click on the column headers to sort by attribute. You can select individual features by clicking the checkbox in the first column, or all of them by clicking the checkbox in the header. Use the 'Create Layer From Selection' button to create a new layer from the selected features. To filter the displayed features, click 'Open Filter' and use the filter panel to set your criteria. Use 'Combine filters by AND' to require all conditions to be met, or 'Combine filters by OR' to allow any condition to be met."}),e.jsxs("div",{className:"tableInputHeader",children:[e.jsx(k,{selectedLayers:s,setSelectedLayers:t}),e.jsxs("button",{type:"button",className:`openFilterButton ${o.some(f=>f.active)?"active":""}`,onClick:()=>h(!c),children:[e.jsx(Me,{})," ",c?"Close Filter":"Open Filter"]})]}),c&&e.jsx(vt,{headers:l,headerTypes:n}),e.jsx("div",{className:"tableContainer",children:s.length>0&&e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx("button",{type:"button",className:"selectAll",onClick:()=>{y.every(f=>{var b;return!((b=f.properties)!=null&&b.mugisSelected)})?p(f=>f.map(b=>{const v={...b.properties||{},mugisSelected:!0};return{...b,properties:v}})):p(f=>f.map(b=>{const v={...b.properties||{},mugisSelected:!1};return{...b,properties:v}}))},children:y.every(f=>f.properties.mugisSelected)?e.jsx(W,{}):y.every(f=>!f.properties.mugisSelected)?e.jsx(H,{}):e.jsx(Be,{})})}),l.map((f,b)=>e.jsx("th",{children:e.jsxs("button",{type:"button",onClick:()=>S(f),children:[f,e.jsx("div",{className:"sortIcon",children:g===f&&(C?e.jsx(Ae,{}):e.jsx(Ue,{}))})]})},b))]})}),e.jsx("tbody",{children:j.slice((F-1)*100,F*100).map((f,b)=>{var v;return e.jsxs("tr",{className:(v=f.properties)!=null&&v.mugisSelected?"selected":"",children:[e.jsx("td",{children:e.jsx("button",{type:"button",onClick:()=>{p(N=>N.map((E,pe)=>{var J,Z;if(pe===((J=f.properties)==null?void 0:J.mugisIndex)){const fe={...E.properties||{},mugisSelected:!((Z=E.properties)!=null&&Z.mugisSelected)};return{...E,properties:fe}}return E}))},children:f.properties.mugisSelected?e.jsx(W,{}):e.jsx(H,{})})}),l.map((N,E)=>e.jsx("td",{children:f.properties&&!Array.isArray(f.properties[N])&&f.properties[N]!==null&&f.properties[N]!==void 0?String(f.properties[N]):""},E))]},b)})})]})}),s.length>0&&e.jsxs("div",{className:"tableFooter",children:[e.jsxs("span",{children:["Showing ",y.length," of ",d.length," features"]}),e.jsxs("div",{className:"tableFooterRight",children:[e.jsxs("span",{children:[(F-1)*100+1,"–",Math.min(F*100,y.length)," of ",y.length]}),e.jsxs("div",{className:"tablePagination",children:[e.jsx("button",{type:"button",onClick:()=>I(1),disabled:F<=1,children:e.jsx(Ve,{})}),e.jsx("button",{type:"button",onClick:()=>I(f=>Math.max(1,f-1)),disabled:F<=1,children:e.jsx(We,{})}),e.jsx("button",{type:"button",onClick:()=>I(f=>Math.min(Math.ceil(y.length/100),f+1)),disabled:F>=Math.ceil(y.length/100),children:e.jsx(He,{})}),e.jsx("button",{type:"button",onClick:()=>I(Math.ceil(y.length/100)),disabled:F>=Math.ceil(y.length/100),children:e.jsx(ze,{})})]})]})]}),e.jsxs("button",{type:"button",onClick:T,children:["Create Layer From Selection",y.filter(f=>{var b;return(b=f.properties)==null?void 0:b.mugisSelected}).length>0&&` (${y.filter(f=>{var b;return(b=f.properties)==null?void 0:b.mugisSelected}).length} selected)`]})]})})]})},Ct=({handleLoadFileInput:s})=>{const[t,a]=u.useState(!0),[r,o]=u.useState(300),{layers:i,toggleLayerVisibilityAll:d}=w(),{mapRef:p,mapReady:l}=M();u.useEffect(()=>{const h=setInterval(()=>{var m;(m=p.current)==null||m.resize()},1);setTimeout(()=>{clearInterval(h)},1)},[p,t]);const n=u.useRef(null),c=()=>{n.current&&n.current.click()};return e.jsxs("div",{className:`sidebarContainer ${t?"open":""}`,children:[e.jsx(mt,{setWidth:o,setOpen:a}),e.jsxs("aside",{className:"sidebar",style:{width:`${r}px`},children:[e.jsxs("div",{className:"sidebarHeader",children:[e.jsx("h2",{children:"Layers"}),e.jsxs("div",{className:"sidebarHeaderActions",children:[e.jsx(Lt,{}),e.jsx("button",{type:"button",onClick:d,children:i.every(h=>h.visible)?e.jsx(ne,{}):e.jsx(oe,{})})]})]}),e.jsx("div",{className:"layerListContainer",children:l&&e.jsx(jt,{})}),e.jsxs("div",{className:"sidebarFooter",children:[e.jsxs("button",{type:"button",onClick:c,children:[e.jsx(qe,{})," Load GeoJSON file"]}),e.jsx("input",{ref:n,type:"file",multiple:!0,accept:".geojson",onChange:s})]})]})]})};function St(){const{addLayer:s}=w(),t=o=>{if(!o){console.log("no file selected");return}Array.from(o).forEach(i=>{const d=new FileReader;d.onload=p=>{var l;try{const n=JSON.parse((l=p.target)==null?void 0:l.result);if(n.type!=="FeatureCollection")throw new Error("Not a valid GeoJSON file, must be a FeatureCollection");s({featureCollection:n,name:i.name})}catch(n){console.log(n),alert("Error loading file: "+i.name+`
`+(n instanceof Error?n.message:String(n)))}},d.readAsText(i)})},a=o=>{t(o.target.files),o.target.value=""},r=o=>{o.preventDefault(),t(o.dataTransfer.files)};return e.jsxs("div",{className:"pageContainer",onDragOver:o=>o.preventDefault(),onDrop:r,children:[e.jsxs("header",{className:"mainHeader",children:[e.jsx("h1",{children:"μGIS"}),e.jsx(ft,{}),e.jsx(rt,{})]}),e.jsxs("main",{className:"mainContainer",children:[e.jsx(Ct,{handleLoadFileInput:a}),e.jsx("div",{className:"mapFlexContainer",children:e.jsx(et,{})})]})]})}Ge.createRoot(document.getElementById("root")).render(e.jsx(u.StrictMode,{children:e.jsx(St,{})}));
